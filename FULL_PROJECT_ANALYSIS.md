# Classify â€” Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø§Ù„ØµÙØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
> **ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:** 2025-02-12 | **Ø§Ù„Ù…ØµØ¯Ø±:** Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† ÙƒÙ„ Ù…Ù„Ù ÙƒÙˆØ¯ ÙØ¹Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
> **Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©:** 25+ Ù…Ù„Ù Ù…ØµØ¯Ø±ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ | **Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…Ø­Ù„Ù„Ø©:** 6,000+

---

## Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ](#1-Ù…Ù„Ø®Øµ-ØªÙ†ÙÙŠØ°ÙŠ)
2. [Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©](#2-Ø§Ù„Ø¨Ù†ÙŠØ©-Ø§Ù„ØªÙ‚Ù†ÙŠØ©-Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
3. [Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” ÙƒÙ„ Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ØªÙØµÙŠÙ„](#3-Ù‚Ø§Ø¹Ø¯Ø©-Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
4. [Ø§Ù„Ø®Ø§Ø¯Ù… â€” Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„](#4-Ø§Ù„Ø®Ø§Ø¯Ù…-server)
5. [Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© â€” ÙƒÙ„ ØµÙØ­Ø© ÙˆÙ…ÙƒÙˆÙ†](#5-Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©-Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©-frontend)
6. [Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Docker](#6-Ø§Ù„Ø¨Ù†ÙŠØ©-Ø§Ù„ØªØ­ØªÙŠØ©-docker)
7. [Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†](#7-Ù†Ø¸Ø§Ù…-Ø§Ù„Ø£Ù…Ø§Ù†)
8. [Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©](#8-Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª-Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©)
9. [ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©](#9-ØªØ¯ÙÙ‚Ø§Øª-Ø§Ù„Ø¹Ù…Ù„)
10. [Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©](#10-Ø®Ø±ÙŠØ·Ø©-Ø§Ù„Ù…Ù„ÙØ§Øª)
11. [Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ´ØºÙŠÙ„](#11-Ø£ÙˆØ§Ù…Ø±-Ø§Ù„ØªØ´ØºÙŠÙ„)
12. [Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ](#12-Ø§Ù„Ù…Ù„Ø®Øµ-Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ)

---

## 1. Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ

**Classify** Ù‡Ùˆ Ù…Ù†ØµØ© Ø±Ù‚Ø§Ø¨Ø© Ø£Ø¨ÙˆÙŠØ© ÙˆØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø¹Ø±Ø¨ÙŠØ© Ø´Ø§Ù…Ù„Ø© ØªØ±Ø¨Ø· Ø§Ù„Ø¢Ø¨Ø§Ø¡ Ø¨Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ù…Ù‡Ø§Ù… ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙ…ÙƒØ§ÙØ¢Øª Ø¨Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆÙ…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙ‡Ø¯Ø§ÙŠØ§ ØªØ­ÙÙŠØ²ÙŠØ©.

| Ø§Ù„Ø¨Ù†Ø¯ | Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©) |
|-------|---------------------------|
| **Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø©** | `rest-express` v1.0.0 (ESM module) â€” Ù…Ù† package.json |
| **Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†** | `classi-fy.com` â€” Ù…Ù† docker-compose.yml labels |
| **Ø§Ù„Ø³ÙŠØ±ÙØ±** | Hostinger VPS (srv1118737.hstgr.cloud) |
| **Ø§Ù„Ù…Ù†ÙØ°** | 5000 (Express ÙŠØ®Ø¯Ù… API + Frontend Ù…Ø¹Ø§Ù‹) â€” Ù…Ù† server/index.ts Ø³Ø·Ø± 270 |
| **Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª** | PostgreSQL 15.7-alpine Ø¹Ø¨Ø± Drizzle ORM 0.39.1 |
| **Ø§Ù„ÙƒØ§Ø´** | Redis 7.2-alpine (128MB maxmemory, allkeys-lru) |
| **Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ** | Traefik v2.11 (SSL ØªÙ„Ù‚Ø§Ø¦ÙŠ via Let's Encrypt ACME HTTP) |
| **Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª** | 11 Ø­Ø§ÙˆÙŠØ© Docker (4 Ø£Ø³Ø§Ø³ÙŠØ© + 7 Ù…Ø±Ø§Ù‚Ø¨Ø©) |
| **Ø¹Ø¯Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ DB** | 85+ Ø¬Ø¯ÙˆÙ„ pgTable â€” Ù…Ù† shared/schema.ts (1,471 Ø³Ø·Ø±) |
| **Ø¹Ø¯Ø¯ Routes** | 18 route group Ù…Ø³Ø¬Ù„Ø© â€” Ù…Ù† server/routes/index.ts |
| **Ø¹Ø¯Ø¯ ØµÙØ­Ø§Øª Frontend** | 39 ØµÙØ­Ø© â€” Ù…Ù† client/src/App.tsx (232 Ø³Ø·Ø±) |

---

## 2. Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©

### 2.1 Dependencies Ø§Ù„ÙØ¹Ù„ÙŠØ© (Ù…Ù† package.json â€” 164 Ø³Ø·Ø±)

**Frontend:**

| Ø§Ù„ØªÙ‚Ù†ÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|---------|----------|
| React | 18.3.1 | UI Framework |
| TypeScript | 5.9.3 | Type Safety |
| Vite | 6.4.1 | Bundler + Dev Server |
| Tailwind CSS | 3.4.18 | Styling |
| shadcn/ui (Radix) | 20+ components | UI Components |
| Framer Motion | 11.13.1 | Animations |
| TanStack Query | 5.60.5 | Server State |
| Wouter | 3.3.5 | Client Routing (NOT react-router) |
| react-i18next | 16.3.5 | Arabic/English i18n |
| React Hook Form | 7.55.0 | Form Management |
| Recharts | 2.15.2 | Charts/Graphs |
| Lucide React | 0.453.0 | Icons |
| Embla Carousel | 8.6.0 | Carousels |
| date-fns | 3.6.0 | Date formatting |
| cmdk | 1.1.1 | Command palette |
| qrcode.react | 4.2.0 | QR Code rendering |
| input-otp | 1.4.2 | OTP input component |

**Backend:**

| Ø§Ù„ØªÙ‚Ù†ÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|---------|----------|
| Express.js | 4.22.1 | HTTP Framework |
| Drizzle ORM | 0.39.1 | Database ORM |
| jsonwebtoken | 9.0.2 | JWT Auth |
| bcrypt | 6.0.0 | Password Hashing |
| Zod | 3.24.2 | Validation |
| Helmet | 8.1.0 | Security Headers |
| express-rate-limit | 8.2.1 | Rate Limiting |
| rate-limit-redis | 4.3.0 | Redis-backed Rate Limit |
| Resend | 4.0.0 | Email API (Primary) |
| Nodemailer | 6.10.1 | SMTP Email (Fallback) |
| Stripe | 14.25.0 | Payment Processing |
| MinIO | 8.0.6 | Object Storage |
| Google Cloud Storage | 7.18.0 | Cloud Storage |
| ioredis | 5.8.2 | Redis Client |
| Pino | 10.1.0 | Structured Logging |
| Passport | 0.7.0 | Auth Strategies |
| google-auth-library | 10.5.0 | Google OAuth |
| qrcode | 1.5.3 | QR Generation (server) |
| compression | 1.8.1 | Response Compression |
| multer | 2.0.2 | File Upload |
| cors | 2.8.5 | CORS Middleware |
| dotenv | 17.2.3 | Env Variables |
| uuid | 9.0.0 | UUID Generation |
| ws | 8.18.0 | WebSocket |
| jsqr | 1.4.0 | QR Scanning |

**Mobile:**

| Ø§Ù„ØªÙ‚Ù†ÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± |
|---------|---------|
| @capacitor/core | 7.4.4 |
| @capacitor/android | 7.4.4 |
| @capacitor/ios | 7.4.4 |
| @capacitor/cli | 7.4.4 |

**Testing/Dev:**

| Ø§Ù„ØªÙ‚Ù†ÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± |
|---------|---------|
| Vitest | 1.6.0 |
| Jest | 30.2.0 |
| Supertest | 7.1.4 |
| Playwright | 1.50.0 |
| ESLint | 9.39.2 |
| drizzle-kit | 0.31.7 |
| esbuild | 0.25.12 |
| tsx | 4.21.0 |

### 2.2 Build Pipeline (Ù…Ù† package.json scripts)

```
ØªØ·ÙˆÙŠØ±:   NODE_ENV=development tsx server/index.ts
          â†’ ÙŠØ´ØºÙ„ Express + Vite dev server (HMR) Ù…Ø¹Ø§Ù‹ Ø¹Ù„Ù‰ Ù…Ù†ÙØ° 5000

Ø¨Ù†Ø§Ø¡:    vite build â†’ dist/public/ (frontend assets, hashed filenames)
          esbuild server/index.ts â†’ dist/index.js (backend, ESM, external packages)

Ø¥Ù†ØªØ§Ø¬:   NODE_ENV=production node dist/index.js
          â†’ Express ÙŠØ®Ø¯Ù… API + dist/public/ static files
```

### 2.3 Config Files (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©)

**vite.config.ts (42 Ø³Ø·Ø±):**
- Root: `client/`
- Build output: `../dist/public` (relative to client/)
- Assets: `assets/[name]-[hash].[ext]` (cache-busting)
- Aliases: `@/` â†’ `client/src/`, `@shared/` â†’ `shared/`, `@assets/` â†’ `attached_assets/`
- Dev server: host `0.0.0.0`, port `5000`

**tsconfig.json (35 Ø³Ø·Ø±):**
- Target: ES2020, Module: ES2022, moduleResolution: bundler
- Strict mode: `strict: true` Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø´Ø¯Ø¯Ø©
- Path aliases: `@/*` â†’ `client/src/*`, `@shared/*` â†’ `shared/*`

**drizzle.config.ts (15 Ø³Ø·Ø±):**
- Output: `./migrations`, Schema: `./shared/schema.ts`, Dialect: `postgresql`

---

## 3. Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

> **Ø§Ù„Ù…ØµØ¯Ø±:** `shared/schema.ts` â€” 1,471 Ø³Ø·Ø± Ù…Ù‚Ø±ÙˆØ¡Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„

### 3.1 Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

| Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ | Ø§Ù„Ù‚ÙŠÙ…Ø© |
|---------|--------|
| Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ | **85+ pgTable** |
| Ø¹Ø¯Ø¯ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø®ØµØµØ© | **64+ index** |
| Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ | unique, composite, partial, lower-case |
| ORM | Drizzle (pgTable + relations) |
| Validation | Zod (createInsertSchema) |
| IDs | UUID (gen_random_uuid()) |

### 3.2 ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¸ÙŠÙØ©

#### A. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (7 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-----------------|---------|
| `app_settings` | key (unique), value | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© key/value |
| `rewards_settings` | pointsPerTask (10), dailyLimit (100) | Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª |
| `tasks_settings` | maxTasksPerDay (10), allowCustomTasks (true) | Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù‡Ø§Ù… |
| `store_settings` | storeEnabled (true), minPointsToBuy (10) | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± |
| `notification_settings` | enablePush (true), enableEmail (false) | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª |
| `payment_settings` | paymentEnabled (false), gateway | Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ |
| `theme_settings` | primaryColor, secondaryColor, accentColor | Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ |

#### B. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† (5 Ø¬Ø¯Ø§ÙˆÙ„ Ø£Ø³Ø§Ø³ÙŠØ©)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„ÙÙ‡Ø§Ø±Ø³ | Ù…Ù„Ø§Ø­Ø¸Ø§Øª |
|--------|-----------------|---------|---------|
| `parents` | email, password, name, phoneNumber, uniqueCode, qrCode, twoFAEnabled, failedLoginAttempts, lockedUntil, smsEnabled, smsVerified, privacyAccepted | email UNIQUE + lower-case index | bcrypt password, 2FA, lockout mechanism |
| `children` | name, totalPoints, avatarUrl, birthday, schoolName, hobbies | â€” | Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„ÙˆØ§Ù„Ø¯ Ø¹Ø¨Ø± parentChild |
| `admins` | email, password, role | email UNIQUE | role default: "superadmin" |
| `symbols` | name, nameAr, emoji, imageUrl, category, isActive, sortOrder | â€” | Ù…ÙƒØªØ¨Ø© Ø±Ù…ÙˆØ²/Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª |
| `point_adjustments` | adminId, childId, delta, reason | â€” | ØªØ¹Ø¯ÙŠÙ„ Ù†Ù‚Ø§Ø· ÙŠØ¯ÙˆÙŠ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† |

#### C. Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„Ø£Ø¬Ù‡Ø²Ø© (10 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„Ù‚ÙŠÙˆØ¯ | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-----------------|--------|---------|
| `trusted_devices` | parentId, deviceIdHash, refreshTokenHash, expiresAt, revokedAt | FKâ†’parents | Ø£Ø¬Ù‡Ø²Ø© Ù…ÙˆØ«ÙˆÙ‚Ø© (legacy) |
| `trusted_devices_parent` | parentId, deviceId, deviceName, deviceType | UNIQUE(parentId, deviceId) | Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¢Ø¨Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© |
| `trusted_devices_child` | childId, deviceId, deviceName, deviceType | UNIQUE(childId, deviceId) | Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ |
| `child_trusted_devices` | childId, deviceIdHash, refreshTokenHash | FKâ†’children | Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ (legacy) |
| `sessions` | parentId, deviceId, tokenHash, expiresAt, isRevoked | UNIQUE(parentId, deviceId) | Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø© |
| `login_history` | parentId, success, ipAddress, failureReason, suspiciousActivity | â€” | Ø³Ø¬Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ |
| `otp_codes` | parentId, purpose, code (bcrypt), method, destination, expiresAt, attempts, status | partial unique index on pending | Ø±Ù…ÙˆØ² OTP |
| `otp_request_logs` | destination, ipAddress, createdAt | â€” | ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§Øª OTP |
| `child_login_requests` | childId, parentId, status, sessionToken | â€” | Ø·Ù„Ø¨ Ø¯Ø®ÙˆÙ„ Ø·ÙÙ„ Ø¨Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ÙˆØ§Ù„Ø¯ |
| `social_login_providers` | name (google/facebook/apple...), clientId, clientSecret, isEnabled | name UNIQUE | Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ |

#### D. Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø±Ø¨Ø· (4 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ù‚ÙŠÙˆØ¯ | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|--------|---------|
| `parent_child` | UNIQUE(parentId, childId), onDelete: cascade | Ø±Ø¨Ø· ÙˆØ§Ù„Ø¯â†”Ø·ÙÙ„ |
| `parent_child_linking_codes` | code UNIQUE, isUsed, expiresAt | Ø±Ù…ÙˆØ² Ø±Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© |
| `parent_parent_sync` | UNIQUE(primaryParentId, secondaryParentId) | Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† ÙˆØ§Ù„Ø¯ÙŠÙ† |
| `parent_social_identities` | parentId, providerId, providerUserId, accessToken | Ù‡ÙˆÙŠØ§Øª OAuth |

#### E. Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… (8 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-----------------|---------|
| `subjects` | name, emoji, description, color, isActive | Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© |
| `template_tasks` | subjectId, question, answers (JSON[]), difficulty, createdByParent, isPublic, pointsCost, usageCount | Ù…Ù‡Ø§Ù… Ø¬Ø§Ù‡Ø²Ø© (Ø³ÙˆÙ‚ Ø§Ù„Ù…Ù‡Ø§Ù…) |
| `tasks` | parentId, childId, subjectId, question, answers (JSON[]), pointsReward, status | Ù…Ù‡Ø§Ù… Ù…Ø¹ÙŠÙ†Ø© Ù„Ø·ÙÙ„ |
| `task_results` | taskId, childId, selectedAnswerId, isCorrect, pointsEarned, timeTaken | Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© |
| `task_attempts_summary` | PK: (taskId, childId), totalAttempts, failedAttempts, lastAttemptAt | Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª |
| `task_monitoring_counters` | childId, taskId, metric, value | Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø© |
| `scheduled_tasks` | parentId, childId, templateTaskId, scheduledAt, status (pending/sent/cancelled) | Ù…Ù‡Ø§Ù… Ù…Ø¬Ø¯ÙˆÙ„Ø© |
| `profit_transactions` | templateTaskId, sellerId, buyerId, sellerEarnings, appCommission, status | Ø£Ø±Ø¨Ø§Ø­ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ù‡Ø§Ù… |

#### F. Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù†Ù…Ùˆ (6 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|---------|
| `points_history` | childId, points, source (task/game/referral), sourceId | Ø³Ø¬Ù„ ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· |
| `points_ledger` | childId, taskId, pointsDelta, balanceAfter, reason, requestId | Ø¯ÙØªØ± Ø­Ø³Ø§Ø¨ÙŠ Ù„Ù„Ù†Ù‚Ø§Ø· |
| `child_growth_trees` | childId (UNIQUE), currentStage (1-8), totalGrowthPoints, tasksCompleted | Ø´Ø¬Ø±Ø© Ù†Ù…Ùˆ Ø§Ù„Ø·ÙÙ„ |
| `child_growth_events` | childId, eventType, growthPoints, metadata (JSON) | Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù…Ùˆ |
| `child_activity_status` | childId (UNIQUE), isOnline, currentActivity, totalPlayTimeToday | Ø­Ø§Ù„Ø© Ù†Ø´Ø§Ø· Ø§Ù„Ø·ÙÙ„ |
| `flash_games` | title, embedUrl, pointsPerPlay (5), isActive | Ø£Ù„Ø¹Ø§Ø¨ ÙÙ„Ø§Ø´ ØªØ¹Ù„ÙŠÙ…ÙŠØ© |

#### G. Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…ØªØ¬Ø± (13 Ø¬Ø¯ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-----------------|---------|
| `product_categories` | name, nameAr, icon, color, sortOrder | ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª |
| `products` | parentId (nullable=global), categoryId, name/nameAr, description/descriptionAr, price, pointsPrice, images (JSON), productType (digital/physical/subscription), brand, rating | Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª |
| `price_tiers` | productId, currency, unitAmount, interval (once/monthly/yearly), stripePriceId | Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø± |
| `orders` | parentId, childId, productId, quantity, pointsPrice, status | Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø· |
| `child_purchases` | childId, productId, orderId, pointsSpent | Ù…Ø´ØªØ±ÙŠØ§Øª Ø£Ø·ÙØ§Ù„ |
| `child_purchase_requests` | childId, parentId, productId, status (pending/approved/rejected) | Ø·Ù„Ø¨Ø§Øª Ø¨Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ÙˆØ§Ù„Ø¯ |
| `store_orders` | parentId, status (PENDING/PAYMENT_INITIATED/PAID/FAILED/REFUNDED), totalAmount, stripeSessionId, idempotencyKey (UNIQUE) | Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© |
| `order_items` | orderId, productId, priceTierId, quantity, unitAmount | Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø·Ù„Ø¨ |
| `parent_purchases` | parentId, totalAmount, currency, paymentStatus (pending/paid/failed/refunded), invoiceNumber | Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¨Ø§Ø¡ |
| `parent_purchase_items` | purchaseId, productId, quantity, unitPrice, subtotal | Ø¨Ù†ÙˆØ¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø¢Ø¨Ø§Ø¡ |
| `parent_owned_products` | parentId, productId, status (pending_admin_approval/active/assigned_to_child/exhausted) | Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…Ù„ÙˆÙƒØ© |
| `child_assigned_products` | childId, productId, parentOwnedProductId, requiredPoints, progressPoints, status (active/completed/shipment_requested/shipped) | Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ÙŠÙ†Ø© Ù„Ù„Ø·ÙÙ„ |
| `shipping_requests` | parentId, childId, productId, status (requested/approved/shipped/cancelled), address | Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù† |

#### H. Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (9 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-----------------|---------|
| `parent_wallet` | parentId (UNIQUE), balance, totalDeposited, totalSpent | Ù…Ø­ÙØ¸Ø© Ø§Ù„ÙˆØ§Ù„Ø¯ |
| `wallets` | parentId (UNIQUE), balance, currency, status (active/frozen) | Ù†Ø¸Ø§Ù… Ù…Ø­Ø§ÙØ¸ Phase 2 |
| `wallet_transfers` | walletId, type (DEPOSIT/REFUND/SPEND), amount, reason, relatedOrderId | Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø© |
| `payment_methods` | parentId, type, accountNumber, isDefault | ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ø¯ÙØ¹ |
| `deposits` | parentId, paymentMethodId, amount, status (pending/approved/rejected), transactionId | Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ |
| `transactions` | orderId, provider (stripe), providerRef, status, amount, idempotencyKey (UNIQUE) | Ù…Ø¹Ø§Ù…Ù„Ø§Øª Stripe |
| `webhook_events` | provider, eventType, dedupeKey (UNIQUE), payload (JSON), signatureVerified | Ø£Ø­Ø¯Ø§Ø« Webhook |
| `shipping_addresses` | parentId, addressLine1/2, city, state, postalCode, country (ISO 3166), isDefault | Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø´Ø­Ù† |
| `refunds` | transactionId, amount, status (pending/completed/failed), providerRef, reason | Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª |

#### I. Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙˆØ§Ù„Ù…Ù„ÙƒÙŠØ© (3 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|---------|
| `child_gifts` | parentId, childId, productId, status (pending/delivered/acknowledged) | Ù‡Ø¯Ø§ÙŠØ§ Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„ |
| `gifts` | parentId, childId, productId, pointsThreshold, status (SENT/UNLOCKED/ACTIVATED/REVOKED) | Ù†Ø¸Ø§Ù… Ù‡Ø¯Ø§ÙŠØ§ ØªØ­ÙÙŠØ²ÙŠØ© |
| `entitlements` | parentId, childId (nullable), productId, orderId, status (ACTIVE/ASSIGNED_AS_GIFT/EXPIRED), UNIQUE(orderId, productId, parentId) | Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª |

#### J. Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (6 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|-----------------|---------|
| `notifications` | parentId/childId, type, title, message, style (toast/modal/banner/fullscreen), priority (normal/warning/urgent/blocking), soundAlert, vibration, ctaAction, ctaTarget, metadata (JSON) | Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø© |
| `broadcast_notifications` | adminId, title, message, targetAudience (all), priority, recipientCount | Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ© |
| `parent_notifications` | parentId, title, message, type, isRead | Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¢Ø¨Ø§Ø¡ |
| `child_notification_settings` | childId, mode (popup_strict/popup_soft/floating_bubble), repeatDelayMinutes | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·ÙÙ„ |
| `child_events` | childId, eventType, relatedId, meta (JSON), isAcknowledged | Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø·ÙÙ„ |
| `outbox_events` | type, payloadJson, status, retryCount, lastError | Transactional Outbox Pattern |

#### K. Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (4 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|---------|
| `child_ads` | content (image/video/link/code), pointsReward, watchDurationSeconds, isActive | Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„Ø£Ø·ÙØ§Ù„ (Ù…ÙƒØ§ÙØ£Ø© Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·) |
| `parent_ads` | content types Ù…Ù…Ø§Ø«Ù„Ø©, Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø§Ø· | Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„Ø¢Ø¨Ø§Ø¡ |
| `ad_watch_history` | childId/parentId, adId, watchedDuration, pointsEarned, isCompleted | Ø³Ø¬Ù„ Ù…Ø´Ø§Ù‡Ø¯Ø© |
| `ads` | targetAudience (all/parents/children), viewCount, clickCount | Ù†Ø¸Ø§Ù… Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¹Ø§Ù… |

#### L. Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª/Ø§Ù„ØªØ¬Ø§Ø± (6 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|---------|
| `libraries` | username, password, businessName, referralCode, commissionRatePct | ØªØ¬Ø§Ø± Ù…ÙƒØªØ¨Ø§Øª |
| `library_products` | libraryId, title, price, discountPercent, discountMinQuantity, stock | Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© |
| `library_referrals` | libraryId, referredParentId, status (clicked/registered/purchased) | Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª |
| `library_activity_logs` | libraryId, action, meta | Ø³Ø¬Ù„ Ù†Ø´Ø§Ø· |
| `library_referral_settings` | pointsPerReferral, minPurchaseAmount | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø­Ø§Ù„Ø§Øª |
| `library_daily_sales` | libraryId, date, totalSales, commissionAmount, isPaid | Ù…Ø¨ÙŠØ¹Ø§Øª ÙŠÙˆÙ…ÙŠØ© |

#### M. Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª (3 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|---------|
| `referral_settings` | pointsPerReferral (100), commissionPercent (10), isEnabled | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø© |
| `referrals` | referrerId, referredId, status (pending/active/rewarded), UNIQUE pair | Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª |
| `parent_referral_codes` | parentId (UNIQUE), code (UNIQUE), totalReferrals | Ø±Ù…ÙˆØ² Ø¥Ø­Ø§Ù„Ø© |

#### N. Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (3 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|---------|
| `media` | objectKey, url, storageProvider, mimeType, size, width/height, scanStatus, dedupe unique index | Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· |
| `media_references` | mediaId, entityType, entityId, field, unique active ref index | Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø¨Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª |
| `media_events` | mediaId, actorType, action, meta | Ø³Ø¬Ù„ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ³Ø§Ø¦Ø· |

#### O. SEO ÙˆØ§Ù„Ø¯Ø¹Ù… ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© (4 Ø¬Ø¯Ø§ÙˆÙ„)

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„ÙˆØµÙ |
|--------|-------|
| `seo_settings` | Ø´Ø§Ù…Ù„Ø©: meta tags, OpenGraph, Twitter cards, robots, schema.org, Google Analytics, AI crawler control (Googlebot-AI, GPTBot, etc.), PWA manifest |
| `support_settings` | contact info, social media links, working hours, maintenance mode, error page config, help center, FAQ section, legal info |
| `site_settings` | key/value Ø¹Ø§Ù… |
| `otp_providers` | email/sms provider config: codeLength, expiryMinutes, maxAttempts, cooldownMinutes |

#### P. Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·

| Ø§Ù„Ø¬Ø¯ÙˆÙ„ | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|--------|---------|
| `activity_log` | adminId, action, entity, entityId, meta (JSON), ipAddress |

---

## 4. Ø§Ù„Ø®Ø§Ø¯Ù… (Server)

### 4.1 Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„: `server/index.ts` (301 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

**ØªØ³Ù„Ø³Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø³Ø·Ø±Ø§Ù‹ Ø¨Ø³Ø·Ø±):**

1. **Ø³Ø·Ø± 1:** `import "dotenv/config"` â€” ØªØ­Ù…ÙŠÙ„ .env
2. **Ø£Ø³Ø·Ø± 13-22:** Ø·Ø¨Ø§Ø¹Ø© ØªØ´Ø®ÙŠØµØ§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© (NODE_ENV, PORT, DATABASE_URL, JWT_SECRET)
3. **Ø£Ø³Ø·Ø± 40-50:** ÙØ­Øµ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© â†’ `process.exit(1)` Ø¥Ø°Ø§ Ù†Ø§Ù‚ØµØ©:
   - `JWT_SECRET`, `SESSION_SECRET`, `ADMIN_EMAIL`, `ADMIN_PASSWORD`, `DATABASE_URL`
4. **Ø³Ø·Ø± 52:** Ø¥Ù†Ø´Ø§Ø¡ Express app
5. **Ø£Ø³Ø·Ø± 54-60:** Ø¥Ø¹Ø¯Ø§Ø¯ REDACT_KEYS Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
6. **Ø³Ø·Ø± 71:** `trust proxy 1` (Ù„Ù„Ø¹Ù…Ù„ Ø®Ù„Ù Nginx/Traefik)
7. **Ø£Ø³Ø·Ø± 73-112:** Helmet CSP:
   - `defaultSrc: ['self']`
   - `scriptSrc: ['self', 'unsafe-inline']` â€” Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙÙŠ index.html
   - `styleSrc: ['self', 'unsafe-inline', 'fonts.googleapis.com']`
   - `fontSrc: ['self', 'fonts.gstatic.com', 'data:']`
   - `imgSrc: ['self', 'data:', 'blob:', 'storage.googleapis.com']`
   - `frameSrc: ['none']`, `objectSrc: ['none']`
8. **Ø³Ø·Ø± 113:** `compression()` middleware
9. **Ø³Ø·Ø± 116:** `/uploads` static directory
10. **Ø£Ø³Ø·Ø± 118-126:** Raw body bypass Ù„Ù€ `/api/payments/stripe/webhook`
11. **Ø£Ø³Ø·Ø± 127-133:** JSON/URL parsing (limit: 10MB)
12. **Ø£Ø³Ø·Ø± 135-145:** SyntaxError handler (malformed JSON â†’ 400)
13. **Ø£Ø³Ø·Ø± 147-175:** CORS configurable Ø¹Ø¨Ø± `CORS_ORIGIN` env (comma-separated Ø£Ùˆ *)
14. **Ø£Ø³Ø·Ø± 177-188:** Request logging (API routes ÙÙ‚Ø·)
15. **Ø³Ø·Ø± 190:** IIFE async â€” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„:
    - `registerRoutes(app)` â€” ØªØ³Ø¬ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ù€ routes
    - `initializeGiftNotificationHandlers()` â€” Event listeners Ù„Ù„Ù‡Ø¯Ø§ÙŠØ§
    - `startMediaWorker()` â€” Background worker
    - API 404 guard â†’ JSON error
    - Global error handler â†’ redacted logging
    - Dev: `setupVite()` | Prod: `serveStatic()`
    - Listen: `0.0.0.0:5000`
    - Graceful shutdown (SIGTERM, SIGINT)
    - UnhandledRejection â†’ `process.exit(1)`

### 4.2 ØªØ³Ø¬ÙŠÙ„ Routes: `server/routes/index.ts` (69 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

```
registerAuthRoutes(app)                â†’ auth.ts (2,533 Ø³Ø·Ø±!)
registerAdminRoutes(app)               â†’ admin.ts
registerAdminSettingsRoutes(app)       â†’ admin.settings.ts
registerActivityLogRoutes(app)         â†’ admin-activity.ts
registerAnalyticsRoutes(app)           â†’ admin-analytics.ts
registerGiftManagementRoutes(app)      â†’ admin-gifts.ts
registerNotificationSettingsRoutes(app)â†’ admin-notification-settings.ts
registerParentRoutes(app)              â†’ parent.ts
registerChildRoutes(app)               â†’ child.ts
registerPaymentRoutes(app)             â†’ payments.ts
registerStoreRoutes(app)               â†’ store.ts
registerReferralRoutes(app)            â†’ referrals.ts
registerLibraryRoutes(app)             â†’ library.ts
registerObjectStorageRoutes(app)       â†’ replit_integrations/object_storage.ts
registerMediaUploadRoutes(app)         â†’ media-uploads.ts
app.use("/api", trustedDevicesRouter)  â†’ trusted-devices.ts
app.use("/api", adsRouter)             â†’ ads.ts
app.use("/api", parentLinkingRouter)   â†’ parent-linking.ts

+ Health check: GET /api/health â†’ { status: "ok" }
+ ensureOtpProviders() â€” bootstraps OTP providers on startup
```

### 4.3 Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: `server/routes/auth.ts` (2,533 Ø³Ø·Ø± â€” Ø£ÙƒØ¨Ø± Ù…Ù„Ù)

**Ø§Ù„Ø«ÙˆØ§Ø¨Øª (Ù…Ù† Ø£Ø³Ø·Ø± 32-38):**
```
MAX_FAILED_LOGIN_ATTEMPTS = 5
LOCKOUT_MINUTES = 15
OTP_RATE_LIMIT_RETRY_AFTER_SEC = 600 (10 Ø¯Ù‚Ø§Ø¦Ù‚)
MAX_TRUSTED_DEVICES = 5
DEVICE_TOKEN_EXPIRY_DAYS = 45
```

**Helper Functions (Ø£Ø³Ø·Ø± 40-95):**
- `maskPhoneNumber()` â€” Ø¥Ø®ÙØ§Ø¡ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ
- `computeDeviceHash()` â€” SHA-256 Ù…Ù† deviceId + user-agent + IP
- `normalizeEmail()` â€” trim + toLowerCase
- `respondRateLimited()` â€” Retry-After header
- `respondOtpCooldown()` â€” OTP cooldown response
- `isOtpRequestAllowed()` â€” 3 Ø·Ù„Ø¨Ø§Øª ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ ÙÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ per destination+IP
- `logOtpRequest()` â€” ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ OTP
- `canUseSMS()` â€” ÙØ­Øµ Ù‡Ù„ Ø§Ù„Ù€ SMS Ù…ØªØ§Ø­
- `checkSMSRateLimit()` â€” Ø­Ø¯ 5 SMS/Ø³Ø§Ø¹Ø©

**Endpoints Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
- `POST /api/auth/register` â€” ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¯ Ø¬Ø¯ÙŠØ¯ (registerLimiter: 5/min)
- `POST /api/auth/login` â€” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ (loginLimiter: 5/min)
- `POST /api/auth/verify-otp` â€” ØªØ­Ù‚Ù‚ OTP (otpVerifyLimiter: 5/min)
- `POST /api/auth/request-otp` â€” Ø·Ù„Ø¨ OTP Ø¬Ø¯ÙŠØ¯ (otpRequestLimiter: 3/min)
- `POST /api/auth/logout` â€” ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
- `POST /api/auth/forgot-password` â€” Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
- `POST /api/auth/reset-password` â€” Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
- `POST /api/auth/verify-email-otp` â€” ØªØ­Ù‚Ù‚ OTP Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
- `POST /api/auth/social/*` â€” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ (Google, Facebook, Apple)
- `GET /api/auth/me` â€” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
- `POST /api/auth/change-password` â€” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
- `PUT /api/auth/enable-2fa` â€” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©
- `PUT /api/auth/disable-2fa` â€” Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©
- + endpoints Ù„Ù„Ø£Ø·ÙØ§Ù„ (/api/auth/child/*)

### 4.4 Middleware: `server/routes/middleware.ts` (55 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

```typescript
// authMiddleware:
// 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ token Ù…Ù† Authorization: Bearer <token>
// 2. jwt.verify() Ù…Ø¹ JWT_SECRET
// 3. normalized payload: req.user = { userId, parentId, type }
// 4. child tokens: type === "child" â†’ ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„ØºÙŠØ± /api/child*

// adminMiddleware:  
// 1. jwt.verify() Ù…Ø¹ JWT_SECRET
// 2. ÙŠØªØ·Ù„Ø¨ type === "admin" ÙÙŠ Ø§Ù„Ù€ payload
// 3. req.admin = decoded payload
```

**JWT_SECRET:** ÙŠØ³ØªØ®Ø¯Ù… hardcoded fallback ÙÙŠ development ÙÙ‚Ø·ØŒ `process.exit(1)` ÙÙŠ production Ø¥Ø°Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.

### 4.5 Rate Limiters: `server/utils/rateLimiters.ts` (42 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

| Limiter | Ø§Ù„Ø­Ø¯ | Ø§Ù„Ù†Ø§ÙØ°Ø© | Ø§Ù„Ù…ÙØªØ§Ø­ |
|---------|------|---------|---------|
| `registerLimiter` | 5/min | 60s | IP ÙÙ‚Ø· |
| `loginLimiter` | 5/min | 60s | IP + email (composite) |
| `otpRequestLimiter` | 3/min | 60s | IP + email + OTP event tracking |
| `otpVerifyLimiter` | 5/min | 60s | IP + email |

### 4.6 OTP Service: `server/services/otpService.ts` (201 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

```
OTP_LENGTH = 6 Ø£Ø±Ù‚Ø§Ù…
OTP_EXPIRY_MINUTES = 5
MAX_ATTEMPTS = 3
OTP_COOLDOWN_SECONDS = 60

Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©:
1. ØªÙˆÙ„ÙŠØ¯ 6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (crypto.randomInt)
2. bcrypt hash (10 rounds)
3. Ø­ÙØ¸ ÙÙŠ otp_codes Ù…Ø¹ status: "pending"
4. Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚: bcrypt compare
5. Atomic increment attempts (race condition safe)
6. Atomic mark verified
7. Supersede old pending OTPs Ø¹Ù†Ø¯ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
8. Cooldown enforcement: 60 Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø¨Ø§Øª
```

### 4.7 Mail Service: `server/mailer.ts` (184 Ø³Ø·Ø±)

```
Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:
1. Resend API (Ø¥Ø°Ø§ RESEND_API_KEY Ù…ÙˆØ¬ÙˆØ¯)
2. SMTP via Nodemailer (Ø¥Ø°Ø§ SMTP_HOST Ù…ÙˆØ¬ÙˆØ¯)
   - Ø¯Ø¹Ù…: SMTP_HOST, SMTP_PORT (587), SMTP_USER, SMTP_PASSWORD, SMTP_SECURE, SMTP_FROM

ÙŠØ¹Ù…Ù„ Ù…Ø¹ Replit connector ÙƒÙ€ fallback Ù„Ù€ Resend credentials.
```

### 4.8 Notification Handlers: `server/notificationHandlers.ts` (94 Ø³Ø·Ø±)

```
Event-Driven Architecture (EventEmitter):

gift.sent     â†’ log ÙÙ‚Ø·
gift.unlocked â†’ notification(modal, soundAlert: true, vibration: true, priority: urgent)
gift.activated â†’ notification(toast, soundAlert: false)
gift.revoked  â†’ log ÙÙ‚Ø·
```

### 4.9 API Response Contract: `server/utils/apiResponse.ts` (76 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

```json
// Ù†Ø¬Ø§Ø­:
{ "success": true, "data": {...}, "message": "Optional" }

// Ø®Ø·Ø£:
{ "success": false, "error": "ERROR_CODE", "message": "Human readable" }
```

**Error Codes Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙØ¹Ù„ÙŠØ§Ù‹:**
`NOT_FOUND`, `UNAUTHORIZED`, `BAD_REQUEST`, `INTERNAL_SERVER_ERROR`, `PARENT_CHILD_MISMATCH`, `OTP_EXPIRED`, `RATE_LIMITED`, `FORBIDDEN`, `CONFLICT`, `INVALID_CREDENTIALS`, `SMS_NOT_ENABLED`, `PAYMENT_FAILED`

### 4.10 Static File Serving: `server/static.ts` (85 Ø³Ø·Ø±)

```
Production:
- ÙŠØ®Ø¯Ù… dist/public/ ÙƒÙ…Ù„ÙØ§Øª Ø«Ø§Ø¨ØªØ©
- Cache strategy:
  - sw.js, manifest.json, index.html â†’ no-cache (always fresh)
  - /assets/* (hashed) â†’ Cache-Control: public, max-age=31536000, immutable
  - Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª â†’ max-age=86400 (ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯)
- SPA fallback: Ø£ÙŠ route ØºÙŠØ± /api/* â†’ index.html
```

---

## 5. Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (Frontend)

### 5.1 Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: `client/src/App.tsx` (232 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

**Provider Hierarchy:**
```
QueryClientProvider (TanStack React Query)
  â””â†’ ThemeProvider (Ø£Ù„ÙˆØ§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©)
       â””â†’ SEOProvider (meta tags ØªÙ„Ù‚Ø§Ø¦ÙŠØ©)
            â””â†’ TooltipProvider (Radix tooltips)
                 â””â†’ Router (wouter Switch/Route)
                      â””â†’ Toaster (toast notifications)
```

**Lazy Loading:** ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ù…Ø§ Ø¹Ø¯Ø§ Home, ParentAuth, ChildLink Ù…Ø­Ù…Ù„Ø© ÙƒØ³ÙˆÙ„ Ø¹Ø¨Ø± `React.lazy()` Ù…Ø¹ `Suspense` fallback.

**ChildAppWrapper:** ÙƒÙ„ ØµÙØ­Ø§Øª `/child-*` Ù…ØºÙ„ÙØ© Ø¨Ù€ `ChildAppWrapper` Ø§Ù„Ø°ÙŠ ÙŠÙˆÙØ± Ø³ÙŠØ§Ù‚ Ø§Ù„Ø·ÙÙ„.

**ErrorBoundary:** Ù…Ø·Ø¨Ù‚ Ø¹Ù„Ù‰: ParentAuth, OTPVerification, ForgotPassword, ParentDashboard, ParentTasks.

### 5.2 ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª (39 ØµÙØ­Ø© â€” Ù…Ù† App.tsx)

#### ØµÙØ­Ø§Øª Ø¹Ø§Ù…Ø© (5):
| Route | Component | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|-------|-----------|---------|
| `/` | `Home` | Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ØºÙŠØ± ÙƒØ³ÙˆÙ„Ø©) |
| `/privacy` | `Privacy` | Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© |
| `/privacy-policy` | `PrivacyPolicy` | ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®ØµÙˆØµÙŠØ© |
| `/accessibility` | `AccessibilityPolicy` | Ø³ÙŠØ§Ø³Ø© Ø§Ù„ÙˆØµÙˆÙ„ |
| `/terms` | `Terms` | Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… |

#### ØµÙØ­Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (4):
| Route | Component | Ù…Ù„Ø§Ø­Ø¸Ø§Øª |
|-------|-----------|---------|
| `/parent-auth` | `ParentAuth` | ØºÙŠØ± ÙƒØ³ÙˆÙ„Ø© + ErrorBoundary |
| `/otp` | `OTPVerification` | ErrorBoundary |
| `/forgot-password` | `ForgotPassword` | ErrorBoundary |
| `/admin` | `AdminAuth` | â€” |

#### ØµÙØ­Ø§Øª Ø§Ù„ÙˆØ§Ù„Ø¯ (13):
| Route | Component |
|-------|-----------|
| `/parent-dashboard` | `ParentDashboard` (ErrorBoundary) |
| `/child-link` | `ChildLink` (ØºÙŠØ± ÙƒØ³ÙˆÙ„Ø©) |
| `/parent-store` | `ParentStore` |
| `/parent-store-multi` | `ParentStoreMulti` |
| `/parent-inventory` | `ParentInventory` |
| `/parent-tasks` | `ParentTasks` (ErrorBoundary) |
| `/assign-task` | `AssignTask` |
| `/wallet` | `Wallet` |
| `/notifications` | `Notifications` |
| `/subjects` | `Subjects` |
| `/subject-tasks` | `SubjectTasks` |
| `/settings` | `Settings` |
| `/create-task` | **DEPRECATED** â†’ Redirect to `/parent-tasks` (remove after 2026-02-20) |

#### ØµÙØ­Ø§Øª Ø§Ù„Ø·ÙÙ„ (9 â€” ÙƒÙ„Ù‡Ø§ Ù…ØºÙ„ÙØ© Ø¨Ù€ ChildAppWrapper):
| Route | Component |
|-------|-----------|
| `/child-games` | `ChildGames` |
| `/child-store` | `ChildStore` |
| `/child-gifts` | `ChildGifts` |
| `/child-notifications` | `ChildNotifications` |
| `/child-rewards` | `ChildRewards` |
| `/child-progress` | `ChildProgress` |
| `/child-tasks` | `ChildTasks` |
| `/child-profile` | `ChildProfile` |
| `/child-settings` | `ChildSettings` |

#### ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† (2):
| Route | Component |
|-------|-----------|
| `/admin-dashboard` | `AdminDashboard` |
| `/admin/purchases` | `AdminPurchasesTab` |

#### ØµÙØ­Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© (3):
| Route | Component |
|-------|-----------|
| `/library/login` | `LibraryLogin` |
| `/library/dashboard` | `LibraryDashboard` |
| `/library-store` | `LibraryStore` |

#### ØµÙØ­Ø© 404:
| Route | Component |
|-------|-----------|
| `*` (catch-all) | `NotFound` |

### 5.3 Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…Ù† client/src/components/)

```
ui/                         â† shadcn/ui (20+ Radix-based components)
admin/                      â† Admin dashboard components
child/                      â† Child interface components
dashboard/                  â† Parent dashboard widgets
forms/                      â† Form building blocks
notifications/              â† Notification rendering

Top-level components:
â”œâ”€â”€ AdBanner.tsx             â† Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
â”œâ”€â”€ AnnualReportChart.tsx    â† ØªÙ‚Ø±ÙŠØ± Ø³Ù†ÙˆÙŠ (Recharts)
â”œâ”€â”€ ChildAppWrapper.tsx      â† Ø³ÙŠØ§Ù‚ ØµÙØ­Ø§Øª Ø§Ù„Ø·ÙÙ„
â”œâ”€â”€ ChildPermissionsSetup.tsxâ† Ø¥Ø¹Ø¯Ø§Ø¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø·ÙÙ„
â”œâ”€â”€ ErrorBoundary.tsx        â† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ React
â”œâ”€â”€ GrowthTree.tsx           â† Ø´Ø¬Ø±Ø© Ù†Ù…Ùˆ Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
â”œâ”€â”€ LanguageSelector.tsx     â† AR â†” EN toggle
â”œâ”€â”€ MandatoryTaskModal.tsx   â† Ù†Ø§ÙØ°Ø© Ù…Ù‡Ù…Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©
â”œâ”€â”€ ObjectUploader.tsx       â† Ø±ÙØ¹ Ù…Ù„ÙØ§Øª (Uppy)
â”œâ”€â”€ OTPInput.tsx             â† Ø¥Ø¯Ø®Ø§Ù„ 6 Ø£Ø±Ù‚Ø§Ù… OTP
â”œâ”€â”€ OTPMethodSelector.tsx    â† Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© OTP (email/SMS)
â”œâ”€â”€ PhoneInput.tsx           â† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¯ÙˆÙ„ÙŠ
â”œâ”€â”€ PWAInstallButton.tsx     â† Ø²Ø± ØªØ«Ø¨ÙŠØª PWA
â”œâ”€â”€ PWAInstallGate.tsx       â† Ø¨ÙˆØ§Ø¨Ø© ØªØ«Ø¨ÙŠØª PWA
â”œâ”€â”€ SEOProvider.tsx          â† Dynamic meta tags
â”œâ”€â”€ SMSVerification.tsx      â† ØªØ­Ù‚Ù‚ SMS
â”œâ”€â”€ SocialLoginButtons.tsx   â† Google/Facebook/Apple login
â””â”€â”€ SplashScreen.tsx         â† Ø´Ø§Ø´Ø© ØªØ­Ù…ÙŠÙ„
```

### 5.4 Hooks Ø§Ù„Ù…Ø®ØµØµØ©

| Hook | Ø§Ù„Ù…Ù„Ù | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|------|-------|---------|
| API Queries | `hooks/api/` | TanStack Query hooks Ù„ÙƒÙ„ endpoint |
| `useApiQueries` | `hooks/useApiQueries.ts` | Query wrappers Ù…Ø¬Ù…Ø¹Ø© |
| `useAutoLogin` | `hooks/useAutoLogin.ts` | ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ (localStorage token) |
| `useChildAuth` | `hooks/useChildAuth.ts` | Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø·ÙÙ„ ÙˆØ³ÙŠØ§Ù‚Ù‡ |
| `useSEO` | `hooks/useSEO.tsx` | Ø¥Ø¹Ø¯Ø§Ø¯ SEO Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ |
| `useSMSOTP` | `hooks/useSMSOTP.ts` | OTP Ø¹Ø¨Ø± SMS |
| `useToast` | `hooks/use-toast.ts` | Toast notifications |
| `useMobile` | `hooks/use-mobile.tsx` | Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ |
| `useUpload` | `hooks/use-upload.ts` | Ø±ÙØ¹ Ù…Ù„ÙØ§Øª |

---

## 6. Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© (Docker)

> **Ø§Ù„Ù…ØµØ¯Ø±:** `docker-compose.yml` â€” 422 Ø³Ø·Ø± Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„

### 6.1 Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª

| # | Ø§Ù„Ø­Ø§ÙˆÙŠØ© | Ø§Ù„ØµÙˆØ±Ø© | Ø§Ù„Ù…Ù†ÙØ° | Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø­Ø¯) | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|---|---------|--------|--------|-------------|---------|
| 1 | `traefik` | traefik:v2.11 | 80, 443 | 256M | Reverse proxy + SSL |
| 2 | `app` | node:20-alpine (custom) | 5000 | 1G | Express + React |
| 3 | `db` | postgres:15.7-alpine | 5433â†’5432 | 512M | PostgreSQL |
| 4 | `redis` | redis:7.2-alpine | internal | 256M | Cache |
| 5 | `portainer` | portainer/portainer-ce | 9000 | 512M | Ø¥Ø¯Ø§Ø±Ø© Docker |
| 6 | `pgadmin` | dpage/pgadmin4 | 5050 | 512M | Ø¥Ø¯Ø§Ø±Ø© PostgreSQL |
| 7 | `redis-commander` | rediscommander | 8081 | 256M | Ù…Ø±Ø§Ù‚Ø¨Ø© Redis |
| 8 | `prometheus` | prom/prometheus | 9090 | 512M | Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ |
| 9 | `grafana` | grafana/grafana | 3000 | 512M | Ù„ÙˆØ­Ø§Øª Ø¨ØµØ±ÙŠØ© |
| 10 | `loki` | grafana/loki | 3100 | 512M | ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª |
| 11 | `mailhog` | mailhog/mailhog | 8025/1025 | 256M | Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ |

**Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø®ØµØµØ©:** ~4.5GB (Ø­Ø¯ÙˆØ¯), ~2.5GB (Ø­Ø¬Ø² Ø£Ø¯Ù†Ù‰)

### 6.2 Traefik Configuration

```yaml
SSL: Let's Encrypt ACME via HTTP challenge
Redirect: HTTP â†’ HTTPS (permanent)
Security Headers:
  - HSTS: 63072000 Ø«Ø§Ù†ÙŠØ© (Ø³Ù†ØªØ§Ù†)
  - stsIncludeSubdomains: true
  - frameDeny: true
  - contentTypeNosniff: true
Healthcheck: wget --spider http://localhost/ping
Access Log: buffer 100 entries
Dashboard: disabled (api.dashboard=false)
```

### 6.3 Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª (Ù…Ù† Traefik labels)

| Ø§Ù„Ø®Ø¯Ù…Ø© | Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† |
|--------|---------|
| App | `classi-fy.com` + `www.classi-fy.com` |
| Portainer | `portainer.classi-fy.com` |
| pgAdmin | `pgadmin.classi-fy.com` |
| Redis Commander | `redis-commander.classi-fy.com` |
| Prometheus | `prometheus.classi-fy.com` |
| Grafana | `grafana.classi-fy.com` |
| Mailhog | `mailhog.classi-fy.com` |

### 6.4 PostgreSQL Config

```
max_connections = 200
shared_buffers = 128MB
log_min_duration_statement = 1000 (slow query > 1s)
Auth: scram-sha-256
Local port: 127.0.0.1:5433 (not exposed externally)
```

### 6.5 Redis Config

```
appendonly: yes (persistence)
maxmemory: 128mb
maxmemory-policy: allkeys-lru
Healthcheck: redis-cli ping
```

### 6.6 Volumes (10)

```
postgres_data, redis_data, app_uploads, app_logs, letsencrypt_data,
portainer_data, pgadmin_data, prometheus_data, grafana_data, loki_data
```

### 6.7 Dockerfile (66 Ø³Ø·Ø± â€” Ù…Ù‚Ø±ÙˆØ¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)

```dockerfile
# Stage 1: Builder
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Stage 2: Runner
FROM node:20-alpine AS runner
WORKDIR /app
RUN addgroup nodejs && adduser -S appuser -G nodejs -u 1001
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/package*.json ./
COPY --from=builder /app/shared ./shared
COPY --from=builder /app/drizzle.config.ts ./
COPY --from=builder /app/scripts ./scripts
COPY --from=builder /app/migrations ./migrations
RUN npm ci --omit=dev && npm install drizzle-kit tsx
USER appuser
EXPOSE 5000
HEALTHCHECK --interval=30s --timeout=3s CMD curl -f http://localhost:5000/api/health || exit 1
ENTRYPOINT ["sh", "./scripts/docker-entrypoint.sh"]
```

**Security:** Non-root user (appuser, UID 1001, group nodejs)

---

## 7. Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†

### 7.1 Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ)

| Ø§Ù„Ø¢Ù„ÙŠØ© | Ø§Ù„ØªÙØ§ØµÙŠÙ„ |
|--------|---------|
| **JWT** | HS256, expiresIn: "30d", secret Ù…Ù† JWT_SECRET env |
| **ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±** | bcrypt 10 rounds |
| **OTP** | 6 Ø£Ø±Ù‚Ø§Ù…, bcrypt hashed ÙÙŠ DB, 5 Ø¯Ù‚Ø§Ø¦Ù‚ ØµÙ„Ø§Ø­ÙŠØ©, 3 Ù…Ø­Ø§ÙˆÙ„Ø§Øª max |
| **Account Locking** | 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø© â†’ Ù‚ÙÙ„ 15 Ø¯Ù‚ÙŠÙ‚Ø© |
| **Trusted Devices** | SHA-256(deviceId+UA+IP), 45 ÙŠÙˆÙ… ØµÙ„Ø§Ø­ÙŠØ©, Ø­Ø¯ 5 Ø£Ø¬Ù‡Ø²Ø© |
| **2FA** | ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ Ø¹Ø¨Ø± twoFAEnabled flag |

### 7.2 Ø§Ù„Ø­Ù…Ø§ÙŠØ©

| Ø§Ù„Ø¢Ù„ÙŠØ© | Ø§Ù„ØªÙØ§ØµÙŠÙ„ |
|--------|---------|
| **Helmet CSP** | self + inline styles + Google Fonts + GCS images |
| **CORS** | configurable Ø¹Ø¨Ø± CORS_ORIGIN (comma-separated) Ù…Ø¹ strict enforcement |
| **Rate Limiting** | 4 limiters (register, login, otp-request, otp-verify) |
| **HTTP Headers** | X-Content-Type-Options: nosniff, X-Frame-Options: DENY, X-XSS-Protection: 1 |
| **Stripe** | Raw body verification Ù„ØªÙˆÙ‚ÙŠØ¹ webhooks |
| **Docker** | Non-root user (UID 1001) |
| **HSTS** | 63072000 Ø«Ø§Ù†ÙŠØ© (Ø³Ù†ØªØ§Ù†) Ø¹Ø¨Ø± Traefik |

### 7.3 ØªÙ†Ù‚ÙŠØ­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©

```javascript
// Keys ÙŠØªÙ… ØªÙ†Ù‚ÙŠØ­Ù‡Ø§ ÙÙŠ error logs (Ù…Ù† server/index.ts Ø³Ø·Ø± 54):
REDACT_KEYS = ["password", "otp", "token", "jwt", "authorization", "cookie", "set-cookie"]
```

### 7.4 Parent-Child Ownership

```
ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø·ÙÙ„ ØªØªØ·Ù„Ø¨:
1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ parentId Ù…Ù† JWT token
2. ÙØ­Øµ parentChild table: UNIQUE(parentId, childId)
3. Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ â†’ UNAUTHORIZED error
4. Cascade delete: Ø­Ø°Ù Ø§Ù„ÙˆØ§Ù„Ø¯ â†’ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
```

---

## 8. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

### Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØªÙˆÙ‚Ù Ø¨Ø¯ÙˆÙ†Ù‡Ø§ â€” server/index.ts Ø³Ø·Ø± 43):

| Ø§Ù„Ù…ØªØºÙŠØ± | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|----------|
| `JWT_SECRET` | ØªÙˆÙ‚ÙŠØ¹ JWT tokens |
| `SESSION_SECRET` | Express sessions |
| `ADMIN_EMAIL` | Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ |
| `ADMIN_PASSWORD` | ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù† |
| `DATABASE_URL` | PostgreSQL connection string |

### Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Docker (docker-compose.yml):

| Ø§Ù„Ù…ØªØºÙŠØ± | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|----------|
| `POSTGRES_USER` | Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… PostgreSQL |
| `POSTGRES_PASSWORD` | ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± PostgreSQL |
| `POSTGRES_DB` | Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§ÙØªØ±Ø§Ø¶ÙŠ: classify_db) |

### Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©:

| Ø§Ù„Ù…ØªØºÙŠØ± | Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|----------|----------|
| `PORT` | 5000 | Ù…Ù†ÙØ° Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ |
| `HOST` | 0.0.0.0 | Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ |
| `NODE_ENV` | â€” | development/production |
| `CORS_ORIGIN` | * | Ø£ØµÙˆÙ„ Ù…Ø³Ù…ÙˆØ­Ø© |
| `RESEND_API_KEY` | â€” | Resend Email API |
| `SMTP_HOST` | â€” | SMTP server |
| `SMTP_PORT` | 587 | SMTP port |
| `SMTP_USER` | â€” | SMTP username |
| `SMTP_PASSWORD` | â€” | SMTP password |
| `SMTP_FROM` | â€” | Send from email |
| `SMTP_SECURE` | â€” | TLS |
| `TWILIO_ACCOUNT_SID` | â€” | Twilio SMS |
| `TWILIO_AUTH_TOKEN` | â€” | Twilio auth |
| `TWILIO_PHONE_NUMBER` | â€” | Twilio from number |
| `REDIS_URL` | redis://redis:6379 | Redis connection |
| `LOG_LEVEL` | info | Pino log level |
| `ADMIN_PANEL_PASSWORD` | â€” | Admin panel extra security |

---

## 9. ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„

### 9.1 ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¯ Ø¬Ø¯ÙŠØ¯

```
POST /api/auth/register { email, password, name, phoneNumber? }
â”œâ”€â”€ Rate limit: registerLimiter (5/min per IP)
â”œâ”€â”€ Validate: email format, password >= 8 chars
â”œâ”€â”€ normalizeEmail(email) â†’ toLowerCase + trim
â”œâ”€â”€ Check: email uniqueness in parents table
â”œâ”€â”€ bcrypt.hash(password, 10)
â”œâ”€â”€ Generate uniqueCode (6 chars uppercase)
â”œâ”€â”€ INSERT INTO parents
â”œâ”€â”€ jwt.sign({ userId, type: "parent" }, JWT_SECRET, { expiresIn: "30d" })
â”œâ”€â”€ Create notification with linking code
â””â”€â”€ Return: { token, userId, uniqueCode }
```

### 9.2 ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Account Locking

```
POST /api/auth/login { email, password }
â”œâ”€â”€ Rate limit: loginLimiter (5/min per IP+email)
â”œâ”€â”€ normalizeEmail(email)
â”œâ”€â”€ SELECT from parents WHERE email = ?
â”œâ”€â”€ Check lockedUntil: Ø¥Ø°Ø§ Ù…Ù‚ÙÙ„ â†’ 403 + Retry-After header
â”œâ”€â”€ bcrypt.compare(password, hash)
â”œâ”€â”€ Ø¥Ø°Ø§ Ø®Ø·Ø£:
â”‚   â”œâ”€â”€ failedLoginAttempts++
â”‚   â”œâ”€â”€ Ø¥Ø°Ø§ >= 5 â†’ lockedUntil = now + 15min
â”‚   â””â”€â”€ Return 401
â”œâ”€â”€ Ø¥Ø°Ø§ ØµØ­:
â”‚   â”œâ”€â”€ Reset failedLoginAttempts = 0, lockedUntil = null
â”‚   â”œâ”€â”€ Check twoFAEnabled:
â”‚   â”‚   â”œâ”€â”€ true â†’ Generate OTP, send via email/SMS
â”‚   â”‚   â”‚         â””â”€â”€ Return: { requires2FA: true, otpSent: true }
â”‚   â”‚   â””â”€â”€ false â†’ jwt.sign() â†’ Return { token }
â”‚   â””â”€â”€ Log to loginHistory
â””â”€â”€ Record session in sessions table
```

### 9.3 OTP Verification Flow

```
POST /api/auth/verify-otp { email, code, purpose }
â”œâ”€â”€ Rate limit: otpVerifyLimiter (5/min per IP+email)
â”œâ”€â”€ SELECT pending OTP WHERE parentId = ? AND purpose = ? AND status = "pending"
â”œâ”€â”€ Check expiry: createdAt + 5min > now
â”œâ”€â”€ bcrypt.compare(code, stored hash)
â”œâ”€â”€ Ø¥Ø°Ø§ Ø®Ø·Ø£:
â”‚   â”œâ”€â”€ incrementAttemptsAtomic()
â”‚   â”œâ”€â”€ Ø¥Ø°Ø§ attempts >= 3 â†’ blockOTP()
â”‚   â””â”€â”€ Return 400
â”œâ”€â”€ Ø¥Ø°Ø§ ØµØ­:
â”‚   â”œâ”€â”€ markVerifiedAtomic()
â”‚   â”œâ”€â”€ Supersede all other pending OTPs
â”‚   â”œâ”€â”€ jwt.sign() â†’ Return { token }
â”‚   â””â”€â”€ Optionally trust device
```

### 9.4 Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø± (Stripe)

```
Parent: POST /api/payments/checkout { items[] }
â”œâ”€â”€ Create Stripe Checkout Session
â”œâ”€â”€ Create storeOrder (status: PENDING, idempotencyKey)
â”œâ”€â”€ Return: { checkoutUrl }

Stripe: POST /api/payments/stripe/webhook
â”œâ”€â”€ Raw body â†’ stripe.webhooks.constructEvent (signature verification)
â”œâ”€â”€ checkout.session.completed:
â”‚   â”œâ”€â”€ Update storeOrder â†’ PAID
â”‚   â”œâ”€â”€ Create transaction record
â”‚   â”œâ”€â”€ Create entitlements per product
â”‚   â””â”€â”€ Deduplicate via webhookEvents.dedupeKey
```

### 9.5 Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§

```
Parent: POST /api/gifts { childId, productId, pointsThreshold }
â”œâ”€â”€ Validate parent owns child
â”œâ”€â”€ Create gift (status: SENT)
â”œâ”€â”€ emit("gift.sent")

System: Child earns points â†’ giftUnlock check
â”œâ”€â”€ SELECT gifts WHERE childId = ? AND status = SENT
â”œâ”€â”€ Check: child.totalPoints >= gift.pointsThreshold
â”œâ”€â”€ If yes:
â”‚   â”œâ”€â”€ Update gift â†’ UNLOCKED
â”‚   â”œâ”€â”€ emit("gift.unlocked")
â”‚   â””â”€â”€ Create notification (modal, urgent, sound + vibration)

Child: POST /api/gifts/:id/activate
â”œâ”€â”€ Update gift â†’ ACTIVATED
â”œâ”€â”€ emit("gift.activated")
â””â”€â”€ Create notification (toast)
```

---

## 10. Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù„ÙØ§Øª

```
ğŸ“ Ø§Ù„Ø¬Ø°Ø± (classi-fy.com)
â”œâ”€â”€ package.json              â† 164 Ø³Ø·Ø±, 80+ dependency, ESM module
â”œâ”€â”€ tsconfig.json             â† 35 Ø³Ø·Ø±, strict, ES2020 target
â”œâ”€â”€ vite.config.ts            â† 42 Ø³Ø·Ø±, client/ root, dist/public output
â”œâ”€â”€ drizzle.config.ts         â† 15 Ø³Ø·Ø±, PostgreSQL, ./migrations
â”œâ”€â”€ Dockerfile                â† 66 Ø³Ø·Ø±, multi-stage, node:20-alpine
â”œâ”€â”€ docker-compose.yml        â† 422 Ø³Ø·Ø±, 11 services
â”œâ”€â”€ deploy.sh                 â† VPS deployment script
â”œâ”€â”€ capacitor.config.json     â† Mobile config (classi-fy.com)
â”‚
â”œâ”€â”€ ğŸ“ shared/
â”‚   â””â”€â”€ schema.ts             â† 1,471 Ø³Ø·Ø± â€” 85+ Ø¬Ø¯ÙˆÙ„, 64+ ÙÙ‡Ø±Ø³, Zod schemas
â”‚
â”œâ”€â”€ ğŸ“ server/
â”‚   â”œâ”€â”€ index.ts              â† 301 Ø³Ø·Ø± â€” Express entry, Helmet, CORS, graceful shutdown
â”‚   â”œâ”€â”€ storage.ts            â† 35 Ø³Ø·Ø± â€” pg Pool + Drizzle singleton
â”‚   â”œâ”€â”€ static.ts             â† 85 Ø³Ø·Ø± â€” Static serving + SPA fallback + caching
â”‚   â”œâ”€â”€ vite.ts               â† Vite dev server integration (HMR)
â”‚   â”œâ”€â”€ mailer.ts             â† 184 Ø³Ø·Ø± â€” Resend + SMTP
â”‚   â”œâ”€â”€ sms-otp.ts            â† Twilio SMS
â”‚   â”œâ”€â”€ notificationHandlers.ts â† 94 Ø³Ø·Ø± â€” Gift event â†’ notification
â”‚   â”œâ”€â”€ giftEvents.ts         â† EventEmitter
â”‚   â”œâ”€â”€ giftUnlock.ts         â† Gift unlock logic
â”‚   â”œâ”€â”€ notifications.ts      â† createNotification()
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ routes/ (20 Ù…Ù„ÙØ§Øª)
â”‚   â”‚   â”œâ”€â”€ index.ts           â† 69 Ø³Ø·Ø± â€” 18 route groups + health check
â”‚   â”‚   â”œâ”€â”€ middleware.ts      â† 55 Ø³Ø·Ø± â€” authMiddleware + adminMiddleware
â”‚   â”‚   â”œâ”€â”€ auth.ts            â† 2,533 Ø³Ø·Ø± â€” Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
â”‚   â”‚   â”œâ”€â”€ admin.ts           â† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†/Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª/Ø§Ù„Ø·Ù„Ø¨Ø§Øª
â”‚   â”‚   â”œâ”€â”€ admin.settings.ts  â† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
â”‚   â”‚   â”œâ”€â”€ admin-activity.ts  â† Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·
â”‚   â”‚   â”œâ”€â”€ admin-analytics.ts â† Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
â”‚   â”‚   â”œâ”€â”€ admin-gifts.ts     â† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§
â”‚   â”‚   â”œâ”€â”€ admin-notification-settings.ts â† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
â”‚   â”‚   â”œâ”€â”€ parent.ts          â† endpoints Ø§Ù„ÙˆØ§Ù„Ø¯
â”‚   â”‚   â”œâ”€â”€ child.ts           â† endpoints Ø§Ù„Ø·ÙÙ„
â”‚   â”‚   â”œâ”€â”€ payments.ts        â† Stripe checkout + webhooks
â”‚   â”‚   â”œâ”€â”€ store.ts           â† Ø§Ù„Ù…ØªØ¬Ø± (Ù…Ù†ØªØ¬Ø§Øª, Ø·Ù„Ø¨Ø§Øª, ÙØ¦Ø§Øª)
â”‚   â”‚   â”œâ”€â”€ referrals.ts       â† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
â”‚   â”‚   â”œâ”€â”€ library.ts         â† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª/Ø§Ù„ØªØ¬Ø§Ø±
â”‚   â”‚   â”œâ”€â”€ media-uploads.ts   â† Ø±ÙØ¹ ÙˆØ³Ø§Ø¦Ø· (MinIO)
â”‚   â”‚   â”œâ”€â”€ trusted-devices.ts â† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚Ø©
â”‚   â”‚   â”œâ”€â”€ ads.ts             â† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
â”‚   â”‚   â”œâ”€â”€ parent-linking.ts  â† Ø±Ø¨Ø· Ø§Ù„Ø¢Ø¨Ø§Ø¡ Ø¨Ø§Ù„Ø£Ø·ÙØ§Ù„
â”‚   â”‚   â””â”€â”€ ğŸ“ __tests__/      â† Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Route
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ services/
â”‚   â”‚   â”œâ”€â”€ otpService.ts      â† 201 Ø³Ø·Ø± â€” OTP generation/verification
â”‚   â”‚   â”œâ”€â”€ pointsService.ts   â† Ø­Ø³Ø§Ø¨ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·
â”‚   â”‚   â”œâ”€â”€ uploadService.ts   â† Ø±ÙØ¹ Ù…Ù„ÙØ§Øª
â”‚   â”‚   â””â”€â”€ mediaWorker.ts     â† Background media cleanup
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ utils/
â”‚   â”‚   â”œâ”€â”€ apiResponse.ts     â† 76 Ø³Ø·Ø± â€” Response helpers + ErrorCode enum
â”‚   â”‚   â”œâ”€â”€ rateLimiters.ts    â† 42 Ø³Ø·Ø± â€” 4 rate limiters
â”‚   â”‚   â””â”€â”€ otpMonitoring.ts   â† OTP event tracking
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ providers/otp/
â”‚       â”œâ”€â”€ bootstrap.ts       â† Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø²ÙˆØ¯ÙŠ OTP Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ†
â”‚       â””â”€â”€ providerFactory.ts â† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø²ÙˆØ¯ (email/sms)
â”‚
â”œâ”€â”€ ğŸ“ client/src/
â”‚   â”œâ”€â”€ App.tsx               â† 232 Ø³Ø·Ø± â€” Router (39 routes), Providers
â”‚   â”œâ”€â”€ main.tsx              â† Entry point
â”‚   â”œâ”€â”€ ğŸ“ pages/ (39 Ù…Ù„Ù)
â”‚   â”‚   â”œâ”€â”€ Home.tsx, ParentAuth.tsx, ChildLink.tsx (eager)
â”‚   â”‚   â”œâ”€â”€ ParentDashboard.tsx ... ParentTasks.tsx (13 parent pages, lazy)
â”‚   â”‚   â”œâ”€â”€ ChildGames.tsx ... ChildSettings.tsx (9 child pages, lazy)
â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx, AdminAuth.tsx, AdminPurchasesTab.tsx (admin)
â”‚   â”‚   â”œâ”€â”€ LibraryLogin.tsx, LibraryDashboard.tsx, LibraryStore.tsx (library)
â”‚   â”‚   â”œâ”€â”€ OTPVerification.tsx, ForgotPassword.tsx (auth flow)
â”‚   â”‚   â”œâ”€â”€ Privacy.tsx, PrivacyPolicy.tsx, AccessibilityPolicy.tsx, Terms.tsx
â”‚   â”‚   â””â”€â”€ not-found.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ components/ (50+)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/ (20+ shadcn components)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ admin/ â€” Admin panel components
â”‚   â”‚   â”œâ”€â”€ ğŸ“ child/ â€” Child-specific UI
â”‚   â”‚   â”œâ”€â”€ ğŸ“ dashboard/ â€” Dashboard widgets
â”‚   â”‚   â”œâ”€â”€ ğŸ“ forms/ â€” Form components
â”‚   â”‚   â”œâ”€â”€ ğŸ“ notifications/ â€” Notification UI
â”‚   â”‚   â””â”€â”€ 20+ top-level components
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ hooks/ (10+)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/ â€” TanStack Query hooks
â”‚   â”‚   â””â”€â”€ useAutoLogin, useChildAuth, useSEO, useSMSOTP, etc.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ contexts/ â€” ThemeContext
â”‚   â”œâ”€â”€ ğŸ“ i18n/ â€” Arabic/English translations
â”‚   â””â”€â”€ ğŸ“ lib/ â€” queryClient, utils
â”‚
â”œâ”€â”€ ğŸ“ scripts/
â”‚   â”œâ”€â”€ manage-admin.js       â† npm run admin:setup / admin:reset
â”‚   â”œâ”€â”€ docker-entrypoint.sh  â† Container start script
â”‚   â”œâ”€â”€ check_env.sh          â† Environment validation
â”‚   â””â”€â”€ check_env_dynamic.cjs â† Dynamic env check
â”‚
â”œâ”€â”€ ğŸ“ monitoring/
â”‚   â”œâ”€â”€ prometheus.yml        â† Prometheus scrape config
â”‚   â”œâ”€â”€ loki-config.yml       â† Loki aggregation
â”‚   â””â”€â”€ ğŸ“ grafana/provisioning/ â† Grafana datasources
â”‚
â”œâ”€â”€ ğŸ“ migrations/            â† Drizzle migration files
â”œâ”€â”€ ğŸ“ android/               â† Capacitor Android project
â”œâ”€â”€ ğŸ“ ios/                   â† Capacitor iOS project
â””â”€â”€ ğŸ“ nginx/                 â† Nginx config (alternative to Traefik)
```

---

## 11. Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ´ØºÙŠÙ„

```bash
# === ØªØ·ÙˆÙŠØ± ===
npm install                    # ØªØ«Ø¨ÙŠØª ÙƒÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
npm run dev                    # ØªØ´ØºÙŠÙ„ dev server (Express + Vite HMR)
npm run db:push                # Ù…Ø²Ø§Ù…Ù†Ø© schema.ts Ù…Ø¹ PostgreSQL

# === Ø¥Ù†ØªØ§Ø¬ ===
npm run build                  # Ø¨Ù†Ø§Ø¡ frontend (Vite) + backend (esbuild)
npm run start                  # NODE_ENV=production node dist/index.js

# === Ø¥Ø¯Ø§Ø±Ø© ===
npm run admin:setup            # Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ù† .env
npm run check-env              # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

# === Ø§Ø®ØªØ¨Ø§Ø± ===
npm run test                   # Vitest run

# === Docker (Ø¥Ù†ØªØ§Ø¬) ===
docker-compose up -d --build              # Ø¨Ù†Ø§Ø¡ ÙˆØªØ´ØºÙŠÙ„ 11 Ø­Ø§ÙˆÙŠØ©
docker-compose logs -f app                # Ø¹Ø±Ø¶ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
docker-compose exec app npm run db:push   # ØªØ´ØºÙŠÙ„ migrations
docker-compose down                       # Ø¥ÙŠÙ‚Ø§Ù ÙƒÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
docker-compose restart app                # Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙ‚Ø·

# === ØµÙŠØ§Ù†Ø© ===
docker system prune -af                   # ØªÙ†Ø¸ÙŠÙ Docker
docker volume ls                          # Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
```

---

## 12. Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ

| Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ | Ø§Ù„Ø±Ù‚Ù… | Ø§Ù„Ù…ØµØ¯Ø± |
|---------|-------|--------|
| **Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª** | 85+ | shared/schema.ts |
| **ÙÙ‡Ø§Ø±Ø³ Ù…Ø­Ø³Ù†Ø©** | 64+ | shared/schema.ts |
| **Ø£Ø³Ø·Ø± schema.ts** | 1,471 | Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© |
| **Ø£Ø³Ø·Ø± auth.ts** | 2,533 | Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© |
| **Ø£Ø³Ø·Ø± server/index.ts** | 301 | Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© |
| **Ø£Ø³Ø·Ø± App.tsx** | 232 | Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© |
| **Ø£Ø³Ø·Ø± docker-compose.yml** | 422 | Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© |
| **Route files** | 20 Ù…Ù„Ù | server/routes/ |
| **Route groups Ù…Ø³Ø¬Ù„Ø©** | 18 | server/routes/index.ts |
| **ØµÙØ­Ø§Øª Frontend** | 39 | client/src/App.tsx |
| **Ù…ÙƒÙˆÙ†Ø§Øª UI** | 50+ | client/src/components/ |
| **Hooks Ù…Ø®ØµØµØ©** | 10+ | client/src/hooks/ |
| **Ø­Ø§ÙˆÙŠØ§Øª Docker** | 11 | docker-compose.yml |
| **Ø®Ø¯Ù…Ø§Øª Backend** | 14+ | server/services/ + utils/ |
| **Dependencies** | 80+ | package.json |
| **DevDependencies** | 20+ | package.json |
| **Ø£Ø¯ÙˆØ§Øª Ù…Ø±Ø§Ù‚Ø¨Ø©** | 7 | docker-compose.yml |
| **Volumes** | 10 | docker-compose.yml |
| **Rate Limiters** | 4 | server/utils/rateLimiters.ts |
| **Error Codes** | 12 | server/utils/apiResponse.ts |
| **Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª ÙØ±Ø¹ÙŠØ©** | 7 | docker-compose.yml labels |

---

> **Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:** Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ø¨Ù†ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ **Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ Ø§Ù„ÙØ¹Ù„ÙŠ** â€” Ù„Ø§ ØªØ®Ù…ÙŠÙ†ØŒ Ù„Ø§ Ø§ÙØªØ±Ø§Ø¶ØŒ Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØªØ¯Ø±ÙŠØ¨. ÙƒÙ„ Ø±Ù‚Ù… ÙˆÙƒÙ„ Ø³Ø·Ø± ÙˆÙƒÙ„ ÙˆØ¸ÙŠÙØ© Ù…Ø£Ø®ÙˆØ°Ø© Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.
