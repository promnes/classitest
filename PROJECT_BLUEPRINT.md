# ğŸ¯ CLASSIFY - Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
**Version:** 2.0  
**Updated:** January 2025  
**Purpose:** Complete project knowledge base for simultaneous understanding of entire codebase architecture, features, and workflows.

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
1. [Ù…Ù‚Ø¯Ù…Ø© Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹](#1ï¸âƒ£-Ù…Ù‚Ø¯Ù…Ø©-Ø¹Ù†-Ø§Ù„Ù…Ø´Ø±ÙˆØ¹)
2. [Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©](#2ï¸âƒ£-Ø§Ù„Ø¨Ù†ÙŠØ©-Ø§Ù„ØªØ­ØªÙŠØ©)
3. [Ù‡Ù†Ø¯Ø³Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª](#3ï¸âƒ£-Ù‡Ù†Ø¯Ø³Ø©-Ù‚Ø§Ø¹Ø¯Ø©-Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
4. [Ø®Ø±ÙŠØ·Ø© API Ø§Ù„ÙƒØ§Ù…Ù„Ø©](#4ï¸âƒ£-Ø®Ø±ÙŠØ·Ø©-api-Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
5. [Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©](#5ï¸âƒ£-Ù…Ø¹Ù…Ø§Ø±ÙŠØ©-Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©-Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©)
6. [ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª](#6ï¸âƒ£-ØªØ¯ÙÙ‚Ø§Øª-Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…-ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª)
7. [Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©](#7ï¸âƒ£-Ø§Ù„Ø£Ù…Ø§Ù†-ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
8. [Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø©](#8ï¸âƒ£-Ø§Ù„ÙƒÙˆØ¯-ÙˆØ§Ù„Ù…Ù„ÙØ§Øª-Ø§Ù„Ø­Ø±Ø¬Ø©)
9. [Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ·ÙˆÙŠØ±](#9ï¸âƒ£-Ø§Ù„Ø¯Ù„ÙŠÙ„-Ø§Ù„Ø³Ø±ÙŠØ¹-Ù„Ù„ØªØ·ÙˆÙŠØ±)

---

## 1ï¸âƒ£ Ù…Ù‚Ø¯Ù…Ø© Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

### ğŸ“ Ù…Ø§Ø°Ø§ Ù‡Ùˆ ClassifyØŸ
ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø±Ø¨ÙŠ **Ù…ØªØ·ÙˆØ±** Ù„Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ø£Ø¨ÙˆÙŠØ© ÙŠÙ…ÙƒÙ‘Ù† Ø§Ù„Ø¢Ø¨Ø§Ø¡ Ù…Ù†:
- âœ… Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø£Ø·ÙØ§Ù„Ù‡Ù…
- âœ… Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ù…Ù‡Ø§Ù… ØªØ¹Ù„ÙŠÙ…ÙŠØ©
- âœ… Ù†Ø¸Ø§Ù… Ù…ÙƒØ§ÙØ¢Øª Ù‚Ø§Ø¦Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·
- âœ… Ù…ØªØ¬Ø± Ø±Ù‚Ù…ÙŠ ÙˆÙÙŠØ²ÙŠØ§Ø¦ÙŠ
- âœ… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¯ÙØ¹ Ø¢Ù…Ù†Ø©
- âœ… Ù†Ø¸Ø§Ù… Ø¥Ø­Ø§Ù„Ø§Øª ÙˆØ¹Ù…ÙˆÙ„Ø§Øª
- âœ… Ù†Ø¸Ø§Ù… Ù‡Ø¯Ø§ÙŠØ§ Ù…ØªÙ‚Ø¯Ù…

### ğŸ‘¥ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
| Ø§Ù„ÙØ¦Ø© | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ø£Ø¯ÙˆØ§Ø± |
|------|-------|--------|
| **Ø¢Ø¨Ø§Ø¡** | Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ† Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠÙŠÙ† | Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ø§Ù…ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø£Ø·ÙØ§Ù„ØŒ Ø¹Ù…Ù„ÙŠØ§Øª Ø´Ø±Ø§Ø¡ |
| **Ø£Ø·ÙØ§Ù„** | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠÙˆÙ† | Ø­Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…ØŒ Ø¬Ù†ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·ØŒ Ø§Ù„Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø± |
| **Ù…Ø³Ø¤ÙˆÙ„Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…** | Ø¥Ø¯Ø§Ø±ÙŠÙˆÙ† Ø§Ù„Ù…Ù†ØµØ© | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŒ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©ØŒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© |
| **Ø§Ù„ØªØ¬Ø§Ø± (Ù…ÙƒØªØ¨Ø§Øª)** | Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ | Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬Ø§ØªØŒ ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª |

### ğŸ—‚ï¸ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ
```
Classify
â”œâ”€â”€ Frontend (React + Vite)
â”‚   â”œâ”€â”€ Parent Dashboard
â”‚   â”œâ”€â”€ Child App
â”‚   â””â”€â”€ Admin Panel
â”œâ”€â”€ Backend (Express.js)
â”‚   â”œâ”€â”€ Authentication Routes
â”‚   â”œâ”€â”€ Family Management
â”‚   â”œâ”€â”€ Tasks & Rewards
â”‚   â”œâ”€â”€ Store & Payments
â”‚   â””â”€â”€ Admin Operations
â”œâ”€â”€ Database (PostgreSQL)
â”‚   â””â”€â”€ 80+ Tables with 64 Optimized Indexes
â”œâ”€â”€ Infrastructure
â”‚   â”œâ”€â”€ Docker Compose (4 core + 7 monitoring containers)
â”‚   â”œâ”€â”€ Traefik (Reverse proxy)
â”‚   â””â”€â”€ Redis (Cache)
â””â”€â”€ External Services
    â”œâ”€â”€ Resend (Email)
    â”œâ”€â”€ Twilio (SMS)
    â””â”€â”€ Stripe (Payments)
```

---

## 2ï¸âƒ£ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©

### ğŸ³ Docker Architecture

#### Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© (Hostinger VPS)
**Ø§Ù„Ø®Ø§Ø¯Ù…:** `srv1118737.hstgr.cloud:5000`  
**Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:** `classitest`

#### Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (4)
```yaml
classiv3-app:
  Ports: 5000 (Express.js Backend)
  Role: Core API Server
  Restart: always

classiv3-db:
  Ports: 5433 (PostgreSQL, mapped from 5432)
  Role: Primary Data Store
  Provider: Neon PostgreSQL (cloud-hosted)
  Restart: always

classiv3-redis:
  Ports: 6379
  Role: Cache Layer
  Image: redis:7.2-alpine
  Restart: always

classiv3-traefik:
  Ports: 80:80, 443:443
  Role: Reverse Proxy & SSL Termination
  Manager: Docker Labels
  Healthcheck: âœ… FIXED (wget-based)
  Restart: always
```

#### Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (7)
| Ø£Ø¯Ø§Ø© | Ø§Ù„Ù…Ù†ÙØ° | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|------|--------|--------|
| **Portainer** | 9000 | Ø¥Ø¯Ø§Ø±Ø© Docker |
| **pgAdmin** | 5050 | Ø¥Ø¯Ø§Ø±Ø© PostgreSQL |
| **Redis Commander** | 8081 | ØªØµÙˆØ± Ø¨ÙŠØ§Ù†Ø§Øª Redis |
| **Prometheus** | 9090 | Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ |
| **Grafana** | 3000 | Ù„ÙˆØ­Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© |
| **Loki** | 3100 | ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª |
| **Mailhog** | 8025 | Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ |

### ğŸ”§ Traefik Healthcheck (ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­)
```bash
# Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø®Ø§Ø·Ø¦):
traefik healthcheck --ping

# Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ØµØ­ÙŠØ­):
wget --no-verbose --tries=1 --spider http://localhost/ping
```

### ğŸŒ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø´Ø¨ÙƒØ© HTTPS
```
Traefik HTTPS Labels:
  traefik.enable: true
  traefik.http.routers.{service}.entrypoints: websecure
  traefik.http.routers.{service}.tls.certresolver: letsencrypt
  traefik.http.services.{service}.loadbalancer.server.port: {PORT}
```

---

## 3ï¸âƒ£ Ù‡Ù†Ø¯Ø³Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### ğŸ“Š Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

#### ğŸ‘¨ğŸ‘©ğŸ‘§ğŸ‘¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (8 Ø¬Ø¯Ø§ÙˆÙ„)
```typescript
parents â”€â”€â”€â”€â”€â”¬â”€> children â”€â”€â”€â”€â”€â”¬â”€> childGrowthTrees
             â”‚                  â”œâ”€> childGrowthEvents
             â”‚                  â”œâ”€> childTrustedDevices
             â”‚                  â””â”€> childNotificationSettings
             â”‚
             â”œâ”€> trustedDevices (Cookies/Tokens)
             â”œâ”€> trustedDevicesParent (Device Management)
             â”œâ”€> sessions
             â””â”€> loginHistory

// Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø©:
parents:
  - email: ÙØ±ÙŠØ¯ØŒ lowercase indexed
  - password: bcrypt hashed
  - twoFAEnabled: Ø¹Ù„Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ
  - uniqueCode: ÙƒÙˆØ¯ Ø±Ø¨Ø· Ø§Ù„Ø£Ø·ÙØ§Ù„
  - failedLoginAttempts: Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ØºØ§Ø´Ù…Ø©

children:
  - totalPoints: Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
  - avatarUrl: ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
  - privacyAccepted: Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†
```

#### ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ (12 Ø¬Ø¯ÙˆÙ„)
```typescript
subjects (Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©):
  - name, nameAr
  - emoji, color
  - isActive

templateTasks (Ù‚ÙˆØ§Ù„Ø¨):
  - question, answers (JSON Ù…Ø¹ isCorrect)
  - pointsReward
  - createdByParent, isPublic

tasks (Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø®ØµØµØ©):
  parentId â†’ childId
  subjectId (optional)
  status: pending | completed | failed

taskResults (Ø§Ù„Ù†ØªØ§Ø¦Ø¬):
  taskId â†’ childId
  isCorrect: boolean
  pointsEarned: integer
```

#### ğŸ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ (14 Ø¬Ø¯ÙˆÙ„)
```typescript
products (Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª):
  - pointsPrice: Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·
  - price + originalPrice (Ù„Ù„Ø¹Ù…Ù„Ø§Øª)
  - stock, rating, reviewCount
  - productType: digital | physical | subscription

childGifts (Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ù…Ø±Ø³Ù„Ø©):
  parentId â†’ childId â†’ productId
  status: pending | delivered | acknowledged

gifts (Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª):
  pointsThreshold: Ù†Ù‚Ø§Ø· Ø§Ù„ÙØªØ­
  status: SENT | UNLOCKED | ACTIVATED | REVOKED

childAssignedProducts (Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©):
  progressPoints: Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©
  status: active | completed | shipment_requested | shipped

shippingRequests (Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù†):
  status: requested | approved | shipped | cancelled
```

#### ğŸ’³ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (12 Ø¬Ø¯ÙˆÙ„)
```typescript
storeOrders (Ø§Ù„Ø·Ù„Ø¨Ø§Øª):
  parentId
  status: PENDING | PAYMENT_INITIATED | PAID | FAILED | REFUNDED
  stripeSessionId: Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø© Stripe

orderItems (Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø¨):
  orderId â†’ productId â†’ priceTierId
  quantity, unitAmount

transactions (Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª):
  provider: stripe
  providerRef: payment_intent ID
  status: pending | completed | failed | refunded

wallets (Ø§Ù„Ù…Ø­Ø§ÙØ¸):
  parentId (ÙØ±ÙŠØ¯)
  balance: Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ
  currency: USD/SAR/etc

walletTransfers (Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­ÙØ¸Ø©):
  walletId
  type: DEPOSIT | REFUND | SPEND
  amount, reason

webhookEvents (Ø£Ø­Ø¯Ø§Ø« Webhook):
  provider: stripe
  dedupeKey: Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø¯Ø« Ø§Ù„ÙØ±ÙŠØ¯
  signatureVerified: ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
```

#### ğŸ” Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (4 Ø¬Ø¯Ø§ÙˆÙ„)
```typescript
admins (Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø³Ø¤ÙˆÙ„ÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…):
  email (ÙØ±ÙŠØ¯)
  password: bcrypt hashed
  role: superadmin | moderator | support

socialLoginProviders (Ù…Ø²ÙˆØ¯Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„):
  provider: google | facebook | apple | twitter
  clientId, clientSecret
  isActive: boolean

otpProviders (Ù…Ø²ÙˆØ¯Ùˆ OTP):
  provider: email | sms
  settings: JSON (Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ØŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ù† ØµØ¯Ø±)
  codeLength: 6
  expiryMinutes: 5
  maxAttempts: 3

parentSocialIdentities (Ù‡ÙˆÙŠØ§Øª ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„):
  parentId â†’ provider (google, facebook, etc.)
  providerId, accessToken, refreshToken
```

#### ğŸ¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (8 Ø¬Ø¯Ø§ÙˆÙ„)
```typescript
referrals (Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª):
  referrerId â†’ referredId
  referralCode, status: pending | active | rewarded
  pointsAwarded, activatedAt

parentReferralCodes (Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©):
  parentId (ÙØ±ÙŠØ¯)
  code, totalReferrals, activeReferrals
  totalPointsEarned

profitTransactions (Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø±Ø¨Ø­):
  sellerId â†’ buyerId
  templateTaskId
  totalPoints, sellerEarnings, appCommission

libraries (Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª/Ø§Ù„ØªØ¬Ø§Ø±):
  username, password: bcrypt
  referralCode, commissionRatePct
  activityScore, totalProducts, totalSales

libraryProducts (Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø©):
  libraryId â†’ productId
  price, discount, stock

libraryDailySales (Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©):
  libraryId, saleDate
  totalSalesAmount, totalPointsSales
  commissionAmount, isPaid
```

#### ğŸ“¢ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (8 Ø¬Ø¯Ø§ÙˆÙ„)
```typescript
notifications (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª):
  parentId | childId
  type, title, message
  style: toast | modal | banner | fullscreen
  priority: normal | warning | urgent | blocking
  soundAlert, vibration
  isRead, readAt

childNotificationSettings (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª):
  childId (ÙØ±ÙŠØ¯)
  mode: popup_strict | popup_soft | floating_bubble
  repeatDelayMinutes

childGifts (Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø£Ø·ÙØ§Ù„):
  parentId â†’ childId â†’ productId
  status: pending | delivered | acknowledged

childEvents (Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø·ÙØ§Ù„):
  childId
  eventType: GIFT_ASSIGNED | TASK_ASSIGNED
  isAcknowledged, acknowledgedAt

broadcastNotifications (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬Ù‡Ø©):
  adminId
  targetAudience: all | parents | children
  priority, recipientCount

childAds (Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„):
  contentType: image | video | link | code
  pointsReward, watchDurationSeconds

parentAds (Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¢Ø¨Ø§Ø¡):
  contentType: similar

adWatchHistory (Ø³Ø¬Ù„ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª):
  childId | parentId â†’ adId
  watchedDuration, isCompleted
```

#### âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù… (12 Ø¬Ø¯ÙˆÙ„)
```typescript
appSettings (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©):
  key: ÙØ±ÙŠØ¯ØŒ value

rewardsSettings (Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª):
  pointsPerTask, dailyLimit

tasksSettings (Ø§Ù„Ù…Ù‡Ø§Ù…):
  maxTasksPerDay, allowCustomTasks

storeSettings (Ø§Ù„Ù…ØªØ¬Ø±):
  storeEnabled, minPointsToBuy

notificationSettings (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª):
  enablePush, enableEmail

paymentSettings (Ø§Ù„Ø¯ÙØ¹):
  paymentEnabled, gateway

seoSettings (SEO):
  siteTitle, siteDescription, keywords
  ogTitle, ogDescription, ogImage
  robotsIndex, robotsFollow
  googleAnalyticsId, facebookPixelId

supportSettings (Ø§Ù„Ø¯Ø¹Ù…):
  supportEmail, supportPhone
  whatsappNumber, telegramUsername
  workingHours, timezone
  emergencyMessage, maintenanceMode

themeSettings (Ø§Ù„Ø«ÙŠÙ…):
  primaryColor, secondaryColor, accentColor

activityLog (Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·):
  adminId
  action: create | update | delete
  entity, entityId, meta
```

#### ğŸ“ ÙˆØ³Ø§Ø¦Ø· ÙˆÙ…Ù„ÙØ§Øª (4 Ø¬Ø¯Ø§ÙˆÙ„)
```typescript
media (Ø§Ù„Ù…Ù„ÙØ§Øª):
  objectKey: path ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†
  url: Ø±Ø§Ø¨Ø· Ø¹Ø§Ù…
  storageProvider: object_storage
  mimeType, size, checksum
  width, height, durationMs
  ownerType | ownerId: Ø§Ù„Ù…Ù„ÙƒÙŠØ©
  scanStatus: pending | clean | blocked

mediaReferences (Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª):
  mediaId â†’ entityType/entityId
  field: entity field name

mediaEvents (Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù„ÙØ§Øª):
  mediaId, action: viewed | deleted | scanned
```

### ğŸ“Š Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© (64 ÙÙ‡Ø±Ø³)
- âœ… Unique indexes Ø¹Ù„Ù‰: email, username, codes
- âœ… Composite indexes Ø¹Ù„Ù‰: parentId+childId, status+createdAt
- âœ… Partial indexes Ø¹Ù„Ù‰: pending OTPs, active sessions
- âœ… BRIN indexes Ø¹Ù„Ù‰: timestamp fields (created_at, updated_at)
- âœ… GIN indexes Ø¹Ù„Ù‰: JSON fields (metadata, settings, answers)

---

## 4ï¸âƒ£ Ø®Ø±ÙŠØ·Ø© API Ø§Ù„ÙƒØ§Ù…Ù„Ø©

### ğŸ” Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Authentication Routes)

#### ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
```http
POST /api/auth/register
Body: {
  email: "parent@example.com",
  password: "secure123",
  name: "Ø§Ù„Ø£Ø¨ Ù…Ø­Ù…Ø¯",
  phoneNumber: "+966501234567" (optional)
}
Response: {
  success: true,
  data: {
    id: "parent-uuid",
    email: "parent@example.com",
    token: "jwt-token",
    refreshToken: "refresh-token"
  }
}

POST /api/auth/login
Body: {
  email: "parent@example.com",
  password: "secure123",
  deviceId: "device-hash"
}
Response: {
  success: true,
  data: {
    token: "jwt-token",
    refreshToken: "refresh-token",
    parent: { id, email, name }
  }
}

POST /api/auth/logout
Response: { success: true }
```

#### Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ (2FA) Ùˆ OTP
```http
POST /api/auth/send-otp
Body: {
  email: "parent@example.com",
  purpose: "login" | "password_reset" | "sms_verification",
  method: "email" | "sms"
}
Response: {
  success: true,
  message: "OTP sent successfully",
  expiresIn: 300 (seconds)
}

POST /api/auth/verify-otp
Body: {
  email: "parent@example.com",
  code: "123456",
  purpose: "login"
}
Response: {
  success: true,
  data: {
    token: "jwt-token",
    parent: { id, email, name }
  }
}

POST /api/auth/request-otp
Body: {
  email: "parent@example.com"
}
Response: { success: true }
```

#### Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚Ø©
```http
POST /api/auth/trust-device
Body: {
  deviceId: "device-hash",
  deviceLabel: "Chrome on Windows",
  expiresDays: 45
}
Response: {
  success: true,
  data: { trustedDeviceId: "uuid" }
}

GET /api/auth/trusted-devices
Response: {
  success: true,
  data: [
    {
      id: "uuid",
      deviceLabel: "Chrome on Windows",
      lastUsedAt: "2025-01-15T10:00:00Z",
      createdAt: "2025-01-01T10:00:00Z"
    }
  ]
}

DELETE /api/auth/trusted-devices/:id
Response: { success: true }
```

#### ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
```http
POST /api/auth/social-login
Body: {
  provider: "google" | "facebook" | "apple",
  token: "provider-token"
}
Response: {
  success: true,
  data: {
    id: "parent-uuid",
    token: "jwt-token",
    isNewUser: true | false
  }
}

POST /api/auth/link-social
Body: {
  provider: "google",
  token: "provider-token"
}
Response: {
  success: true,
  data: { linkedProvider: "google" }
}
```

### ğŸ‘¨ğŸ‘©ğŸ‘§ğŸ‘¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© (Family Routes)

#### Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„
```http
GET /api/family/children
Response: {
  success: true,
  data: [
    {
      id: "child-uuid",
      name: "Ø£Ø­Ù…Ø¯",
      totalPoints: 500,
      avatarUrl: "https://..."
    }
  ]
}

POST /api/family/children
Body: {
  name: "ÙØ§Ø·Ù…Ø©",
  birthday: "2015-01-01",
  schoolName: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†ÙˆØ±",
  academicGrade: "Grade 5"
}
Response: {
  success: true,
  data: { id: "child-uuid", uniqueCode: "ABC123" }
}

PUT /api/family/children/:id
Body: {
  name: "ÙØ§Ø·Ù…Ø© Ù…Ø­Ù…Ø¯",
  avatarUrl: "https://...",
  hobbies: "Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø©"
}
Response: { success: true, data: { ...updatedChild } }

DELETE /api/family/children/:id
Response: { success: true }
```

#### Ø±Ø¨Ø· Ø§Ù„Ø¢Ø¨Ø§Ø¡ ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„
```http
POST /api/family/link
Body: {
  code: "ABC123" // Code from child's parent account
}
Response: {
  success: true,
  message: "Child linked successfully"
}

POST /api/family/generate-linking-code
Response: {
  success: true,
  data: {
    code: "XYZ789",
    qrCodeUrl: "https://...",
    expiresAt: "2025-01-20T00:00:00Z"
  }
}

GET /api/family/linked-parents
Response: {
  success: true,
  data: [
    {
      parentId: "uuid",
      name: "Ø§Ù„Ø£Ù… Ø³Ø§Ø±Ø©",
      syncStatus: "active"
    }
  ]
}
```

### ğŸ“š Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ (Tasks Routes)

#### Ø§Ù„Ù…Ù‡Ø§Ù…
```http
GET /api/tasks?childId=<id>&status=pending,completed&limit=10
Response: {
  success: true,
  data: [
    {
      id: "task-uuid",
      question: "Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ",
      imageUrl: "https://...",
      answers: [
        { id: "1", text: "Ø§Ù„Ø±ÙŠØ§Ø¶", isCorrect: true },
        { id: "2", text: "Ø¬Ø¯Ø©", isCorrect: false }
      ],
      pointsReward: 10,
      status: "pending",
      createdAt: "2025-01-15T10:00:00Z"
    }
  ]
}

POST /api/tasks
Body: {
  childId: "child-uuid",
  question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø£Ù„ÙŠÙØŸ",
  answers: [
    { id: "1", text: "Ø§Ù„ÙƒÙ„Ø¨", isCorrect: true },
    { id: "2", text: "Ø§Ù„Ø­Ø¬Ø±", isCorrect: false }
  ],
  pointsReward: 15,
  imageUrl: "https://...",
  subjectId: "subject-uuid" (optional)
}
Response: { success: true, data: { id: "task-uuid", ...task } }

PUT /api/tasks/:id
Body: { question: "...", answers: [...], pointsReward: 20 }
Response: { success: true, data: { ...updatedTask } }

DELETE /api/tasks/:id
Response: { success: true }

// ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
POST /api/tasks/:id/submit
Body: {
  childId: "child-uuid",
  selectedAnswerId: "1"
}
Response: {
  success: true,
  data: {
    isCorrect: true,
    pointsEarned: 10,
    newTotalPoints: 510
  }
}
```

#### Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù…
```http
GET /api/template-tasks?subject=<id>&difficulty=easy&isPublic=true
Response: {
  success: true,
  data: [
    {
      id: "template-uuid",
      title: "Ø¹Ø§ØµÙ…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
      difficulty: "easy",
      pointsReward: 10,
      usageCount: 150
    }
  ]
}

POST /api/template-tasks
Body: {
  subjectId: "subject-uuid",
  question: "Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ",
  answers: [...],
  pointsReward: 10,
  difficulty: "medium",
  isPublic: false,
  pointsCost: 5 // Ù„Ù„Ø¢Ø¨Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù„Ø´Ø±Ø§Ø¦Ù‡
}
Response: { success: true, data: { ...template } }

GET /api/template-tasks/:id/use
Body: {
  childId: "child-uuid"
}
Response: {
  success: true,
  data: { taskId: "newly-created-task-id" }
}
```

### ğŸ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ (Rewards & Gifts Routes)

#### Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§
```http
POST /api/gifts
Body: {
  childId: "child-uuid",
  productId: "product-uuid",
  pointsThreshold: 1000,
  message: "Ù‡Ø¯ÙŠØ© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯"
}
Response: {
  success: true,
  data: {
    giftId: "gift-uuid",
    status: "SENT",
    createdAt: "2025-01-15T10:00:00Z"
  }
}

GET /api/gifts/:childId
Response: {
  success: true,
  data: [
    {
      id: "gift-uuid",
      product: { id, name, image },
      pointsThreshold: 1000,
      status: "UNLOCKED",
      unlockedAt: "2025-01-18T10:00:00Z"
    }
  ]
}

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‡Ø¯ÙŠØ© (Ø·ÙÙ„)
POST /api/gifts/:id/activate
Response: {
  success: true,
  message: "Gift activated! Your points have been deducted."
}
```

#### Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø·ÙØ§Ù„
```http
GET /api/children/:id/points
Response: {
  success: true,
  data: {
    currentPoints: 500,
    dailyEarned: 50,
    totalAllTime: 1200,
    history: [
      {
        source: "task",
        points: 10,
        earnedAt: "2025-01-15T10:00:00Z"
      }
    ]
  }
}

POST /api/children/:id/adjust-points (Admin only)
Body: {
  delta: -50,
  reason: "Correction for cheating"
}
Response: { success: true, data: { newBalance: 450 } }
```

### ğŸ›ï¸ Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø¯ÙØ¹ (Store & Payment Routes)

#### Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
```http
GET /api/products?category=<id>&sort=popular&limit=20
Response: {
  success: true,
  data: [
    {
      id: "product-uuid",
      name: "Ø¹Ù„Ø¨Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ø°ÙƒÙŠØ©",
      description: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©",
      price: 99.99,
      pointsPrice: 500,
      image: "https://...",
      images: ["https://...", "https://..."],
      stock: 100,
      rating: 4.5,
      reviewCount: 250,
      isFeatured: true,
      productType: "digital" | "physical" | "subscription"
    }
  ]
}

GET /api/products/:id
Response: {
  success: true,
  data: { ...product, reviews: [...] }
}

// Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙˆØ§Ù„Ø¯
POST /api/products (Parent role)
Body: {
  categoryId: "category-uuid",
  name: "Ø¯ÙˆØ±Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©",
  pointsPrice: 200,
  price: 49.99,
  image: "https://...",
  productType: "digital"
}
Response: { success: true, data: { ...product } }
```

#### Ø§Ù„Ø·Ù„Ø¨Ø§Øª
```http
POST /api/store/orders
Body: {
  items: [
    { productId: "uuid", quantity: 1 }
  ],
  shippingAddressId: "address-uuid" (if physical)
}
Response: {
  success: true,
  data: {
    orderId: "order-uuid",
    status: "PENDING",
    totalAmount: 299.97,
    paymentUrl: "https://checkout.stripe.com/..." (if payment needed)
  }
}

GET /api/store/orders
Response: {
  success: true,
  data: [
    {
      id: "order-uuid",
      status: "PAID",
      totalAmount: 299.97,
      items: [...],
      createdAt: "2025-01-15T10:00:00Z"
    }
  ]
}

GET /api/store/orders/:id
Response: { success: true, data: { ...order, items: [...] } }
```

#### Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø´Ø­Ù†
```http
POST /api/shipping-addresses
Body: {
  name: "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ",
  line1: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯",
  city: "Ø§Ù„Ø±ÙŠØ§Ø¶",
  state: "Region",
  postalCode: "11111",
  country: "SA",
  isDefault: true
}
Response: { success: true, data: { ...address } }

GET /api/shipping-addresses
Response: { success: true, data: [...addresses] }

PUT /api/shipping-addresses/:id
Body: { ...updates }
Response: { success: true, data: { ...updated } }

DELETE /api/shipping-addresses/:id
Response: { success: true }
```

#### Ø§Ù„Ø¯ÙØ¹ (Stripe)
```http
// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
POST /api/payments/create-checkout-session
Body: {
  orderId: "order-uuid",
  successUrl: "https://app.classify.app/payment/success",
  cancelUrl: "https://app.classify.app/payment/cancel"
}
Response: {
  success: true,
  data: {
    sessionId: "cs_...",
    url: "https://checkout.stripe.com/pay/cs_..."
  }
}

// ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Stripe Webhook ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
POST /api/webhooks/stripe
Headers: { "Stripe-Signature": "t=...,v1=..." }
Body: { ...stripeEvent }
Response: { received: true }
```

### ğŸ“¢ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Notifications Routes)

```http
GET /api/notifications?status=unread&limit=20
Response: {
  success: true,
  data: [
    {
      id: "notif-uuid",
      type: "gift_unlocked",
      title: "ğŸ ØªÙ… ÙØªØ­ Ù‡Ø¯ÙŠØ©!",
      message: "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙØªØ­Øª Ù‡Ø¯ÙŠØ© Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
      priority: "normal",
      style: "toast",
      isRead: false,
      createdAt: "2025-01-15T10:00:00Z"
    }
  ]
}

PUT /api/notifications/:id
Body: { isRead: true }
Response: { success: true }

DELETE /api/notifications/:id
Response: { success: true }

POST /api/notifications/mark-all-read
Response: { success: true, markedCount: 5 }
```

### ğŸª Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª (Libraries Routes)

```http
GET /api/libraries?active=true&limit=10
Response: {
  success: true,
  data: [
    {
      id: "library-uuid",
      name: "Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù†ÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©",
      description: "...",
      username: "alnoor_library",
      imageUrl: "https://...",
      rating: 4.8,
      totalProducts: 150,
      totalSales: 5000
    }
  ]
}

GET /api/libraries/:id/products
Response: {
  success: true,
  data: [
    {
      id: "product-uuid",
      libraryId: "library-uuid",
      title: "ÙƒØªØ§Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
      price: 29.99,
      stock: 50,
      discount: 10,
      discountMinQuantity: 5
    }
  ]
}

// Library Login
POST /api/libraries/login
Body: {
  username: "alnoor_library",
  password: "secure123"
}
Response: {
  success: true,
  data: {
    libraryId: "library-uuid",
    token: "jwt-token",
    library: { ...library }
  }
}

// Library Dashboard
GET /api/libraries/dashboard
Response: {
  success: true,
  data: {
    totalSales: 50000,
    totalOrders: 1200,
    activeReferrals: 450,
    totalPointsEarned: 25000,
    commissionRate: 10
  }
}
```

### âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© (Admin Routes)

```http
// ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
POST /api/admin/login
Body: {
  email: "admin@classify.app",
  password: "secure123"
}
Response: {
  success: true,
  data: {
    token: "jwt-token",
    admin: { id, email, role }
  }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
GET /api/admin/parents?search=<query>&limit=50&page=1
Response: {
  success: true,
  data: [...parents],
  pagination: { total: 1000, page: 1, pages: 20 }
}

GET /api/admin/parents/:id
Response: {
  success: true,
  data: {
    id, email, name, children: [...],
    totalSpent, totalPurchases, referralStats
  }
}

POST /api/admin/parents/:id/suspend (Admin only)
Body: { reason: "Suspicious activity" }
Response: { success: true }

POST /api/admin/parents/:id/unsuspend
Response: { success: true }

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„
GET /api/admin/children?parentId=<id>&search=<query>
Response: { success: true, data: [...children] }

POST /api/admin/children/:id/adjust-points
Body: { delta: -100, reason: "Manual adjustment" }
Response: { success: true, data: { newBalance: 400 } }

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
GET /api/admin/products?category=<id>&search=<query>
Response: { success: true, data: [...products], total: 500 }

POST /api/admin/products
Body: { ...productData }
Response: { success: true, data: { ...product } }

PUT /api/admin/products/:id
Body: { ...updates }
Response: { success: true, data: { ...updated } }

DELETE /api/admin/products/:id
Response: { success: true }

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
GET /api/admin/orders?status=<status>&search=<query>
Response: { success: true, data: [...orders] }

PUT /api/admin/orders/:id
Body: { status: "SHIPPED" }
Response: { success: true, data: { ...order } }

// Ø§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„Ù†Ø´Ø§Ø·
GET /api/admin/activity-log?entity=<type>&limit=100
Response: {
  success: true,
  data: [
    {
      action: "CREATE",
      entity: "PRODUCT",
      entityId: "uuid",
      adminId: "admin-uuid",
      meta: {...},
      createdAt: "2025-01-15T10:00:00Z"
    }
  ]
}

// Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
GET /api/admin/settings/<key>
Response: {
  success: true,
  data: { key: "points_per_task", value: "10" }
}

PUT /api/admin/settings/<key>
Body: { value: "15" }
Response: { success: true }

GET /api/admin/settings
Response: {
  success: true,
  data: {
    rewards: { pointsPerTask: 10, dailyLimit: 100 },
    tasks: { maxTasksPerDay: 10, allowCustomTasks: true },
    store: { storeEnabled: true, minPointsToBuy: 10 },
    ...
  }
}
```

### ğŸ” ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Health Routes)

```http
GET /api/health
Response: {
  status: "healthy",
  timestamp: "2025-01-15T10:00:00Z",
  uptime: 86400,
  database: "connected",
  redis: "connected",
  queues: "healthy"
}

GET /api/health/deep
Response: {
  status: "healthy",
  database: {
    connected: true,
    latency: 12 (ms),
    migrations: "current"
  },
  redis: {
    connected: true,
    memory: "50MB"
  },
  storage: {
    connected: true,
    available: "1TB"
  }
}
```

---

## 5ï¸âƒ£ Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©

### ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
```
client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ ParentDashboard.tsx      # Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¨
â”‚   â”‚   â”œâ”€â”€ ChildApp.tsx             # ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·ÙÙ„
â”‚   â”‚   â”œâ”€â”€ AdminPanel.tsx           # Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
â”‚   â”‚   â”œâ”€â”€ AuthLogin.tsx            # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
â”‚   â”‚   â”œâ”€â”€ AuthRegister.tsx         # Ø§Ù„ØªØ³Ø¬ÙŠÙ„
â”‚   â”‚   â”œâ”€â”€ AdminAuth.tsx            # Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
â”‚   â”‚   â””â”€â”€ Store.tsx                # Ø§Ù„Ù…ØªØ¬Ø±
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ auth/                    # Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
â”‚   â”‚   â”œâ”€â”€ tasks/                   # Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…
â”‚   â”‚   â”œâ”€â”€ rewards/                 # Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª
â”‚   â”‚   â”œâ”€â”€ store/                   # Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
â”‚   â”‚   â”œâ”€â”€ admin/                   # Ù…ÙƒÙˆÙ†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
â”‚   â”‚   â””â”€â”€ shared/                  # Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø´ØªØ±ÙƒØ©
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                       # Custom React Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts               # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
â”‚   â”‚   â”œâ”€â”€ useChildren.ts           # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„
â”‚   â”‚   â”œâ”€â”€ useTasks.ts              # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts                   # Ø¹Ù…ÙŠÙ„ HTTP (Axios)
â”‚   â”‚   â”œâ”€â”€ auth.ts                  # Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
â”‚   â”‚   â”œâ”€â”€ tasks.ts                 # Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ context/                     # React Context
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â”‚   â”œâ”€â”€ AppContext.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                       # TanStack Query
â”‚   â”‚   â”œâ”€â”€ queries/                 # React Query Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª
â”‚   â”‚   â”œâ”€â”€ mutations/               # React Query Ø§Ù„Ø·ÙØ±Ø§Øª
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                       # TypeScript types
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ task.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ App.tsx                      # Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
â”‚
â””â”€â”€ index.html
```

### ğŸ¨ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©

| Ø§Ù„ØªÙ‚Ù†ÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|---------|---------|----------|
| **React** | 18+ | Framework Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ |
| **TypeScript** | 5.x | Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù‚Ù‚ |
| **Vite** | 5.x | Build tool |
| **Tailwind CSS** | 3.4.x | Styling |
| **shadcn/ui** | Latest | Ù…ÙƒÙˆÙ†Ø§Øª UI |
| **Framer Motion** | 10.x | Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© |
| **TanStack Query** | 5.x | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª |
| **React Router** | 6.x | Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ |
| **react-i18next** | 14.x | Ø§Ù„ØªØ¯ÙˆÙŠÙ„ (RTL/LTR) |
| **zustand** | 4.x | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (optional) |

### ğŸ”„ ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
```
User Action
    â†“
Component (React)
    â†“
Custom Hook (useQuery/useMutation)
    â†“
API Service (axios)
    â†“
Backend API (Express)
    â†“
Database (PostgreSQL)
    â†“
Response (JSON)
    â†“
TanStack Query Cache
    â†“
Component Re-render
    â†“
UI Update
```

---

## 6ï¸âƒ£ ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª

### ğŸ” ØªØ¯ÙÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­Ø³Ù‘Ù†

```
1. User enters email/password
   â†“
2. POST /api/auth/login
   â”œâ”€ Validate credentials against hashed password
   â”œâ”€ Check if 2FA enabled
   â””â”€ If enabled â†’ Send OTP
   â†“
3. If 2FA enabled:
   â”œâ”€ User receives 6-digit OTP
   â”œâ”€ POST /api/auth/verify-otp
   â””â”€ Receive JWT + refresh token
   â†“
4. If not 2FA:
   â””â”€ Receive JWT + refresh token directly
   â†“
5. Store tokens:
   â”œâ”€ JWT â†’ localStorage (short-lived, 7 days)
   â”œâ”€ Refresh Token â†’ secure httpOnly cookie (45 days)
   â””â”€ Device ID â†’ localStorage
   â†“
6. Optional: Trust this device
   â”œâ”€ POST /api/auth/trust-device
   â””â”€ Next login skips OTP for 45 days
   â†“
7. Redirect to dashboard
```

### ğŸ‘¨ğŸ‘©ğŸ‘§ğŸ‘¦ ØªØ¯ÙÙ‚ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©

```
Parent 1 (Creates Account)
â”œâ”€ Register with email/password
â”œâ”€ Create Children
â”‚  â”œâ”€ Add Child (name, birthday, school, etc.)
â”‚  â””â”€ Generate linking code (e.g., "ABC123")
â”‚
Parent 2 (Joins Family)
â”œâ”€ Register with email/password
â”œâ”€ Link Child via code
â”‚  â””â”€ POST /api/family/link
â””â”€ Now has access to same children

Shared Access:
â”œâ”€ Both parents see all children
â”œâ”€ Both can create tasks for children
â”œâ”€ Both can receive notifications
â””â”€ Children see both as parents
```

### ğŸ“š ØªØ¯ÙÙ‚ Ø§Ù„Ù…Ù‡Ø§Ù…

```
CREATION:
Parent
â”œâ”€ POST /api/tasks
â”œâ”€ Select child, subject, question, answers
â””â”€ Set points reward
â†“
ASSIGNMENT:
Task created with status="pending"
â”œâ”€ Notification sent to child
â””â”€ Child sees in Task List
â†“
COMPLETION:
Child
â”œâ”€ Views task details
â”œâ”€ Selects answer
â”œâ”€ POST /api/tasks/:id/submit
â””â”€ System evaluates:
   â”œâ”€ If correct â†’ +points
   â”œâ”€ If incorrect â†’ No points
   â””â”€ taskResult created
â†“
TRACKING:
Parent sees:
â”œâ”€ Completion status
â”œâ”€ Points earned
â”œâ”€ Attempts made
â””â”€ Growth impact
```

### ğŸ ØªØ¯ÙÙ‚ Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§

```
SENDING:
Parent
â”œâ”€ Selects product (product ID from store)
â”œâ”€ Sets points threshold (e.g., 1000)
â”œâ”€ Optional message
â””â”€ POST /api/gifts
â”œâ”€ Gift status = "SENT"
â””â”€ Notification sent to child
â†“
UNLOCKING (Child earns enough points):
Child
â”œâ”€ Earns tasks â†’ accumulate points
â”œâ”€ Reaches 1000 points
â”œâ”€ Notification: "ğŸ Gift unlocked!"
â”œâ”€ Gift status â†’ "UNLOCKED"
â””â”€ Gift moves to "Ready to Open" section
â†“
ACTIVATING:
Child
â”œâ”€ Views unlocked gift
â”œâ”€ Clicks "Open"
â”œâ”€ POST /api/gifts/:id/activate
â”œâ”€ Points deducted from child's balance
â”œâ”€ Gift status â†’ "ACTIVATED"
â””â”€ Product redeemed/access granted
â†“
DELIVERY:
For physical products:
â”œâ”€ Shipping request created
â”œâ”€ Parent receives request
â”œâ”€ Parent confirms address
â””â”€ Gift shipped
```

### ğŸ’³ ØªØ¯ÙÙ‚ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡

```
DISCOVERY:
Child/Parent
â”œâ”€ Browse /api/products
â””â”€ See products with price (both currency + points options)
â†“
ADDING TO CART:
â”œâ”€ Select product
â”œâ”€ Choose quantity
â””â”€ Select payment method (points or currency)
â†“
CHECKOUT:
POST /api/store/orders
â”œâ”€ Pick shipping address (if physical)
â”œâ”€ Create order with status="PENDING"
â””â”€ Return order ID
â†“
PAYMENT PROCESSING:
if (currency):
  â”œâ”€ POST /api/payments/create-checkout-session
  â”œâ”€ Redirect to Stripe checkout
  â””â”€ Payment gateway handles transaction
else if (points):
  â”œâ”€ Deduct points from child
  â”œâ”€ Mark order as "PAID"
  â””â”€ Skip payment gateway
â†“
COMPLETION:
â”œâ”€ Webhook confirmation (if Stripe)
â”œâ”€ Update order status â†’ "PAID"
â”œâ”€ Create child_purchases record
â”œâ”€ Send confirmation notification
â””â”€ For digital: Access granted immediately
   For physical: Await shipping
```

---

## 7ï¸âƒ£ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©

### ğŸ” Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª

```
Layer 1: Password Security
â”œâ”€ bcrypt hashing (10 rounds)
â”œâ”€ Minimum 12 characters required
â””â”€ No plaintext storage

Layer 2: JWT Tokens
â”œâ”€ 7-day expiration (short-lived)
â”œâ”€ RS256 signing algorithm
â”œâ”€ Payload: { userId, role, exp, iat }
â””â”€ Refresh token: 45-day expiration

Layer 3: 2FA (Optional)
â”œâ”€ OTP delivery: Email or SMS
â”œâ”€ 6-digit code (0-999999 range)
â”œâ”€ 5-minute expiration
â”œâ”€ 3 maximum attempts
â””â”€ Cooldown: 1 minute between resends

Layer 4: Rate Limiting
â”œâ”€ OTP requests: 5 per hour per email
â”œâ”€ Login attempts: 10 per 15 minutes
â”œâ”€ Register: 3 per hour per IP
â””â”€ After limits: Account locked for 30 minutes

Layer 5: Device Fingerprinting
â”œâ”€ Device ID hash (localStorage)
â”œâ”€ User agent stored
â”œâ”€ IP address logged
â””â”€ Suspicious pattern detection
```

### ğŸŸï¸ JWT Token Structure
```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "userId": "parent-uuid",
    "role": "parent",
    "email": "parent@example.com",
    "iat": 1705315200,
    "exp": 1705920000
  },
  "signature": "..."
}
```

### ğŸ”’ Authorization Rules

#### Parent Endpoints
```typescript
// Parent can only access their own data
GET /api/family/children
  â”œâ”€ Requires: JWT token with role=parent
  â”œâ”€ Validates: parentId matches token
  â””â”€ Returns: Only their own children

// Parent can only modify their own children
PUT /api/family/children/:id
  â”œâ”€ Requires: JWT + Parent role
  â”œâ”€ Validates: parentId === token.userId
  â”œâ”€ Validates: childId belongs to this parent
  â””â”€ Checks: No cross-parent child access
```

#### Child Endpoints
```typescript
// Child can only access own data
GET /api/tasks?childId=<id>
  â”œâ”€ Requires: JWT token with role=child
  â”œâ”€ Validates: childId === token.userId
  â””â”€ Returns: Only their tasks

// Child cannot modify tasks (read-only)
POST /api/tasks/:id/submit
  â”œâ”€ Requires: JWT + Child role
  â”œâ”€ Validates: childId === token.userId
  â”œâ”€ Action: Submit answer (no edit)
  â””â”€ No full CRUD for children
```

#### Admin Endpoints
```typescript
// Admin can access all data
GET /api/admin/parents
  â”œâ”€ Requires: JWT with role=superadmin
  â”œâ”€ Returns: All parents + full details
  â””â”€ Includes: Financial data, activity logs

// Admin audit trail
POST /api/admin/parents/:id/suspend
  â”œâ”€ Requires: superadmin role
  â”œâ”€ Action: Logged to activity_log
  â”œâ”€ Meta: Reason, timestamp, admin ID
  â””â”€ Immutable record kept forever
```

### ğŸ›¡ï¸ Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©

| Ø§Ù„Ù‡Ø¬ÙˆÙ… | Ø§Ù„Ø­Ù…Ø§ÙŠØ© |
|------|--------|
| **SQL Injection** | Parameterized queries (Drizzle ORM) |
| **XSS** | Content Security Policy headers, DOMPurify |
| **CSRF** | SameSite cookies, CSRF tokens |
| **Brute Force** | Rate limiting + account lockout |
| **Session Hijacking** | HttpOnly cookies, Device fingerprinting |
| **Man-in-the-Middle** | HTTPS only, HSTS headers |
| **Weak Passwords** | Minimum length, complexity check |
| **Token Theft** | Short JWT expiry, refresh tokens |

### ğŸ“¡ Middleware Stack
```
Request
  â†“
CORS Check (Access-Control-Allow-Origin)
  â†“
Helmet (Security Headers)
  â”œâ”€ Content-Security-Policy
  â”œâ”€ X-Frame-Options: DENY
  â”œâ”€ X-Content-Type-Options: nosniff
  â””â”€ Strict-Transport-Security (HTTPS)
  â†“
Rate Limiter (express-rate-limit)
  â”œâ”€ Per IP: 100 requests/15 min
  â”œâ”€ Per auth endpoint: Lower limits
  â””â”€ Per user: 50 requests/minute
  â†“
Body Parser & Validator
  â”œâ”€ JSON size limit: 10MB
  â”œâ”€ Zod validation on all inputs
  â””â”€ Type coercion
  â†“
JWT Verification (if authenticated)
  â”œâ”€ Check signature
  â”œâ”€ Verify expiration
  â””â”€ Extract user ID
  â†“
Authorization Middleware
  â”œâ”€ Check role
  â”œâ”€ Verify resource ownership
  â””â”€ Audit log
  â†“
Route Handler
  â†“
Response (200/400/401/403/500)
```

---

## 8ï¸âƒ£ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø©

### ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

#### Server Entry Point
**File:** `server/index.ts`
```typescript
// Purpose: Main server initialization
// Key: Express initialization, middleware setup, routes mounting
// Critical: Database connection, environment variables, port binding
// Usage: npm run dev | node dist/index.js
```

#### Database Schema Definition
**File:** `shared/schema.ts` (1471 lines)
```typescript
// Purpose: Drizzle ORM schema - source of truth for database structure
// Contains: 80+ table definitions with 64 optimized indexes
// Key Tables:
//   - parents, children, tasks, products, orders
//   - admins, notifications, deposits, wallets
//   - socialLoginProviders, otpProviders, libraries
// Usage: Referenced by all server routes for queries
// Critical: Any schema changes require: npm run db:push
```

#### Authentication Routes
**File:** `server/routes/auth.ts` (2533 lines)
```typescript
// Purpose: All authentication endpoints
// Key Endpoints:
//   - POST /api/auth/register - Parent registration
//   - POST /api/auth/login - Email/password login
//   - POST /api/auth/send-otp - OTP delivery
//   - POST /api/auth/verify-otp - 2FA verification
//   - POST /api/auth/login-social - Social OAuth
//   - POST /api/auth/trust-device - Device trust
// Critical Logic:
//   - JWT token generation and signing
//   - OTP code generation (random 6-digit)
//   - Rate limiting on OTP (3/10min per user)
//   - Password hashing with bcrypt
// Dependencies: auth middleware, JWT_SECRET, Resend API
// Usage: All authentication flows pass through this file
```

#### Admin Routes
**File:** `server/routes/admin.ts` (3824 lines)
```typescript
// Purpose: All admin panel endpoints
// Key Sections:
//   - Login: POST /api/admin/login (lines 63-97)
//   - Register: POST /api/admin/register (requires ADMIN_CREATION_SECRET)
//   - Users: Parent/child management, suspension
//   - Products: CRUD operations for store
//   - Orders: Order management and fulfillment
//   - Settings: Global application configuration
//   - Activity Logs: Admin action tracking
// Critical: adminMiddleware validates all requests
// Usage: Only accessible with admin JWT token
```

#### Family Management Routes
**File:** `server/routes/family.ts`
```typescript
// Purpose: Parent-child relationship management
// Key Endpoints:
//   - POST /api/family/children - Add child
//   - GET /api/family/children - List children
//   - PUT /api/family/children/:id - Update child
//   - POST /api/family/link - Link child to second parent
// Validation: Parent-child ownership checked on all operations
```

#### Task Routes
**File:** `server/routes/tasks.ts`
```typescript
// Purpose: Task creation, management, and submission
// Key Endpoints:
//   - POST /api/tasks - Create task
//   - GET /api/tasks - List tasks (filtered by child)
//   - POST /api/tasks/:id/submit - Submit answer
//   - PUT /api/tasks/:id - Update task
// Critical: Points calculation, answer validation
```

#### Store Routes
**File:** `server/routes/store.ts`
```typescript
// Purpose: Store, products, orders, and payments
// Key Sections:
//   - Products: Listing, filtering, searching
//   - Orders: Creation, checkout, payment status
//   - Shipping: Address management, request handling
//   - Inventory: Stock tracking
// Integration: Stripe payment gateway, webhooks
```

#### Notifications Routes
**File:** `server/routes/notifications.ts`
```typescript
// Purpose: Notification management and delivery
// Key: Mark as read, batch operations, filtering
```

#### Admin Credentials Management Script
**File:** `scripts/manage-admin.js`
```javascript
// Purpose: Sync ADMIN_EMAIL and ADMIN_PASSWORD from .env to database
// Usage: npm run admin:setup
// Function:
//   1. Read ADMIN_EMAIL and ADMIN_PASSWORD from .env
//   2. Connect to PostgreSQL via DATABASE_URL
//   3. Hash password with bcrypt
//   4. Create or update admin entry in admins table
//   5. Report success/failure
// Critical: Must run after .env changes to database to sync credentials
```

#### Authentication Middleware
**File:** `server/routes/middleware.ts`
```typescript
// Purpose: JWT verification and authorization checks
// Key Middleware:
//   - JWT verification: Checks token signature and expiry
//   - Role-based access: Validates user role
//   - Ownership validation: Ensures resource access rights
// Used by: All protected routes (marked with middleware)
```

#### Mailer Service
**File:** `server/services/mailer.ts`
```typescript
// Purpose: Email delivery (Resend API)
// Key Functions:
//   - sendOTP: Send 6-digit OTP code
//   - sendWelcome: Welcome email for new registration
//   - sendNotification: General notifications
//   - sendPasswordReset: Password recovery
// Requirements: RESEND_API_KEY in .env
```

#### Database Configuration
**File:** `drizzle.config.ts`
```typescript
// Purpose: Drizzle ORM configuration
// Connection: PostgreSQL via DATABASE_URL
// Migrations: Versioned SQL files in /migrations
```

---

## 9ï¸âƒ£ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ·ÙˆÙŠØ±

### ğŸš€ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹

#### Ø§Ù„ØªØ«Ø¨ÙŠØª
```bash
# Install dependencies
npm install

# Copy environment template
cp .env.example .env
# Edit .env with your configuration

# Push database schema
npm run db:push

# Start development server
npm run dev

# The app will be available at:
# Frontend: http://localhost:3000 (Vite dev server)
# Backend: http://localhost:5000 (Express)
```

#### Ø£ÙˆØ§Ù…Ø± Ù…Ù‡Ù…Ø©
```bash
# Development
npm run dev                 # Start dev server with hot reload

# Building
npm run build              # Build for production

# Database
npm run db:push            # Apply schema changes to database
npm run db:migrations      # View migration status

# Admin Management
npm run admin:setup        # Sync admin credentials from .env to database

# Testing
npm run test               # Run test suite

# Deployment
npm run build && npm run start  # Production build and start
```

### ğŸ“ Creating New Features

#### Adding a New API Endpoint
```typescript
// 1. Add route handler in server/routes/*.ts
export async function handleNewFeature(req, res) {
  try {
    // Validate input
    const { childId } = req.body;
    if (!childId) {
      return res.json({ success: false, error: "BAD_REQUEST", message: "childId required" });
    }

    // Check authorization
    const ownership = await db.query.parentChild.findFirst({
      where: and(
        eq(parentChild.parentId, req.user.id),
        eq(parentChild.childId, childId)
      )
    });
    if (!ownership) {
      return res.json({ success: false, error: "UNAUTHORIZED" });
    }

    // Execute business logic
    const result = await db.insert(someTable).values({...});

    // Return response
    return res.json({ success: true, data: result });
  } catch (error) {
    console.error("[NewFeature]", error);
    return res.json({ success: false, error: "INTERNAL_SERVER_ERROR" });
  }
}

// 2. Register route in server/index.ts
app.post("/api/feature/new", adminMiddleware, handleNewFeature);

// 3. Add React Query hook in client/src/hooks/
export function useNewFeature() {
  return useMutation({
    mutationFn: (data) => api.post("/api/feature/new", data),
    onSuccess: (data) => { ... }
  });
}

// 4. Use in component
export function ComponentUsingFeature() {
  const mutation = useNewFeature();
  
  const handleClick = () => {
    mutation.mutate({ childId: "..." });
  };

  return (
    <button onClick={handleClick} disabled={mutation.isPending}>
      {mutation.isPending ? "Loading..." : "Use Feature"}
    </button>
  );
}
```

### ğŸ› Debugging

#### Check Server Logs
```bash
# If running with npm run dev
# Logs appear in terminal

# In Docker:
docker-compose logs -f classiv3-app

# View specific errors:
docker-compose logs --tail 50 classiv3-app
```

#### Database Queries
```bash
# Connect to database via pgAdmin:
# http://localhost:5050

# Or via psql:
psql postgresql://$USER:$PASSWORD@$HOST:5433/$DATABASE
```

#### Check Redis Cache
```bash
# Via Redis Commander:
# http://localhost:8081

# Or via CLI:
docker-compose exec classiv3-redis redis-cli
> keys *
> get <key>
```

### ğŸ’¾ Database Migrations

#### Creating New Migration
```bash
# Drizzle will auto-gen from schema changes
# No manual SQL needed

# After schema.ts change:
npm run db:push

# View migrations:
npm run db:migrations
```

#### Rolling Back Changes
```bash
# Using Drizzle (limited rollback support)
# Manual approach: Restore from backup or write migration down script
```

---

## ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

| Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ | Ø§Ù„Ù‚ÙŠÙ…Ø© |
|--------|--------|
| Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | 80+ |
| Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© | 64 |
| Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© | 195+ |
| Ø§Ù„Ù„ØºØ§Øª | Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© + Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© |
| Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª | LTR + RTL |
| Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø¯ÙØ¹ | Stripe + Ù…Ø­Ø§ÙØ¸ Ù…Ø­Ù„ÙŠØ© |
| Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ | Resend + SMTP Ù…Ø­Ù„ÙŠ |
| Ø®Ø¯Ù…Ø§Øª SMS | Twilio + Ù…Ø­Ù„ÙŠØ© |
| Ù…Ø²ÙˆØ¯Ùˆ OAuth | Google, Facebook, Apple, Twitter, GitHub, Microsoft |
| Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© | 7 |
| Endpoints ÙÙŠ API | 150+ |
| Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…ØªØ²Ø§Ù…Ù†ÙˆÙ† Ù…Ø¹ØªÙ…Ø¯ÙˆÙ† | 10,000+ |

---

## ğŸ¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©

### Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ

1. **Mobile Apps** - React Native Ù„Ù€ iOS/Android
2. **AI Integration** - ØªØ­Ù„ÙŠÙ„ ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø·ÙØ§Ù„
3. **Advanced Analytics** - Ù„ÙˆØ­Ø§Øª ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„Ø©
4. **Video Content** - Ø¯Ø¹Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
5. **Gamification** - Ù†Ù‚Ø§Ø· + ØªØ­Ø¯ÙŠØ§Øª + Ù„ÙˆØ­Ø§Øª Ø§Ù„ØµØ¯Ø§Ø±Ø©
6. **Offline Support** - Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª
7. **Multi-Parent Support** - Ø¯Ø¹Ù… Ø¹Ø§Ø¦Ù„Ø§Øª Ù…ÙˆØ³Ø¹Ø©
8. **School Integration** - Ø±Ø¨Ø· Ù…Ø¹ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³

---

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** January 2025  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 2.0  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬

Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø£Ùˆ Ø§ØªØµÙ„ Ø¨ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ±.
