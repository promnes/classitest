<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Math Challenge</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .game-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: clamp(12px, 3vmin, 24px);
      padding: clamp(16px, 4vmin, 32px);
      max-width: min(480px, 95vw);
      width: 100%;
      max-height: 98vh;
      overflow-y: auto;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .header { margin-bottom: clamp(12px, 3vmin, 24px); }

    .header h1 {
      font-size: clamp(18px, 4vmin, 28px);
      color: #4c1d95;
      margin-bottom: 8px;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: clamp(12px, 3vmin, 24px);
      margin-bottom: clamp(12px, 3vmin, 20px);
    }

    .stat { display: flex; flex-direction: column; align-items: center; }

    .stat-value {
      font-size: clamp(22px, 5vmin, 32px);
      font-weight: 800;
      color: #7c3aed;
    }

    .stat-label {
      font-size: clamp(10px, 1.5vmin, 12px);
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .progress-bar {
      width: 100%;
      height: clamp(6px, 1vmin, 8px);
      background: #e5e7eb;
      border-radius: 999px;
      margin-bottom: clamp(16px, 4vmin, 32px);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #8b5cf6, #ec4899);
      border-radius: 999px;
      transition: width 0.4s ease;
    }

    .question-area { margin-bottom: clamp(16px, 4vmin, 32px); }

    .question {
      font-size: clamp(28px, 8vmin, 48px);
      font-weight: 800;
      color: #1f2937;
      margin-bottom: 8px;
      direction: ltr;
    }

    .question-hint { font-size: clamp(12px, 1.8vmin, 14px); color: #9ca3af; }

    .answers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: clamp(8px, 1.5vmin, 12px);
      margin-bottom: clamp(12px, 3vmin, 24px);
    }

    .answer-btn {
      padding: clamp(10px, 2vmin, 16px);
      font-size: clamp(18px, 4vmin, 24px);
      font-weight: 700;
      border: 3px solid #e5e7eb;
      border-radius: clamp(10px, 2vmin, 16px);
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #374151;
      position: relative;
      overflow: hidden;
    }

    .answer-btn:hover { border-color: #8b5cf6; background: #f5f3ff; transform: scale(1.03); }
    .answer-btn:active { transform: scale(0.97); }
    .answer-btn.correct { border-color: #10b981; background: #d1fae5; color: #065f46; animation: pulse 0.4s ease; }
    .answer-btn.wrong { border-color: #ef4444; background: #fee2e2; color: #991b1b; animation: shake 0.4s ease; }
    .answer-btn:disabled { cursor: default; opacity: 0.7; }

    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }

    .timer { font-size: clamp(12px, 1.8vmin, 14px); color: #6b7280; margin-bottom: 8px; }
    .timer-urgent { color: #ef4444; font-weight: 700; }

    /* Completion Screen */
    .completion { animation: slideUp 0.6s ease-out; }
    .completion .trophy { font-size: clamp(48px, 12vmin, 80px); margin-bottom: 16px; animation: bounce 1s infinite; }

    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }

    .completion h2 { font-size: clamp(20px, 4vmin, 28px); color: #4c1d95; margin-bottom: 12px; }

    .completion .score {
      font-size: clamp(40px, 10vmin, 64px);
      font-weight: 900;
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .completion .score-label { font-size: clamp(12px, 2vmin, 16px); color: #6b7280; margin-bottom: clamp(12px, 3vmin, 24px); }

    .result-details {
      display: flex;
      justify-content: center;
      gap: clamp(16px, 4vmin, 32px);
      margin-bottom: clamp(12px, 3vmin, 24px);
    }

    .result-item { text-align: center; }
    .result-item .value { font-size: clamp(18px, 4vmin, 24px); font-weight: 800; }
    .result-item .label { font-size: clamp(10px, 1.5vmin, 12px); color: #9ca3af; }
    .result-item.correct-count .value { color: #10b981; }
    .result-item.wrong-count .value { color: #ef4444; }
    .result-item.time-count .value { color: #f59e0b; }

    .play-again-btn {
      padding: clamp(10px, 2vmin, 14px) clamp(28px, 6vmin, 48px);
      font-size: clamp(14px, 2.5vmin, 18px);
      font-weight: 700;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .play-again-btn:hover { transform: scale(1.05); box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4); }

    /* Star particles */
    .star-particle {
      position: fixed;
      pointer-events: none;
      font-size: 24px;
      animation: float-up 1.5s ease-out forwards;
      z-index: 999;
    }

    @keyframes float-up {
      0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
      100% { opacity: 0; transform: translateY(-120px) scale(0.3) rotate(180deg); }
    }

    /* Start Screen */
    .start-screen h1 { font-size: clamp(24px, 5vmin, 36px); color: #4c1d95; margin-bottom: 12px; }
    .start-screen .emoji { font-size: clamp(40px, 10vmin, 64px); margin-bottom: 16px; }
    .start-screen p { color: #6b7280; margin-bottom: 8px; font-size: clamp(13px, 2vmin, 15px); }

    .start-screen .rules {
      margin: 16px 0 24px;
      padding: clamp(10px, 2vmin, 16px);
      background: #f5f3ff;
      border-radius: 12px;
    }

    [dir="ltr"] .start-screen .rules { text-align: left; }
    [dir="rtl"] .start-screen .rules { text-align: right; }

    .start-screen .rules li {
      margin-bottom: 6px;
      color: #4b5563;
      font-size: clamp(12px, 1.8vmin, 14px);
    }

    .start-btn {
      padding: clamp(12px, 2.5vmin, 16px) clamp(36px, 8vmin, 64px);
      font-size: clamp(16px, 3vmin, 20px);
      font-weight: 700;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .start-btn:hover { transform: scale(1.05); box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4); }

    .difficulty-select {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .diff-btn {
      padding: clamp(6px, 1vmin, 8px) clamp(14px, 2.5vmin, 20px);
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      font-size: clamp(12px, 1.8vmin, 14px);
      font-weight: 600;
      transition: all 0.2s;
      color: #4b5563;
    }

    .diff-btn.active { border-color: #8b5cf6; background: #f5f3ff; color: #7c3aed; }
    .diff-btn:hover { border-color: #8b5cf6; }
  </style>
</head>
<body>
  <div class="game-container" id="game">
    <!-- Start Screen -->
    <div id="start-screen" class="start-screen">
      <div class="emoji">ğŸ§®</div>
      <h1 id="startTitle">ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
      <p id="startDesc">Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ 10 Ø£Ø³Ø¦Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ© Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!</p>

      <div class="rules">
        <ul id="rulesList">
          <li>ğŸ¯ 10 Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© (Ø¬Ù…Ø¹ØŒ Ø·Ø±Ø­ØŒ Ø¶Ø±Ø¨)</li>
          <li>â±ï¸ 15 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„</li>
          <li>â­ Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</li>
          <li>ğŸ† Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ 10/10!</li>
        </ul>
      </div>

      <p id="chooseLevelLabel" style="font-weight:600; margin-bottom:12px;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</p>
      <div class="difficulty-select">
        <button class="diff-btn" data-diff="easy" id="btnEasy" onclick="setDifficulty('easy')">Ø³Ù‡Ù„</button>
        <button class="diff-btn active" data-diff="medium" id="btnMedium" onclick="setDifficulty('medium')">Ù…ØªÙˆØ³Ø·</button>
        <button class="diff-btn" data-diff="hard" id="btnHard" onclick="setDifficulty('hard')">ØµØ¹Ø¨</button>
      </div>

      <button class="start-btn" id="btnStart" onclick="startGame()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" style="display:none;">
      <div class="header">
        <h1 id="gameTitle">ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ğŸ§®</h1>
      </div>

      <div class="stats">
        <div class="stat">
          <span class="stat-value" id="score">0</span>
          <span class="stat-label" id="labelPoints">Ø§Ù„Ù†Ù‚Ø§Ø·</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="question-num">1</span>
          <span class="stat-label" id="labelQuestion">Ø§Ù„Ø³Ø¤Ø§Ù„</span>
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progress" style="width: 10%"></div>
      </div>

      <div class="timer" id="timer">â±ï¸ 15 Ø«Ø§Ù†ÙŠØ©</div>

      <div class="question-area">
        <div class="question" id="question">5 + 3 = ?</div>
        <div class="question-hint" id="hint"></div>
      </div>

      <div class="answers-grid" id="answers"></div>
    </div>

    <!-- Completion Screen -->
    <div id="completion-screen" class="completion" style="display:none;">
      <div class="trophy">ğŸ†</div>
      <h2 id="completion-title">Ø£Ø­Ø³Ù†Øª!</h2>
      <div class="score" id="final-score">8</div>
      <div class="score-label" id="scoreLabel">Ù…Ù† 10</div>

      <div class="result-details">
        <div class="result-item correct-count">
          <div class="value" id="correct-count">8</div>
          <div class="label" id="labelCorrect">ØµØ­ÙŠØ­ âœ…</div>
        </div>
        <div class="result-item wrong-count">
          <div class="value" id="wrong-count">2</div>
          <div class="label" id="labelWrong">Ø®Ø·Ø£ âŒ</div>
        </div>
        <div class="result-item time-count">
          <div class="value" id="total-time">45s</div>
          <div class="label" id="labelTimeResult">Ø§Ù„ÙˆÙ‚Øª â±ï¸</div>
        </div>
      </div>

      <button class="play-again-btn" id="btnPlayAgain" onclick="resetGame()">ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>
  </div>

  <script>
    // ===== i18n =====
    const TRANSLATIONS = {
      ar: {
        dir: 'rtl', lang: 'ar',
        startTitle: 'ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
        startDesc: 'Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ 10 Ø£Ø³Ø¦Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ© Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!',
        rules: [
          'ğŸ¯ 10 Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© (Ø¬Ù…Ø¹ØŒ Ø·Ø±Ø­ØŒ Ø¶Ø±Ø¨)',
          'â±ï¸ 15 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„',
          'â­ Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©',
          'ğŸ† Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ 10/10!',
        ],
        chooseLevel: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰:',
        easy: 'Ø³Ù‡Ù„', medium: 'Ù…ØªÙˆØ³Ø·', hard: 'ØµØ¹Ø¨',
        startBtn: 'ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨',
        gameTitle: 'ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ğŸ§®',
        points: 'Ø§Ù„Ù†Ù‚Ø§Ø·', questionLabel: 'Ø§Ù„Ø³Ø¤Ø§Ù„',
        timerText: (s) => `â±ï¸ ${s} Ø«Ø§Ù†ÙŠØ©`,
        timeUp: 'â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!',
        scoreLabel: 'Ù…Ù† 10',
        correct: 'ØµØ­ÙŠØ­ âœ…', wrong: 'Ø®Ø·Ø£ âŒ', timeResult: 'Ø§Ù„ÙˆÙ‚Øª â±ï¸',
        playAgain: 'ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',
        titles: { 10: 'ğŸŒŸ Ù…Ù…ØªØ§Ø²! Ø¹Ø¨Ù‚Ø±ÙŠ! ğŸŒŸ', 8: 'ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø±Ø§Ø¦Ø¹!', 6: 'ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹!', 4: 'ğŸ’ª Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!', 0: 'ğŸ“š ØªØ­ØªØ§Ø¬ ØªØ¯Ø±ÙŠØ¨ Ø£ÙƒØ«Ø±' },
      },
      en: {
        dir: 'ltr', lang: 'en',
        startTitle: 'Math Challenge',
        startDesc: 'Answer 10 math questions as fast as you can!',
        rules: [
          'ğŸ¯ 10 mixed questions (addition, subtraction, multiplication)',
          'â±ï¸ 15 seconds per question',
          'â­ 1 point for each correct answer',
          'ğŸ† Try to get 10/10!',
        ],
        chooseLevel: 'Choose difficulty:',
        easy: 'Easy', medium: 'Medium', hard: 'Hard',
        startBtn: 'ğŸš€ Start Playing',
        gameTitle: 'Math Challenge ğŸ§®',
        points: 'Score', questionLabel: 'Question',
        timerText: (s) => `â±ï¸ ${s} seconds`,
        timeUp: 'â° Time\'s up!',
        scoreLabel: 'out of 10',
        correct: 'Correct âœ…', wrong: 'Wrong âŒ', timeResult: 'Time â±ï¸',
        playAgain: 'ğŸ”„ Play Again',
        titles: { 10: 'ğŸŒŸ Excellent! Genius! ğŸŒŸ', 8: 'ğŸ‰ Great job!', 6: 'ğŸ‘ Very good!', 4: 'ğŸ’ª Try again!', 0: 'ğŸ“š Keep practicing!' },
      },
      pt: {
        dir: 'ltr', lang: 'pt',
        startTitle: 'Desafio de MatemÃ¡tica',
        startDesc: 'Responda 10 questÃµes o mais rÃ¡pido possÃ­vel!',
        rules: [
          'ğŸ¯ 10 questÃµes variadas (adiÃ§Ã£o, subtraÃ§Ã£o, multiplicaÃ§Ã£o)',
          'â±ï¸ 15 segundos por questÃ£o',
          'â­ 1 ponto por resposta correta',
          'ğŸ† Tente conseguir 10/10!',
        ],
        chooseLevel: 'Escolha a dificuldade:',
        easy: 'FÃ¡cil', medium: 'MÃ©dio', hard: 'DifÃ­cil',
        startBtn: 'ğŸš€ ComeÃ§ar',
        gameTitle: 'Desafio de MatemÃ¡tica ğŸ§®',
        points: 'Pontos', questionLabel: 'QuestÃ£o',
        timerText: (s) => `â±ï¸ ${s} segundos`,
        timeUp: 'â° Tempo esgotado!',
        scoreLabel: 'de 10',
        correct: 'Correto âœ…', wrong: 'Errado âŒ', timeResult: 'Tempo â±ï¸',
        playAgain: 'ğŸ”„ Jogar Novamente',
        titles: { 10: 'ğŸŒŸ Excelente! GÃªnio! ğŸŒŸ', 8: 'ğŸ‰ Muito bem!', 6: 'ğŸ‘ Bom trabalho!', 4: 'ğŸ’ª Tente novamente!', 0: 'ğŸ“š Continue praticando!' },
      }
    };

    function getLang() {
      const params = new URLSearchParams(window.location.search);
      const lang = (params.get('lang') || 'ar').toLowerCase();
      if (TRANSLATIONS[lang]) return lang;
      if (lang.startsWith('pt')) return 'pt';
      if (lang.startsWith('en')) return 'en';
      return 'ar';
    }

    const LANG = getLang();
    const T = TRANSLATIONS[LANG];

    function applyTranslations() {
      const html = document.documentElement;
      html.setAttribute('lang', T.lang);
      html.setAttribute('dir', T.dir);
      document.body.style.direction = T.dir;

      document.getElementById('startTitle').textContent = T.startTitle;
      document.getElementById('startDesc').textContent = T.startDesc;
      const rulesList = document.getElementById('rulesList');
      rulesList.innerHTML = T.rules.map(r => `<li>${r}</li>`).join('');
      document.getElementById('chooseLevelLabel').textContent = T.chooseLevel;
      document.getElementById('btnEasy').textContent = T.easy;
      document.getElementById('btnMedium').textContent = T.medium;
      document.getElementById('btnHard').textContent = T.hard;
      document.getElementById('btnStart').textContent = T.startBtn;
      document.getElementById('gameTitle').textContent = T.gameTitle;
      document.getElementById('labelPoints').textContent = T.points;
      document.getElementById('labelQuestion').textContent = T.questionLabel;
      document.getElementById('scoreLabel').textContent = T.scoreLabel;
      document.getElementById('labelCorrect').textContent = T.correct;
      document.getElementById('labelWrong').textContent = T.wrong;
      document.getElementById('labelTimeResult').textContent = T.timeResult;
      document.getElementById('btnPlayAgain').textContent = T.playAgain;
    }

    // ===== Game State =====
    let currentQuestion = 0;
    let score = 0;
    let totalQuestions = 10;
    let questions = [];
    let timer = null;
    let timeLeft = 15;
    let startTime = 0;
    let difficulty = 'medium';
    let answering = false;

    function setDifficulty(diff) {
      difficulty = diff;
      document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-diff="${diff}"]`).classList.add('active');
    }

    function generateQuestion() {
      const ops = ['+', '-', 'Ã—'];
      const op = ops[Math.floor(Math.random() * ops.length)];
      let a, b, answer;

      const ranges = {
        easy:   { add: 20, sub: 15, mul: 5 },
        medium: { add: 50, sub: 30, mul: 10 },
        hard:   { add: 100, sub: 50, mul: 12 }
      };
      const r = ranges[difficulty];

      switch (op) {
        case '+':
          a = Math.floor(Math.random() * r.add) + 1;
          b = Math.floor(Math.random() * r.add) + 1;
          answer = a + b;
          break;
        case '-':
          a = Math.floor(Math.random() * r.sub) + 1;
          b = Math.floor(Math.random() * a) + 1;
          answer = a - b;
          break;
        case 'Ã—':
          a = Math.floor(Math.random() * r.mul) + 1;
          b = Math.floor(Math.random() * r.mul) + 1;
          answer = a * b;
          break;
      }

      const wrongAnswers = new Set();
      while (wrongAnswers.size < 3) {
        let wrong;
        const offset = Math.floor(Math.random() * 10) + 1;
        wrong = Math.random() < 0.5 ? answer + offset : answer - offset;
        if (wrong !== answer && wrong >= 0 && !wrongAnswers.has(wrong)) {
          wrongAnswers.add(wrong);
        }
      }

      const options = [answer, ...wrongAnswers];
      for (let i = options.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [options[i], options[j]] = [options[j], options[i]];
      }

      return { text: `${a} ${op} ${b} = ?`, answer, options };
    }

    function generateAllQuestions() {
      questions = [];
      for (let i = 0; i < totalQuestions; i++) {
        questions.push(generateQuestion());
      }
    }

    function startGame() {
      generateAllQuestions();
      currentQuestion = 0;
      score = 0;
      startTime = Date.now();

      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('game-screen').style.display = 'block';
      document.getElementById('completion-screen').style.display = 'none';

      showQuestion();
    }

    function showQuestion() {
      if (currentQuestion >= totalQuestions) {
        showCompletion();
        return;
      }

      answering = false;
      const q = questions[currentQuestion];

      document.getElementById('question').textContent = q.text;
      document.getElementById('question-num').textContent = currentQuestion + 1;
      document.getElementById('score').textContent = score;
      document.getElementById('progress').style.width = `${((currentQuestion + 1) / totalQuestions) * 100}%`;

      const answersDiv = document.getElementById('answers');
      answersDiv.innerHTML = '';

      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = opt;
        btn.onclick = () => selectAnswer(opt, btn);
        btn.setAttribute('data-testid', `answer-${i}`);
        answersDiv.appendChild(btn);
      });

      timeLeft = 15;
      updateTimerDisplay();
      clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timer);
          timeUp();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const el = document.getElementById('timer');
      el.textContent = T.timerText(timeLeft);
      el.className = timeLeft <= 5 ? 'timer timer-urgent' : 'timer';
    }

    function selectAnswer(selected, btn) {
      if (answering) return;
      answering = true;
      clearInterval(timer);

      const q = questions[currentQuestion];
      const allBtns = document.querySelectorAll('.answer-btn');
      allBtns.forEach(b => b.disabled = true);

      if (selected === q.answer) {
        btn.classList.add('correct');
        score++;
        spawnStars(btn);
      } else {
        btn.classList.add('wrong');
        allBtns.forEach(b => {
          if (parseInt(b.textContent) === q.answer) {
            b.classList.add('correct');
          }
        });
      }

      currentQuestion++;
      setTimeout(showQuestion, 1200);
    }

    function timeUp() {
      answering = true;
      const q = questions[currentQuestion];
      const allBtns = document.querySelectorAll('.answer-btn');
      allBtns.forEach(b => {
        b.disabled = true;
        if (parseInt(b.textContent) === q.answer) {
          b.classList.add('correct');
        }
      });

      document.getElementById('hint').textContent = T.timeUp;
      currentQuestion++;
      setTimeout(() => {
        document.getElementById('hint').textContent = '';
        showQuestion();
      }, 1500);
    }

    function spawnStars(btn) {
      const rect = btn.getBoundingClientRect();
      for (let i = 0; i < 5; i++) {
        const star = document.createElement('div');
        star.className = 'star-particle';
        star.textContent = ['â­', 'âœ¨', 'ğŸŒŸ'][Math.floor(Math.random() * 3)];
        star.style.left = `${rect.left + Math.random() * rect.width}px`;
        star.style.top = `${rect.top}px`;
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 1500);
      }
    }

    function showCompletion() {
      clearInterval(timer);
      const elapsed = Math.round((Date.now() - startTime) / 1000);

      try {
        window.parent.postMessage({
          type: 'GAME_COMPLETE',
          score: score,
          total: totalQuestions,
          timeElapsed: elapsed,
          difficulty: difficulty
        }, '*');
      } catch (e) {}

      document.getElementById('game-screen').style.display = 'none';
      document.getElementById('completion-screen').style.display = 'block';

      document.getElementById('final-score').textContent = score;
      document.getElementById('correct-count').textContent = score;
      document.getElementById('wrong-count').textContent = totalQuestions - score;
      document.getElementById('total-time').textContent = `${elapsed}s`;

      let title = T.titles[0];
      if (score >= 10) title = T.titles[10];
      else if (score >= 8) title = T.titles[8];
      else if (score >= 6) title = T.titles[6];
      else if (score >= 4) title = T.titles[4];

      document.getElementById('completion-title').textContent = title;

      if (score >= 8) {
        for (let i = 0; i < 15; i++) {
          setTimeout(() => {
            const star = document.createElement('div');
            star.className = 'star-particle';
            star.textContent = ['â­', 'âœ¨', 'ğŸŒŸ', 'ğŸ‰', 'ğŸ†'][Math.floor(Math.random() * 5)];
            star.style.left = `${Math.random() * window.innerWidth}px`;
            star.style.top = `${window.innerHeight * 0.6}px`;
            document.body.appendChild(star);
            setTimeout(() => star.remove(), 1500);
          }, i * 100);
        }
      }
    }

    function resetGame() {
      document.getElementById('completion-screen').style.display = 'none';
      document.getElementById('start-screen').style.display = 'block';
    }

    // ===== Init =====
    applyTranslations();
  </script>
</body>
</html>
