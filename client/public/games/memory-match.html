<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>مملكة الذاكرة - Memory Kingdom</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;user-select:none;-webkit-tap-highlight-color:transparent}
.screen{display:none;width:100%;height:100%;position:absolute;top:0;left:0;z-index:1}
.screen.active{display:flex}

/* === DYNAMIC BACKGROUND CANVAS === */
#bg-canvas{position:absolute;inset:0;pointer-events:none;z-index:0;width:100%;height:100%}
.g-hdr,.grid-wrap,.hint,.g-foot{position:relative;z-index:1}

/* === LEVEL SELECT === */
#lvl-screen{flex-direction:column;align-items:center;padding:clamp(8px,2vmin,16px);gap:clamp(6px,1.5vmin,12px);overflow-y:auto;background:var(--bg,linear-gradient(135deg,#667eea,#764ba2))}
.ls-title{font-size:clamp(26px,7vmin,40px);font-weight:900;color:#fff;text-shadow:0 3px 12px rgba(0,0,0,.4);text-align:center;flex-shrink:0}
.ls-sub{font-size:clamp(14px,2.8vmin,18px);color:rgba(255,255,255,.9);text-align:center;flex-shrink:0;font-weight:600}
.ls-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:clamp(6px,1.5vmin,10px);width:100%;max-width:480px;padding:clamp(4px,1vmin,8px) 0}
.lc{position:relative;background:linear-gradient(145deg,rgba(255,255,255,.35),rgba(255,255,255,.15));border:3px solid rgba(255,255,255,.45);border-radius:clamp(14px,3vmin,22px);padding:clamp(8px,2vmin,16px) clamp(4px,1vmin,8px);text-align:center;cursor:pointer;transition:all .25s;backdrop-filter:blur(6px);box-shadow:0 6px 0 rgba(0,0,0,.12),0 10px 24px rgba(0,0,0,.08);transform-style:preserve-3d;animation:cardFloat 3s ease-in-out infinite}
.lc:nth-child(even){animation-delay:.5s}.lc:nth-child(3n){animation-delay:1s}.lc:nth-child(4n+1){animation-delay:1.5s}
.lc:hover{transform:translateY(-4px) scale(1.06);background:linear-gradient(145deg,rgba(255,255,255,.45),rgba(255,255,255,.25));box-shadow:0 10px 0 rgba(0,0,0,.1),0 16px 32px rgba(0,0,0,.1)}
.lc:active{transform:translateY(3px) scale(.97);box-shadow:0 2px 0 rgba(0,0,0,.15),0 3px 8px rgba(0,0,0,.08)}
.lc.locked{opacity:.5;cursor:not-allowed;animation:none}
.lc.locked:hover{transform:none;background:rgba(255,255,255,.15);box-shadow:0 6px 0 rgba(0,0,0,.12),0 10px 24px rgba(0,0,0,.08)}
.lc.current{border-color:#fbbf24;box-shadow:0 6px 0 rgba(251,191,36,.3),0 0 18px rgba(251,191,36,.5)}
.lc-num{font-size:clamp(22px,5vmin,32px);font-weight:900;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.3)}
.lc-emoji{font-size:clamp(32px,7vmin,48px);margin:3px 0;filter:drop-shadow(0 2px 3px rgba(0,0,0,.2));animation:emojiWiggle 2.5s ease-in-out infinite}
.lc:nth-child(2n) .lc-emoji{animation-delay:.3s}.lc:nth-child(3n) .lc-emoji{animation-delay:.7s}.lc:nth-child(4n) .lc-emoji{animation-delay:1.1s}.lc.locked .lc-emoji{animation:none}
.lc-name{font-size:clamp(10px,1.8vmin,14px);color:#fff;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-shadow:0 1px 3px rgba(0,0,0,.3)}
.lc-stars{font-size:clamp(14px,2.8vmin,18px);margin-top:3px}
.lc-lock{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:clamp(32px,7vmin,46px);filter:drop-shadow(0 2px 6px rgba(0,0,0,.4))}

/* Level card group color hints */
.lc[data-grp="0"]{border-left:3px solid rgba(34,197,94,.6)}
.lc[data-grp="1"]{border-left:3px solid rgba(14,165,233,.6)}
.lc[data-grp="2"]{border-left:3px solid rgba(249,115,22,.6)}
.lc[data-grp="3"]{border-left:3px solid rgba(245,158,11,.6)}
.lc[data-grp="4"]{border-left:3px solid rgba(168,85,247,.6)}

/* === GAME === */
#game-screen{flex-direction:column;align-items:center;padding:clamp(4px,1vmin,10px);gap:clamp(3px,.8vmin,6px);background:var(--bg,linear-gradient(135deg,#667eea,#764ba2));transition:background .5s;position:relative}
.g-hdr{width:100%;max-width:540px;display:flex;align-items:center;justify-content:space-between;gap:6px;flex-shrink:0}
.g-title{font-size:clamp(16px,3.2vmin,22px);font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.3)}
.g-badge{font-size:clamp(12px,2.2vmin,16px);background:rgba(255,255,255,.3);color:#fff;border-radius:20px;padding:3px 10px;font-weight:800}
.g-stats{display:flex;gap:clamp(4px,1vmin,8px);align-items:center}
.g-stat{text-align:center;background:rgba(255,255,255,.15);border-radius:8px;padding:2px 8px;backdrop-filter:blur(4px)}
.g-sv{font-size:clamp(18px,3.5vmin,24px);font-weight:900;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.3)}
.g-sl{font-size:clamp(10px,1.8vmin,12px);color:rgba(255,255,255,.8);text-transform:uppercase;font-weight:600}
.grid-wrap{flex:1;display:flex;align-items:center;justify-content:center;width:100%;min-height:0}
.grid{display:grid;gap:clamp(3px,1vmin,6px);perspective:1000px}

/* === BASE CARD STYLES === */
.card{aspect-ratio:1;border:none;background:transparent;cursor:pointer;padding:0;outline:none;-webkit-tap-highlight-color:transparent}
.card:disabled{cursor:default}
.card-inner{position:relative;width:100%;height:100%;transition:transform .45s ease;transform-style:preserve-3d;border-radius:clamp(8px,2vmin,14px)}
.card.flipped .card-inner{transform:rotateY(180deg)}
.card-front,.card-back{position:absolute;inset:0;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:clamp(8px,2vmin,14px);display:flex;align-items:center;justify-content:center}
.card-front{background:linear-gradient(145deg,var(--cf1,#6366f1),var(--cf2,#4f46e5));box-shadow:0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12);border:3px solid rgba(255,255,255,.3);transform-style:preserve-3d}
.card-front .icon{font-size:clamp(1.6rem,5.5vmin,2.6rem);filter:drop-shadow(0 1px 2px rgba(0,0,0,.15));animation:emojiWiggle 3s ease-in-out infinite}
.card:not(.flipped):not(.matched):hover .card-front{box-shadow:0 8px 0 rgba(0,0,0,.18),0 12px 24px rgba(0,0,0,.15);transform:scale(1.06);transition:transform .15s}
.card:not(.flipped):not(.matched):active .card-front{transform:scale(.96);box-shadow:0 2px 0 rgba(0,0,0,.2),0 3px 8px rgba(0,0,0,.1)}
.card-back{background:linear-gradient(145deg,#fff,#f1f5f9);box-shadow:0 5px 0 rgba(99,102,241,.15),0 8px 16px rgba(0,0,0,.08);transform:rotateY(180deg);border:3px solid rgba(99,102,241,.25)}
.card-back .sym{font-size:clamp(2rem,7vmin,3.2rem);filter:drop-shadow(0 1px 3px rgba(0,0,0,.15));animation:emojiBreath 2s ease-in-out infinite}
.card.matched .card-inner{transform:rotateY(180deg)}
.card.matched .card-back{background:linear-gradient(145deg,#d1fae5,#a7f3d0);border-color:rgba(16,185,129,.3);box-shadow:0 0 16px rgba(16,185,129,.25);animation:mpop .4s ease}
@keyframes mpop{0%{transform:rotateY(180deg) scale(1)}50%{transform:rotateY(180deg) scale(1.12)}100%{transform:rotateY(180deg) scale(1)}}

/* ===== GROUP 0: NATURE (Levels 1-4) — Soft Rounded, Gentle ===== */
[data-group="0"] .card-inner,
[data-group="0"] .card-front,
[data-group="0"] .card-back{border-radius:clamp(16px,4vmin,24px) !important}
[data-group="0"] .card-inner{transition:transform .5s ease !important}
[data-group="0"] .card.matched .card-back{
  background:linear-gradient(145deg,#dcfce7,#bbf7d0) !important;
  border-color:rgba(34,197,94,.4) !important;
  animation:matchNature 1.5s ease-in-out infinite !important}
@keyframes matchNature{
  0%,100%{box-shadow:0 0 8px rgba(34,197,94,.25),0 4px 0 rgba(16,185,129,.15)}
  50%{box-shadow:0 0 22px rgba(34,197,94,.55),0 0 44px rgba(34,197,94,.15),0 4px 0 rgba(16,185,129,.15)}}

/* ===== GROUP 1: OCEAN (Levels 5-8) — Organic Blob, Wavy ===== */
[data-group="1"] .card-inner,
[data-group="1"] .card-front,
[data-group="1"] .card-back{border-radius:30% 70% 60% 40% / 55% 35% 65% 45% !important}
[data-group="1"] .card-inner{transition:transform .55s cubic-bezier(.25,.8,.25,1) !important}
[data-group="1"] .card-front{border:3px solid rgba(14,165,233,.4) !important}
[data-group="1"] .card.matched .card-back{
  background:linear-gradient(145deg,#e0f2fe,#bae6fd) !important;
  border-color:rgba(14,165,233,.4) !important;
  animation:matchOcean 1.3s ease-in-out infinite !important}
@keyframes matchOcean{
  0%,100%{transform:rotateY(180deg) scale(1);box-shadow:0 0 8px rgba(14,165,233,.2),0 4px 0 rgba(14,165,233,.15)}
  50%{transform:rotateY(180deg) scale(1.05);box-shadow:0 0 24px rgba(14,165,233,.5),0 0 48px rgba(14,165,233,.12),0 4px 0 rgba(14,165,233,.15)}}

/* ===== GROUP 2: CITY/FOOD (Levels 9-12) — Circle, Bouncy ===== */
[data-group="2"] .card-inner,
[data-group="2"] .card-front,
[data-group="2"] .card-back{border-radius:50% !important}
[data-group="2"] .card-inner{transition:transform .45s cubic-bezier(.34,1.8,.64,1) !important}
[data-group="2"] .card.flipped .card-inner{transform:rotateY(180deg) scale(1.03) !important}
[data-group="2"] .card.matched .card-inner{transform:rotateY(180deg) scale(1) !important}
[data-group="2"] .card.matched .card-back{
  background:linear-gradient(145deg,#fff7ed,#fed7aa) !important;
  animation:matchCity 2.2s linear infinite !important}
@keyframes matchCity{
  0%{border-color:rgba(239,68,68,.5);box-shadow:0 0 12px rgba(239,68,68,.3)}
  25%{border-color:rgba(245,158,11,.5);box-shadow:0 0 12px rgba(245,158,11,.3)}
  50%{border-color:rgba(34,197,94,.5);box-shadow:0 0 12px rgba(34,197,94,.3)}
  75%{border-color:rgba(59,130,246,.5);box-shadow:0 0 12px rgba(59,130,246,.3)}
  100%{border-color:rgba(239,68,68,.5);box-shadow:0 0 12px rgba(239,68,68,.3)}}

/* ===== GROUP 3: ADVENTURE (Levels 13-16) — Sharp + Gold Border ===== */
[data-group="3"] .card-inner,
[data-group="3"] .card-front,
[data-group="3"] .card-back{border-radius:clamp(5px,1.2vmin,8px) !important}
[data-group="3"] .card-inner{transition:transform .4s cubic-bezier(.4,0,.2,1) !important}
[data-group="3"] .card.flipped .card-inner{transform:rotateY(180deg) rotateZ(2deg) !important}
[data-group="3"] .card.matched .card-inner{transform:rotateY(180deg) rotateZ(0deg) !important}
[data-group="3"] .card-front{border:3px solid rgba(245,158,11,.5) !important}
[data-group="3"] .card.matched .card-back{
  background:linear-gradient(145deg,#fef9c3,#fde68a) !important;
  border-color:rgba(245,158,11,.5) !important;
  animation:matchAdventure 1.5s ease-in-out infinite !important}
@keyframes matchAdventure{
  0%,100%{box-shadow:0 0 6px rgba(245,158,11,.3)}
  30%{box-shadow:0 0 18px rgba(245,158,11,.6),0 0 36px rgba(245,158,11,.15)}
  60%{box-shadow:0 0 10px rgba(234,88,12,.4)}}

/* ===== GROUP 4: TECH/BOSS (Levels 17-20) — Sharp Neon ===== */
[data-group="4"] .card-inner,
[data-group="4"] .card-front,
[data-group="4"] .card-back{border-radius:3px !important}
[data-group="4"] .card-inner{transition:transform .22s cubic-bezier(.7,0,.3,1) !important}
[data-group="4"] .card-front{border:2px solid rgba(168,85,247,.5) !important;box-shadow:0 0 8px rgba(168,85,247,.2),0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12) !important}
[data-group="4"] .card:not(.flipped):not(.matched):hover .card-front{box-shadow:0 0 14px rgba(168,85,247,.4),0 8px 0 rgba(0,0,0,.15),0 12px 24px rgba(0,0,0,.15) !important}
[data-group="4"] .card.matched .card-back{
  background:linear-gradient(145deg,#f3e8ff,#e9d5ff) !important;
  border-color:rgba(168,85,247,.5) !important;
  animation:matchTech 1s ease-in-out infinite !important}
@keyframes matchTech{
  0%,100%{box-shadow:0 0 4px rgba(168,85,247,.4),0 0 8px rgba(168,85,247,.15)}
  50%{box-shadow:0 0 14px rgba(168,85,247,.7),0 0 28px rgba(168,85,247,.25),0 0 56px rgba(168,85,247,.08)}}

/* === MECHANIC OVERLAYS === */
.card .fog-ov{position:absolute;inset:0;background:rgba(180,190,220,.88);border-radius:inherit;display:flex;align-items:center;justify-content:center;z-index:10;font-size:clamp(1.4rem,4.5vmin,2.2rem);cursor:pointer;transition:all .4s;backdrop-filter:blur(10px);border:2px solid rgba(255,255,255,.15)}
.card .fog-ov:active{transform:scale(.9)}
.card.decoy-show .card-back .sym{animation:decoyShake .3s ease 2}
@keyframes decoyShake{0%,100%{transform:rotate(0) scale(1)}25%{transform:rotate(-12deg) scale(1.1)}75%{transform:rotate(12deg) scale(1.1)}}
.card.shuffle-anim{animation:shuffleCard .5s cubic-bezier(.34,1.56,.64,1)}
@keyframes shuffleCard{0%{transform:scale(.6) rotate(20deg);opacity:.3}60%{transform:scale(1.08) rotate(-3deg);opacity:1}100%{transform:scale(1) rotate(0);opacity:1}}
.mech-info{position:relative;z-index:12;text-align:center;background:rgba(0,0,0,.35);color:#fff;font-size:clamp(11px,2.2vmin,14px);padding:3px 14px;border-radius:16px;font-weight:700;backdrop-filter:blur(4px);flex-shrink:0;max-width:90%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cd-wrap{position:relative;z-index:12;width:100%;max-width:540px;flex-shrink:0}
.cd-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}
.cd-bar{width:100%;height:6px;background:rgba(255,255,255,.15);border-radius:3px;overflow:hidden}
.cd-fill{height:100%;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444);transition:width 1s linear;border-radius:3px}
.cd-txt{font-size:clamp(11px,2vmin,14px);font-weight:900;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.4)}
.cd-txt.urgent{color:#ef4444;animation:urgPulse .5s ease-in-out infinite}
@keyframes urgPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.15)}}
.peek-banner{position:absolute;inset:0;z-index:20;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.35);pointer-events:none;border-radius:8px;opacity:0;transition:opacity .3s}
.peek-banner.show{opacity:1}
.peek-banner span{color:#fff;font-size:clamp(18px,5vmin,28px);font-weight:900;text-shadow:0 2px 8px rgba(0,0,0,.5);animation:peekPulse 1s ease-in-out infinite}
@keyframes peekPulse{0%,100%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.1)}}

/* === DDA SYSTEM === */
.dda-badge{position:relative;z-index:12;display:inline-flex;align-items:center;gap:4px;background:rgba(0,0,0,.25);color:#fff;font-size:clamp(10px,1.8vmin,12px);padding:2px 10px;border-radius:12px;font-weight:700;backdrop-filter:blur(4px);flex-shrink:0;transition:all .5s;white-space:nowrap}
.dda-badge.easy{background:rgba(34,197,94,.35);border:1px solid rgba(34,197,94,.4)}
.dda-badge.normal{background:rgba(59,130,246,.3);border:1px solid rgba(59,130,246,.3)}
.dda-badge.hard{background:rgba(239,68,68,.3);border:1px solid rgba(239,68,68,.3)}
.card.dda-hint .card-front{animation:ddaHintGlow 1.2s ease-in-out 3}
@keyframes ddaHintGlow{0%,100%{box-shadow:0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12)}50%{box-shadow:0 0 16px rgba(251,191,36,.6),0 0 32px rgba(251,191,36,.2),0 5px 0 rgba(0,0,0,.15)}}

/* === DDA v2: 3-Level Progressive Hint CSS === */
/* Level 1: Gentle subtle glow — one card pulses softly */
.card.dda-hint-l1 .card-front{animation:ddaHintL1 1.5s ease-in-out 2}
@keyframes ddaHintL1{
  0%,100%{box-shadow:0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12)}
  50%{box-shadow:0 0 10px rgba(251,191,36,.3),0 0 20px rgba(251,191,36,.1),0 5px 0 rgba(0,0,0,.15)}}
/* Level 2: Highlight pair — both cards glow brightly */
.card.dda-hint-l2 .card-front{animation:ddaHintL2 1.2s ease-in-out 3}
@keyframes ddaHintL2{
  0%,100%{box-shadow:0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12);transform:scale(1)}
  50%{box-shadow:0 0 20px rgba(251,191,36,.7),0 0 40px rgba(251,191,36,.25),0 5px 0 rgba(0,0,0,.12);transform:scale(1.05)}}
/* Level 3: Quick peek — card briefly flips with golden border */
.card.dda-hint-l3 .card-inner{transition:transform .3s ease !important}
.card.dda-hint-l3 .card-back{border-color:rgba(251,191,36,.7) !important;box-shadow:0 0 16px rgba(251,191,36,.5) !important}
.cd-wrap.level-timer{display:block}
.cd-fill.paused{animation:none !important;transition:none !important}

/* === COINS DISPLAY === */
.coins-bar{display:flex;align-items:center;justify-content:center;gap:clamp(8px,2vmin,14px);flex-shrink:0;flex-wrap:wrap}
.coin-display{display:inline-flex;align-items:center;gap:4px;background:linear-gradient(135deg,rgba(251,191,36,.35),rgba(245,158,11,.25));border:2px solid rgba(251,191,36,.5);border-radius:20px;padding:4px 14px;font-size:clamp(14px,2.8vmin,18px);font-weight:900;color:#fbbf24;text-shadow:0 1px 4px rgba(0,0,0,.3);backdrop-filter:blur(4px)}
.coin-display .coin-icon{font-size:clamp(16px,3vmin,22px);animation:coinSpin 3s linear infinite}
@keyframes coinSpin{0%,80%{transform:rotateY(0)}90%{transform:rotateY(180deg)}100%{transform:rotateY(360deg)}}
.nav-btn{background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.3);border-radius:14px;padding:6px 14px;font-size:clamp(12px,2.2vmin,16px);font-weight:800;color:#fff;cursor:pointer;transition:all .25s;backdrop-filter:blur(4px);text-shadow:0 1px 3px rgba(0,0,0,.2)}
.nav-btn:hover{background:rgba(255,255,255,.35);transform:translateY(-2px) scale(1.05)}
.nav-btn:active{transform:translateY(1px) scale(.96)}
.nav-btn.shop{border-color:rgba(251,191,36,.5);background:linear-gradient(135deg,rgba(251,191,36,.2),rgba(245,158,11,.15))}
.nav-btn.badges{border-color:rgba(168,85,247,.5);background:linear-gradient(135deg,rgba(168,85,247,.2),rgba(139,92,246,.15))}

/* === COIN EARN ANIMATION (done screen) === */
.coin-earned{display:flex;align-items:center;justify-content:center;gap:6px;font-size:clamp(18px,4vmin,26px);font-weight:900;color:#fbbf24;text-shadow:0 2px 8px rgba(0,0,0,.3);animation:coinBounceIn .6s cubic-bezier(.34,1.56,.64,1)}
@keyframes coinBounceIn{0%{opacity:0;transform:scale(0) rotate(-20deg)}60%{transform:scale(1.2) rotate(5deg)}100%{opacity:1;transform:scale(1) rotate(0)}}
.coin-fly{position:fixed;pointer-events:none;z-index:9999;font-size:28px;animation:coinFlyUp 1.2s ease-out forwards}
@keyframes coinFlyUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-120px) scale(.4)}}

/* === SHOP SCREEN === */
#shop-screen{flex-direction:column;align-items:center;padding:clamp(8px,2vmin,16px);gap:clamp(8px,2vmin,14px);overflow-y:auto;background:var(--bg,linear-gradient(135deg,#fbbf24,#f59e0b))}
.shop-title{font-size:clamp(26px,7vmin,40px);font-weight:900;color:#fff;text-shadow:0 3px 12px rgba(0,0,0,.4);text-align:center;flex-shrink:0}
.shop-coins{font-size:clamp(16px,3vmin,20px);font-weight:800;color:#fef08a;text-shadow:0 1px 4px rgba(0,0,0,.3);flex-shrink:0}
.shop-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:clamp(8px,2vmin,12px);width:100%;max-width:480px;padding:clamp(4px,1vmin,8px) 0}
.shop-item{position:relative;background:linear-gradient(145deg,rgba(255,255,255,.3),rgba(255,255,255,.12));border:3px solid rgba(255,255,255,.35);border-radius:clamp(14px,3vmin,22px);padding:clamp(10px,2.5vmin,16px);text-align:center;cursor:pointer;transition:all .25s;backdrop-filter:blur(6px)}
.shop-item:hover{transform:translateY(-4px) scale(1.04);background:rgba(255,255,255,.35)}
.shop-item:active{transform:translateY(2px) scale(.97)}
.shop-item.equipped{border-color:#22c55e;box-shadow:0 0 16px rgba(34,197,94,.4)}
.shop-item.owned{border-color:rgba(59,130,246,.5)}
.shop-item.locked{opacity:.7}
.si-preview{width:60px;height:60px;margin:0 auto 6px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px;box-shadow:0 4px 0 rgba(0,0,0,.15),0 6px 12px rgba(0,0,0,.1)}
.si-name{font-size:clamp(13px,2.4vmin,16px);font-weight:800;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.3)}
.si-price{font-size:clamp(12px,2vmin,14px);font-weight:700;color:#fef08a;margin-top:2px}
.si-btn{margin-top:6px;border:none;border-radius:10px;padding:5px 16px;font-size:clamp(11px,2vmin,14px);font-weight:800;cursor:pointer;transition:all .2s}
.si-btn.buy{background:linear-gradient(135deg,#f59e0b,#f97316);color:#fff;box-shadow:0 3px 0 #c2410c}
.si-btn.equip{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;box-shadow:0 3px 0 #1d4ed8}
.si-btn.equipped{background:rgba(34,197,94,.5);color:#fff;cursor:default}
.si-btn.cant{background:rgba(255,255,255,.15);color:rgba(255,255,255,.5);cursor:not-allowed}
.si-btn:active:not(.cant):not(.equipped){transform:translateY(2px)}

/* === BADGE SCREEN === */
#badge-screen{flex-direction:column;align-items:center;padding:clamp(8px,2vmin,16px);gap:clamp(8px,2vmin,14px);overflow-y:auto;background:var(--bg,linear-gradient(135deg,#a855f7,#7c3aed))}
.badge-title{font-size:clamp(26px,7vmin,40px);font-weight:900;color:#fff;text-shadow:0 3px 12px rgba(0,0,0,.4);text-align:center;flex-shrink:0}
.badge-sub{font-size:clamp(14px,2.8vmin,18px);color:rgba(255,255,255,.85);font-weight:600;flex-shrink:0}
.badge-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:clamp(8px,2vmin,12px);width:100%;max-width:480px;padding:clamp(4px,1vmin,8px) 0}
.badge-card{background:linear-gradient(145deg,rgba(255,255,255,.25),rgba(255,255,255,.1));border:3px solid rgba(255,255,255,.3);border-radius:clamp(14px,3vmin,22px);padding:clamp(10px,2.5vmin,16px);text-align:center;transition:all .25s;backdrop-filter:blur(6px)}
.badge-card.unlocked{border-color:rgba(251,191,36,.5);box-shadow:0 0 14px rgba(251,191,36,.3);animation:badgeGlow 2.5s ease-in-out infinite}
@keyframes badgeGlow{0%,100%{box-shadow:0 0 8px rgba(251,191,36,.2)}50%{box-shadow:0 0 20px rgba(251,191,36,.5)}}
.badge-card.locked{opacity:.55}
.bc-emoji{font-size:clamp(36px,8vmin,52px);filter:drop-shadow(0 2px 6px rgba(0,0,0,.3))}
.badge-card.locked .bc-emoji{filter:grayscale(1) drop-shadow(0 2px 6px rgba(0,0,0,.2))}
.bc-name{font-size:clamp(12px,2.2vmin,15px);font-weight:800;color:#fff;margin-top:4px;text-shadow:0 1px 3px rgba(0,0,0,.3)}
.bc-desc{font-size:clamp(10px,1.8vmin,12px);color:rgba(255,255,255,.75);margin-top:2px;font-weight:600}
.bc-date{font-size:clamp(9px,1.5vmin,11px);color:rgba(255,255,255,.5);margin-top:3px}

/* === NEW BADGE POPUP === */
.badge-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);z-index:10000;background:linear-gradient(135deg,#1e1b4b,#312e81);border:3px solid #fbbf24;border-radius:24px;padding:24px 32px;text-align:center;animation:badgePopIn .6s cubic-bezier(.34,1.56,.64,1) forwards;box-shadow:0 0 60px rgba(251,191,36,.3),0 20px 40px rgba(0,0,0,.4)}
@keyframes badgePopIn{0%{transform:translate(-50%,-50%) scale(0) rotate(-10deg);opacity:0}100%{transform:translate(-50%,-50%) scale(1) rotate(0);opacity:1}}
.badge-popup .bp-emoji{font-size:60px;animation:emojiWiggle 1.5s ease-in-out infinite}
.badge-popup .bp-title{font-size:20px;font-weight:900;color:#fbbf24;margin-top:8px;text-shadow:0 2px 8px rgba(0,0,0,.3)}
.badge-popup .bp-name{font-size:16px;color:#e9d5ff;margin-top:4px;font-weight:700}
.badge-popup .bp-close{margin-top:12px;border:none;background:rgba(255,255,255,.15);color:#fff;border-radius:10px;padding:6px 24px;font-size:14px;font-weight:700;cursor:pointer}

/* === BADGE PROGRESS BAR === */
.bc-progress{width:80%;margin:6px auto 0;height:5px;background:rgba(255,255,255,.15);border-radius:4px;overflow:hidden}
.bc-prog-fill{height:100%;background:linear-gradient(90deg,#fbbf24,#f59e0b);border-radius:4px;transition:width .4s ease}

/* === XP BAR === */
.xp-bar-wrap{display:flex;align-items:center;gap:6px;width:100%;max-width:320px;padding:0 4px}
.xp-level{font-size:clamp(12px,2.2vmin,16px);font-weight:900;color:#fef08a;text-shadow:0 1px 4px rgba(0,0,0,.3);white-space:nowrap;min-width:fit-content}
.xp-bar{flex:1;height:clamp(8px,1.5vmin,12px);background:rgba(0,0,0,.2);border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,.15)}
.xp-fill{height:100%;background:linear-gradient(90deg,#34d399,#10b981,#059669);border-radius:8px;transition:width .5s ease;box-shadow:0 0 8px rgba(52,211,153,.4)}
.xp-text{font-size:clamp(9px,1.6vmin,12px);color:rgba(255,255,255,.8);font-weight:600;white-space:nowrap}

/* === STREAK DISPLAY === */
.streak-display{font-size:clamp(12px,2.2vmin,16px);font-weight:800;color:#fbbf24;text-shadow:0 1px 4px rgba(0,0,0,.3);text-align:center;animation:streakPulse 2s ease-in-out infinite}
@keyframes streakPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

/* === XP LEVEL-UP POPUP === */
.xp-levelup-popup{position:fixed;top:15%;left:50%;transform:translateX(-50%) scale(0);z-index:9999;background:linear-gradient(135deg,#065f46,#047857);border:3px solid #34d399;border-radius:20px;padding:18px 28px;text-align:center;animation:xpLevelIn .5s cubic-bezier(.34,1.56,.64,1) forwards;box-shadow:0 0 40px rgba(52,211,153,.3),0 15px 30px rgba(0,0,0,.3)}
@keyframes xpLevelIn{0%{transform:translateX(-50%) scale(0) rotate(-8deg);opacity:0}100%{transform:translateX(-50%) scale(1) rotate(0);opacity:1}}
.xp-lu-icon{font-size:42px}
.xp-lu-title{font-size:16px;font-weight:900;color:#34d399;margin-top:4px}
.xp-lu-name{font-size:14px;color:#a7f3d0;font-weight:700;margin-top:2px}

/* === DONE SCREEN XP/STREAK ROWS === */
.d-xp{font-size:clamp(14px,2.5vmin,18px);font-weight:800;color:#34d399;text-shadow:0 1px 4px rgba(0,0,0,.3);display:none}
.d-streak{font-size:clamp(13px,2.2vmin,16px);font-weight:800;color:#fbbf24;text-shadow:0 1px 4px rgba(0,0,0,.3);display:none}

/* === PRESTIGE BADGE === */
.prestige-badge{display:inline-flex;align-items:center;gap:3px;background:linear-gradient(135deg,#b45309,#f59e0b);border-radius:8px;padding:2px 8px;font-size:clamp(10px,1.8vmin,13px);font-weight:900;color:#fff;box-shadow:0 2px 8px rgba(180,83,9,.3)}
.prestige-badge.hidden{display:none}

/* === FOOTER & MISC === */
.g-foot{display:flex;gap:clamp(4px,1vmin,8px);flex-shrink:0;flex-wrap:wrap;justify-content:center}
.f-btn{background:rgba(255,255,255,.25);border:none;border-radius:12px;padding:clamp(7px,1.8vmin,12px) clamp(14px,3.5vmin,24px);font-size:clamp(14px,2.5vmin,18px);font-weight:800;color:#fff;cursor:pointer;transition:all .2s;text-shadow:0 1px 3px rgba(0,0,0,.3)}
.f-btn:hover{background:rgba(255,255,255,.35);transform:scale(1.04)}
.f-btn:active{transform:scale(.95)}
.hint{color:rgba(255,255,255,.9);font-size:clamp(14px,2.5vmin,18px);font-weight:600;flex-shrink:0;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:.7}50%{opacity:1}}

/* === COMPLETE === */
#done-screen{flex-direction:column;align-items:center;justify-content:center;gap:clamp(8px,2vmin,16px);padding:clamp(12px,3vmin,24px);background:var(--bg,linear-gradient(135deg,#667eea,#764ba2))}
.d-emoji{font-size:clamp(56px,14vmin,84px);animation:bounce 1s ease infinite;filter:drop-shadow(0 4px 12px rgba(0,0,0,.3))}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.d-title{font-size:clamp(24px,7vmin,38px);font-weight:900;color:#fff;text-shadow:0 3px 12px rgba(0,0,0,.4)}
.d-sub{font-size:clamp(14px,2.8vmin,18px);color:rgba(255,255,255,.9);text-align:center;font-weight:600}
.d-stars{display:flex;gap:clamp(5px,1.2vmin,8px);font-size:clamp(36px,9vmin,54px);filter:drop-shadow(0 2px 6px rgba(0,0,0,.3))}
.d-stats{display:flex;gap:clamp(8px,2vmin,16px);flex-wrap:wrap;justify-content:center}
.d-st{text-align:center;background:rgba(255,255,255,.2);border-radius:12px;padding:clamp(6px,1.5vmin,12px) clamp(10px,2.5vmin,18px);backdrop-filter:blur(4px)}
.d-st-e{font-size:clamp(24px,6vmin,36px);filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}
.d-st-v{font-size:clamp(20px,4.5vmin,28px);font-weight:900;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.3)}
.d-st-l{font-size:clamp(10px,1.8vmin,13px);color:rgba(255,255,255,.8);text-transform:uppercase;font-weight:600}
.d-btns{display:flex;gap:clamp(6px,1.5vmin,10px);flex-wrap:wrap;justify-content:center}
.d-btn{border:none;border-radius:14px;padding:clamp(10px,2.5vmin,16px) clamp(24px,6vmin,40px);font-size:clamp(15px,3vmin,20px);font-weight:900;cursor:pointer;transition:all .2s}
.d-btn:hover{transform:scale(1.04)}.d-btn:active{transform:scale(.95)}
.d-btn.pri{background:linear-gradient(135deg,#f59e0b,#f97316);color:#fff;box-shadow:0 4px 18px rgba(249,115,22,.4)}
.d-btn.sec{background:rgba(255,255,255,.25);color:#fff;backdrop-filter:blur(4px)}
.d-btn.shr{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;box-shadow:0 4px 18px rgba(37,99,235,.4)}
.particle{position:fixed;pointer-events:none;z-index:999;animation:part 1.1s ease-out forwards}
@keyframes part{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-70px) scale(.3)}}
@keyframes cardFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
@keyframes emojiWiggle{0%,100%{transform:scale(1) rotate(0deg)}25%{transform:scale(1.15) rotate(-6deg)}50%{transform:scale(1) rotate(0deg)}75%{transform:scale(1.15) rotate(6deg)}}
@keyframes emojiBreath{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}

/* ===== ROYAL MATCH 3D VISUAL SYSTEM ===== */
#lvl-screen{background-size:300% 300%;animation:royalBG 15s ease infinite}
#done-screen{background-size:300% 300%;animation:royalBG 15s ease infinite}
@keyframes royalBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.screen.active{animation:screenIn .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes screenIn{0%{opacity:0;transform:scale(.93) translateY(12px)}100%{opacity:1;transform:scale(1) translateY(0)}}
.lc{transform-style:preserve-3d;box-shadow:0 6px 0 rgba(0,0,0,.18),0 10px 0 rgba(0,0,0,.08),0 20px 40px rgba(0,0,0,.12),inset 0 1px 0 rgba(255,255,255,.4) !important;background:linear-gradient(160deg,rgba(255,255,255,.5) 0%,rgba(255,255,255,.2) 40%,rgba(255,255,255,.05) 100%) !important;border:2px solid rgba(255,255,255,.55) !important;transition:all .35s cubic-bezier(.34,1.56,.64,1) !important}
.lc:hover{transform:translateY(-8px) scale(1.1) rotateX(5deg) !important;box-shadow:0 12px 0 rgba(0,0,0,.12),0 20px 0 rgba(0,0,0,.05),0 32px 60px rgba(0,0,0,.15),inset 0 1px 0 rgba(255,255,255,.6) !important}
.lc:active{transform:translateY(2px) scale(.96) !important}
.lc.current{animation:currentGlow 2.5s ease-in-out infinite,cardFloat 3s ease-in-out infinite !important;border-color:#fbbf24 !important}
@keyframes currentGlow{0%,100%{box-shadow:0 0 15px rgba(251,191,36,.4),0 6px 0 rgba(0,0,0,.15)}50%{box-shadow:0 0 30px rgba(251,191,36,.7),0 0 60px rgba(251,191,36,.2),0 6px 0 rgba(0,0,0,.12)}}
.card-front{box-shadow:0 6px 0 rgba(0,0,0,.2),0 8px 0 rgba(0,0,0,.1),0 14px 28px rgba(0,0,0,.15),inset 0 2px 0 rgba(255,255,255,.35) !important;background:linear-gradient(165deg,var(--cf1,#6366f1),var(--cf2,#4f46e5),rgba(0,0,0,.15)) !important}
.card:not(.flipped):not(.matched):hover .card-front{box-shadow:0 10px 0 rgba(0,0,0,.15),0 14px 0 rgba(0,0,0,.08),0 20px 36px rgba(0,0,0,.18),inset 0 2px 0 rgba(255,255,255,.4) !important;transform:scale(1.08) !important}
.card:not(.flipped):not(.matched):active .card-front{transform:scale(.94) !important;box-shadow:0 2px 0 rgba(0,0,0,.2),0 3px 6px rgba(0,0,0,.1) !important}
.card-back{box-shadow:0 6px 0 rgba(99,102,241,.2),0 8px 0 rgba(99,102,241,.1),0 14px 24px rgba(0,0,0,.1),inset 0 -2px 0 rgba(0,0,0,.04),inset 0 2px 0 rgba(255,255,255,.6) !important;background:linear-gradient(180deg,#fff,#f5f3ff,#ede9fe) !important}
.g-stat{box-shadow:0 3px 0 rgba(0,0,0,.1),0 4px 8px rgba(0,0,0,.06),inset 0 1px 0 rgba(255,255,255,.2) !important;transition:all .2s}
.f-btn{box-shadow:0 4px 0 rgba(0,0,0,.12),0 6px 10px rgba(0,0,0,.06),inset 0 1px 0 rgba(255,255,255,.2) !important;transition:all .2s cubic-bezier(.34,1.56,.64,1) !important}
.f-btn:hover{transform:translateY(-3px) scale(1.05) !important;box-shadow:0 7px 0 rgba(0,0,0,.1),0 10px 16px rgba(0,0,0,.08) !important}
.f-btn:active{transform:translateY(2px) scale(.96) !important;box-shadow:0 1px 0 rgba(0,0,0,.12) !important}
.d-stars span{display:inline-block;animation:starPop3D .6s cubic-bezier(.34,1.56,.64,1) both}
.d-stars span:nth-child(1){animation-delay:.1s}
.d-stars span:nth-child(2){animation-delay:.3s}
.d-stars span:nth-child(3){animation-delay:.5s}
@keyframes starPop3D{0%{transform:scale(0) rotateY(180deg);opacity:0}60%{transform:scale(1.3) rotateY(45deg);opacity:1}100%{transform:scale(1) rotateY(0deg);opacity:1}}
.d-st{box-shadow:0 4px 0 rgba(0,0,0,.1),0 8px 16px rgba(0,0,0,.08),inset 0 1px 0 rgba(255,255,255,.2) !important;transition:all .3s cubic-bezier(.34,1.56,.64,1)}
.d-st:hover{transform:translateY(-3px) scale(1.05)}
.d-btn.pri{box-shadow:0 6px 0 #c2410c,0 8px 0 #9a3412,0 14px 24px rgba(249,115,22,.3) !important}
.d-btn.pri:hover{transform:translateY(-3px) scale(1.06) !important;box-shadow:0 9px 0 #c2410c,0 12px 0 #9a3412,0 20px 32px rgba(249,115,22,.35) !important}
.d-btn.pri:active{transform:translateY(3px) scale(.96) !important;box-shadow:0 2px 0 #c2410c !important}
.d-btn.shr{box-shadow:0 6px 0 #1d4ed8,0 8px 0 #1e40af,0 14px 24px rgba(37,99,235,.3) !important}
.d-btn.sec{box-shadow:0 4px 0 rgba(0,0,0,.15),0 6px 12px rgba(0,0,0,.08) !important}
.d-emoji{animation:doneBounce3D 1.5s cubic-bezier(.34,1.56,.64,1) infinite !important;filter:drop-shadow(0 8px 20px rgba(0,0,0,.3)) !important}
@keyframes doneBounce3D{0%,100%{transform:translateY(0) scale(1) rotateZ(0)}25%{transform:translateY(-12px) scale(1.05) rotateZ(-3deg)}50%{transform:translateY(-6px) scale(1.02) rotateZ(0)}75%{transform:translateY(-12px) scale(1.05) rotateZ(3deg)}}
.card.flipped .card-inner{transition:transform .5s cubic-bezier(.34,1.56,.64,1) !important}
.grid{filter:drop-shadow(0 4px 16px rgba(0,0,0,.1))}
/* ===== END ROYAL MATCH 3D ===== */

/* ===== WORLD MAP SCREEN ===== */
#world-screen{flex-direction:column;align-items:center;padding:clamp(8px,2vmin,16px);gap:clamp(8px,2vmin,14px);overflow-y:auto;background:linear-gradient(135deg,#1e1b4b,#312e81,#4338ca);background-size:300% 300%;animation:royalBG 15s ease infinite}
.ws-title{font-size:clamp(28px,8vmin,44px);font-weight:900;color:#fff;text-shadow:0 3px 16px rgba(0,0,0,.5);text-align:center;flex-shrink:0}
.ws-sub{font-size:clamp(14px,2.8vmin,18px);color:rgba(255,255,255,.85);text-align:center;font-weight:600;flex-shrink:0}
.world-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:clamp(8px,2vmin,12px);width:100%;max-width:500px;padding:clamp(4px,1vmin,8px) 0}
.wc{position:relative;border:3px solid rgba(255,255,255,.4);border-radius:clamp(16px,4vmin,26px);padding:clamp(10px,2.5vmin,18px) clamp(6px,1.5vmin,10px);text-align:center;cursor:pointer;transition:all .35s cubic-bezier(.34,1.56,.64,1);backdrop-filter:blur(6px);box-shadow:0 6px 0 rgba(0,0,0,.18),0 12px 24px rgba(0,0,0,.12),inset 0 1px 0 rgba(255,255,255,.3);transform-style:preserve-3d;animation:cardFloat 3s ease-in-out infinite;overflow:hidden}
.wc:nth-child(even){animation-delay:.5s}.wc:nth-child(3n){animation-delay:1s}
.wc:hover{transform:translateY(-6px) scale(1.06);box-shadow:0 12px 0 rgba(0,0,0,.1),0 20px 40px rgba(0,0,0,.15)}
.wc:active{transform:translateY(2px) scale(.96)}
.wc.locked{opacity:.5;cursor:not-allowed;animation:none;background:rgba(255,255,255,.08) !important}
.wc.locked:hover{transform:none}
.wc.complete{border-color:#fbbf24;box-shadow:0 0 16px rgba(251,191,36,.4),0 6px 0 rgba(0,0,0,.15)}
.wc-num{position:absolute;top:6px;left:8px;font-size:clamp(11px,2vmin,14px);font-weight:900;color:rgba(255,255,255,.6);background:rgba(0,0,0,.15);border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center}
[dir="rtl"] .wc-num{left:auto;right:8px}
.wc-emoji{font-size:clamp(36px,9vmin,54px);filter:drop-shadow(0 2px 4px rgba(0,0,0,.2));animation:emojiWiggle 2.5s ease-in-out infinite}
.wc-name{font-size:clamp(12px,2.4vmin,16px);font-weight:800;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.3);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.wc-char{font-size:clamp(10px,1.8vmin,13px);color:rgba(255,255,255,.75);font-weight:600}
.wc-prog{margin-top:4px}
.wc-bar{width:100%;height:5px;background:rgba(255,255,255,.15);border-radius:3px;overflow:hidden}
.wc-fill{height:100%;background:linear-gradient(90deg,#fbbf24,#f59e0b);border-radius:3px;transition:width .5s}
.wc-info{font-size:clamp(9px,1.6vmin,12px);color:rgba(255,255,255,.7);font-weight:600;margin-top:2px}
.wc-lock{font-size:clamp(28px,7vmin,42px);filter:drop-shadow(0 2px 6px rgba(0,0,0,.4))}

/* ===== GROUP 5: Desert/Sand — Wavy warm ===== */
[data-group="5"] .card-inner,
[data-group="5"] .card-front,
[data-group="5"] .card-back{border-radius:clamp(12px,3vmin,18px) !important}
[data-group="5"] .card-front{border:3px solid rgba(217,119,6,.4) !important}
[data-group="5"] .card.matched .card-back{
  background:linear-gradient(145deg,#fef3c7,#fde68a) !important;
  border-color:rgba(217,119,6,.4) !important;
  animation:matchAdventure 1.5s ease-in-out infinite !important}

/* ===== GROUP 6: Fantasy/Magic — Ethereal glow ===== */
[data-group="6"] .card-inner,
[data-group="6"] .card-front,
[data-group="6"] .card-back{border-radius:clamp(10px,2.5vmin,16px) !important}
[data-group="6"] .card-front{border:3px solid rgba(139,92,246,.4) !important;box-shadow:0 0 8px rgba(139,92,246,.2),0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12) !important}
[data-group="6"] .card.matched .card-back{
  background:linear-gradient(145deg,#ede9fe,#ddd6fe) !important;
  border-color:rgba(139,92,246,.5) !important;
  animation:matchTech 1s ease-in-out infinite !important}

/* ===== GROUP 7: Candy/Sweet — Rounded bouncy ===== */
[data-group="7"] .card-inner,
[data-group="7"] .card-front,
[data-group="7"] .card-back{border-radius:clamp(18px,4.5vmin,28px) !important}
[data-group="7"] .card-inner{transition:transform .5s cubic-bezier(.34,1.8,.64,1) !important}
[data-group="7"] .card-front{border:3px solid rgba(236,72,153,.4) !important}
[data-group="7"] .card.matched .card-back{
  background:linear-gradient(145deg,#fce7f3,#fbcfe8) !important;
  border-color:rgba(236,72,153,.4) !important;
  animation:matchNature 1.5s ease-in-out infinite !important}

/* ===== GROUP 8: Arctic/Ice — Crystalline ===== */
[data-group="8"] .card-inner,
[data-group="8"] .card-front,
[data-group="8"] .card-back{border-radius:12% 30% 12% 30% / 30% 12% 30% 12% !important}
[data-group="8"] .card-front{border:3px solid rgba(6,182,212,.4) !important}
[data-group="8"] .card.matched .card-back{
  background:linear-gradient(145deg,#ecfeff,#cffafe) !important;
  border-color:rgba(6,182,212,.4) !important;
  animation:matchOcean 1.3s ease-in-out infinite !important}

/* ===== GROUP 9: Royal/Final — Crown glow ===== */
[data-group="9"] .card-inner,
[data-group="9"] .card-front,
[data-group="9"] .card-back{border-radius:clamp(6px,1.5vmin,10px) !important}
[data-group="9"] .card-front{border:3px solid rgba(251,191,36,.5) !important;box-shadow:0 0 10px rgba(251,191,36,.25),0 5px 0 rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.12) !important}
[data-group="9"] .card.matched .card-back{
  background:linear-gradient(145deg,#fef9c3,#fde68a) !important;
  border-color:rgba(251,191,36,.55) !important;
  animation:matchAdventure 1.5s ease-in-out infinite !important}

/* Level card group color hints (expanded to 10) */
.lc[data-grp="0"]{border-left:3px solid rgba(34,197,94,.6)}
.lc[data-grp="1"]{border-left:3px solid rgba(14,165,233,.6)}
.lc[data-grp="2"]{border-left:3px solid rgba(249,115,22,.6)}
.lc[data-grp="3"]{border-left:3px solid rgba(99,102,241,.6)}
.lc[data-grp="4"]{border-left:3px solid rgba(168,85,247,.6)}
.lc[data-grp="5"]{border-left:3px solid rgba(217,119,6,.6)}
.lc[data-grp="6"]{border-left:3px solid rgba(139,92,246,.6)}
.lc[data-grp="7"]{border-left:3px solid rgba(236,72,153,.6)}
.lc[data-grp="8"]{border-left:3px solid rgba(6,182,212,.6)}
.lc[data-grp="9"]{border-left:3px solid rgba(251,191,36,.6)}

/* ===== BOSS HP BAR ===== */
.boss-hp{display:none;align-items:center;gap:6px;width:100%;max-width:540px;flex-shrink:0;position:relative;z-index:12}
.boss-hp-bar{flex:1;height:8px;background:rgba(255,255,255,.15);border-radius:4px;overflow:hidden}
.boss-hp-fill{height:100%;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);transition:width .5s;border-radius:4px}
.boss-hp-text{font-size:clamp(11px,2vmin,14px);font-weight:900;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.4);min-width:40px;text-align:center}
.boss-hp-emoji{font-size:clamp(18px,3.5vmin,24px)}

/* ===== POWER-UP BAR ===== */
.pu-bar{display:none;align-items:center;justify-content:center;gap:clamp(4px,1vmin,8px);width:100%;max-width:540px;flex-shrink:0;position:relative;z-index:12;flex-wrap:wrap}
.pu-btn{display:inline-flex;align-items:center;gap:3px;background:rgba(255,255,255,.18);border:2px solid rgba(255,255,255,.3);border-radius:12px;padding:3px 10px;font-size:clamp(12px,2.2vmin,15px);font-weight:800;color:#fff;cursor:pointer;transition:all .2s;backdrop-filter:blur(4px);text-shadow:0 1px 3px rgba(0,0,0,.2)}
.pu-btn:hover{background:rgba(255,255,255,.3);transform:translateY(-2px)}
.pu-btn:active{transform:translateY(1px) scale(.95)}
.pu-btn.disabled{opacity:.35;cursor:not-allowed;pointer-events:none}
.pu-btn .pu-count{font-size:clamp(10px,1.8vmin,12px);background:rgba(0,0,0,.25);border-radius:8px;padding:1px 5px;margin-inline-start:2px}

/* ===== BOMB OVERLAY ===== */
.bomb-ov{position:absolute;bottom:2px;right:2px;z-index:15;font-size:clamp(14px,2.8vmin,18px);background:rgba(239,68,68,.7);border-radius:50%;width:clamp(22px,4.5vmin,30px);height:clamp(22px,4.5vmin,30px);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;text-shadow:0 1px 2px rgba(0,0,0,.4);border:2px solid rgba(255,255,255,.35);animation:bombTick 1s ease-in-out infinite}
[dir="rtl"] .bomb-ov{right:auto;left:2px}
@keyframes bombTick{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.card.bomb-explode .card-inner{animation:bombExplode .6s ease-out !important}
@keyframes bombExplode{0%{transform:rotateY(180deg) scale(1);filter:brightness(1)}30%{transform:rotateY(180deg) scale(1.3);filter:brightness(2.5) saturate(3)}60%{transform:rotateY(180deg) scale(0.8);filter:brightness(1.5)}100%{transform:rotateY(180deg) scale(1);filter:brightness(1)}}

/* ===== RAINBOW CARD ===== */
.rainbow-card .card-front{background:linear-gradient(135deg,#ef4444,#f59e0b,#22c55e,#3b82f6,#a855f7,#ec4899) !important;background-size:300% 300% !important;animation:rainbowShimmer 2s linear infinite !important;border-color:rgba(255,255,255,.5) !important}
@keyframes rainbowShimmer{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* ===== MIRROR ANIM ===== */
.grid.mirror-anim{animation:gridMirror .6s ease !important}
@keyframes gridMirror{0%{transform:scaleX(1)}30%{transform:scaleX(-1)}60%{transform:scaleX(1.05)}100%{transform:scaleX(1)}}

/* ===== CHAIN INDICATOR ===== */
.chain-indicator{display:none;align-items:center;justify-content:center;gap:2px;flex-wrap:wrap;width:100%;max-width:540px;flex-shrink:0;position:relative;z-index:12;padding:2px 8px;background:rgba(0,0,0,.2);border-radius:12px;backdrop-filter:blur(4px)}
.chain-step{font-size:clamp(16px,3.2vmin,22px);opacity:.4;transition:all .3s;filter:grayscale(1)}
.chain-step.done{opacity:.7;filter:grayscale(0)}
.chain-step.current{opacity:1;filter:grayscale(0);transform:scale(1.25);text-shadow:0 0 8px rgba(251,191,36,.6)}

/* ===== POWER-UPS AWARD (done screen) ===== */
.pu-award{display:flex;align-items:center;justify-content:center;gap:6px;font-size:clamp(16px,3.5vmin,22px);font-weight:800;color:#a78bfa;text-shadow:0 2px 6px rgba(0,0,0,.3);animation:coinBounceIn .6s cubic-bezier(.34,1.56,.64,1)}
.pu-award-icon{animation:emojiWiggle 2s ease-in-out infinite}
</style>
</head>
<body>

<!-- WORLD MAP -->
<div id="world-screen" class="screen active">
  <div style="display:flex;align-items:center;justify-content:space-between;width:100%;max-width:540px;flex-shrink:0">
    <div class="ws-title" id="ws-t">🧠 مملكة الذاكرة</div>
    <button class="mute-btn" id="ws-mute" style="background:rgba(255,255,255,.2);border:none;border-radius:12px;padding:8px 12px;font-size:clamp(18px,3.5vmin,24px);cursor:pointer;backdrop-filter:blur(4px);box-shadow:0 3px 0 rgba(0,0,0,.12)">🔊</button>
  </div>
  <div class="coins-bar">
    <div class="coin-display"><span class="coin-icon">🪙</span> <span id="coin-count">0</span></div>
    <span class="prestige-badge hidden" id="prestige-badge">♻️ P0</span>
    <button class="nav-btn shop" id="nav-shop-btn">🛒 <span id="nav-shop-txt">المتجر</span></button>
    <button class="nav-btn badges" id="nav-badge-btn">🏅 <span id="nav-badge-txt">الإنجازات</span></button>
  </div>
  <div class="xp-bar-wrap">
    <span class="xp-level" id="xp-level">🐣</span>
    <div class="xp-bar"><div class="xp-fill" id="xp-fill" style="width:0%"></div></div>
    <span class="xp-text" id="xp-text">0/50 XP</span>
  </div>
  <div class="streak-display" id="streak-display" style="display:none">🔥 Streak: 0</div>
  <div class="ws-sub" id="ws-s">اختر عالمك وانطلق في المغامرة!</div>
  <div class="world-grid" id="world-grid"></div>
</div>

<!-- LEVEL SELECT -->
<div id="lvl-screen" class="screen">
  <div style="display:flex;align-items:center;justify-content:space-between;width:100%;max-width:540px">
    <div class="ls-title" id="ls-t">🧠 مملكة الذاكرة</div>
    <button class="mute-btn" id="ls-mute" style="background:rgba(255,255,255,.2);border:none;border-radius:12px;padding:8px 12px;font-size:clamp(18px,3.5vmin,24px);cursor:pointer;backdrop-filter:blur(4px);box-shadow:0 3px 0 rgba(0,0,0,.12)">🔊</button>
  </div>
  <div class="ls-sub" id="ls-s">اختر المستوى لتبدأ!</div>
  <div class="ls-grid" id="ls-g"></div>
  <div class="g-foot"><button class="f-btn" id="ls-back">🗺️ الخريطة</button></div>
</div>

<!-- SHOP -->
<div id="shop-screen" class="screen">
  <div class="shop-title" id="shop-t">🛒 المتجر</div>
  <div class="shop-coins"><span class="coin-icon">🪙</span> <span id="shop-coins">0</span></div>
  <div class="shop-grid" id="shop-grid"></div>
  <div class="g-foot"><button class="f-btn" id="shop-back">🗺️ رجوع</button></div>
</div>

<!-- BADGES -->
<div id="badge-screen" class="screen">
  <div class="badge-title" id="badge-t">🏅 الإنجازات</div>
  <div class="badge-sub" id="badge-sub">0/30</div>
  <div class="badge-grid" id="badge-grid"></div>
  <div class="g-foot"><button class="f-btn" id="badge-back">🗺️ رجوع</button></div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <canvas id="bg-canvas"></canvas>
  <div class="g-hdr">
    <div style="display:flex;align-items:center;gap:5px">
      <span class="g-title" id="g-t">Memory</span>
      <span class="g-badge" id="g-b">1</span>
    </div>
    <div class="g-stats">
      <div class="g-stat"><div class="g-sv" id="g-mv">0</div><div class="g-sl" id="g-mvl">المحاولات</div></div>
      <div class="g-stat"><div class="g-sv" id="g-pr">0/8</div><div class="g-sl" id="g-prl">الأزواج</div></div>
      <div class="g-stat"><div class="g-sv" id="g-tm">0:00</div><div class="g-sl" id="g-tml">الوقت</div></div>
    </div>
  </div>
  <div class="boss-hp" id="boss-hp">
    <span class="boss-hp-emoji" id="boss-hp-emoji">👹</span>
    <div class="boss-hp-bar"><div class="boss-hp-fill" id="boss-hp-fill" style="width:100%"></div></div>
    <span class="boss-hp-text" id="boss-hp-text">3/3</span>
  </div>
  <div class="pu-bar" id="pu-bar"></div>
  <div class="chain-indicator" id="chain-indicator"></div>
  <div style="display:flex;gap:6px;align-items:center;flex-shrink:0;position:relative;z-index:12"><div class="mech-info" id="mech-info" style="display:none"></div><div class="dda-badge normal" id="dda-badge" style="display:none"></div></div>
  <div class="cd-wrap" id="cd-wrap" style="display:none">
    <div class="cd-hdr"><span class="cd-txt" id="cd-text">⏱️ 2:00</span><span class="cd-txt" id="cd-label"></span></div>
    <div class="cd-bar"><div class="cd-fill" id="cd-fill" style="width:100%"></div></div>
  </div>
  <div class="grid-wrap">
    <div class="peek-banner" id="peek-banner"><span id="peek-text">👀</span></div>
    <div class="grid" id="grid"></div>
  </div>
  <p class="hint" id="hint">اضغط على أي بطاقة للبدء!</p>
  <div class="g-foot">
    <button class="mute-btn" id="game-mute" style="background:none;border:none;font-size:clamp(20px,4vmin,28px);cursor:pointer;padding:4px 8px;color:rgba(255,255,255,.85);border-radius:8px">🔊</button>
    <button class="f-btn" id="game-back">🗺️ رجوع</button>
  </div>
</div>

<!-- COMPLETE -->
<div id="done-screen" class="screen">
  <div class="d-emoji" id="d-e">🎉</div>
  <div class="d-title" id="d-t">مبروك!</div>
  <div class="d-stars" id="d-st"></div>
  <div class="d-sub" id="d-sub"></div>
  <div class="d-stats">
    <div class="d-st"><div class="d-st-e">🏆</div><div class="d-st-v" id="d-sc">0</div><div class="d-st-l" id="d-scl">النقاط</div></div>
    <div class="d-st"><div class="d-st-e">🎯</div><div class="d-st-v" id="d-mv2">0</div><div class="d-st-l" id="d-mvl2">المحاولات</div></div>
    <div class="d-st"><div class="d-st-e">⏱️</div><div class="d-st-v" id="d-tm">0:00</div><div class="d-st-l" id="d-tml">الوقت</div></div>
  </div>
  <div class="coin-earned" id="d-coins" style="display:none"><span class="coin-icon">🪙</span> +<span id="d-coins-val">0</span></div>
  <div class="d-xp" id="d-xp" style="display:none">+0 XP</div>
  <div class="d-streak" id="d-streak" style="display:none">🔥 Streak</div>
  <div class="pu-award" id="d-powers" style="display:none"></div>
  <div class="d-btns">
    <button class="d-btn pri" id="d-nx">➡️ التالي</button>
    <button class="d-btn shr" id="d-sh">📤 مشاركة</button>
    <button class="d-btn sec" id="d-rp">🔄 إعادة</button>
    <button class="d-btn sec" id="d-wm">🗺️ الخريطة</button>
    <button class="d-btn sec" id="d-lv">📋 المستويات</button>
  </div>
</div>

<!-- ===== MODULE BOOTSTRAP ===== -->
<script type="module">
import { LANG, t, POWER_UPS } from './memory-modules/config.js';
import { WORLDS, LEVELS } from './memory-modules/worlds.js';
import { setSoundMuteGetter, showScreen, sfxTap } from './memory-modules/ui.js';
import {
  soundMuted, initMute, toggleMute,
  renderWorldMap, enterWorld, renderLevelSelect,
  startLevel, flipCard, clearFog,
  earnCoins, updateCoinDisplays, updateXPDisplay, updateStreakDisplay,
  renderShop, renderBadges,
  endGame, nextLevel, replayLevel, shareResult,
  goToWorldMap, goToLevels, renderCardsNow,
  usePower, updatePowerBar, powers,
  xpData, streakData, prestigeData, canPrestige, doPrestige
} from './memory-modules/core.js';

// Wire sound mute getter
setSoundMuteGetter(() => soundMuted);

// ===== i18n static text =====
document.getElementById('ws-t').textContent = t.title || '🧠 مملكة الذاكرة';
document.getElementById('ws-s').textContent = t.selectWorld || 'اختر العالم لتبدأ المغامرة!';
document.getElementById('ls-t').textContent = t.title || '🧠 مملكة الذاكرة';
document.getElementById('ls-s').textContent = t.selectLevel || 'اختر المستوى';
document.getElementById('g-mvl').textContent = t.moves || 'المحاولات';
document.getElementById('g-prl').textContent = t.pairs || 'الأزواج';
document.getElementById('g-tml').textContent = t.time || 'الوقت';
document.getElementById('d-scl').textContent = t.score || 'النقاط';
document.getElementById('d-mvl2').textContent = t.moves || 'المحاولات';
document.getElementById('d-tml').textContent = t.time || 'الوقت';
document.getElementById('d-nx').textContent = t.next || '➡️ التالي';
document.getElementById('d-sh').textContent = t.share || '📤 مشاركة';
document.getElementById('d-rp').textContent = t.again || '🔄 إعادة';
document.getElementById('d-wm').textContent = t.worlds || '🗺️ العوالم';
document.getElementById('d-lv').textContent = t.levels || '🏠 المستويات';
if (t.shop) {
  document.getElementById('nav-shop-txt').textContent = t.shop.replace(/🛒\s*/, '');
  document.getElementById('shop-t').textContent = t.shop;
}
if (t.badges) {
  document.getElementById('nav-badge-txt').textContent = t.badges.replace(/🏅\s*/, '');
  document.getElementById('badge-t').textContent = t.badges;
}

// ===== Button wiring (no inline onclick) =====
// World screen
document.getElementById('ws-mute').onclick = toggleMute;
document.getElementById('nav-shop-btn').onclick = () => { sfxTap(); renderShop(); showScreen('shop-screen'); };
document.getElementById('nav-badge-btn').onclick = () => { sfxTap(); renderBadges(); showScreen('badge-screen'); };

// Level screen
document.getElementById('ls-mute').onclick = toggleMute;
document.getElementById('ls-back').onclick = goToWorldMap;

// Shop / Badge back
document.getElementById('shop-back').onclick = goToWorldMap;
document.getElementById('badge-back').onclick = goToWorldMap;

// Game screen
document.getElementById('game-mute').onclick = toggleMute;
document.getElementById('game-back').onclick = goToLevels;

// Done screen buttons
document.getElementById('d-nx').onclick = nextLevel;
document.getElementById('d-sh').onclick = shareResult;
document.getElementById('d-rp').onclick = replayLevel;
document.getElementById('d-wm').onclick = goToWorldMap;
document.getElementById('d-lv').onclick = goToLevels;

// Resize handler
window.addEventListener('resize', () => {
  if (document.getElementById('game-screen').classList.contains('active')) {
    renderCardsNow();
  }
});

// ===== INIT =====
initMute();
updateCoinDisplays();
updateXPDisplay();
updateStreakDisplay();
renderWorldMap();

// Prestige badge
const pBadge = document.getElementById('prestige-badge');
if (prestigeData.level > 0 && pBadge) {
  pBadge.textContent = '♻️ P' + prestigeData.level;
  pBadge.classList.remove('hidden');
}

// Build power-up bar buttons
const puBar = document.getElementById('pu-bar');
POWER_UPS.forEach(pu => {
  const btn = document.createElement('button');
  btn.className = 'pu-btn';
  btn.id = 'pu-' + pu.id;
  btn.dataset.pu = pu.id;
  btn.innerHTML = pu.icon + ' <span class="pu-count">' + (powers[pu.id] || 0) + '</span>';
  btn.title = (t.puNames && t.puNames[pu.id]) || pu.id;
  btn.onclick = () => usePower(pu.id);
  puBar.appendChild(btn);
});
</script>
</body>
</html>
