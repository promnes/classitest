<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© - Memory Match</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;user-select:none;-webkit-tap-highlight-color:transparent}
.screen{display:none;width:100%;height:100%;position:absolute;top:0;left:0}
.screen.active{display:flex}

/* === LEVEL SELECT === */
#lvl-screen{flex-direction:column;align-items:center;padding:clamp(8px,2vmin,16px);gap:clamp(6px,1.5vmin,12px);overflow-y:auto;background:var(--bg,linear-gradient(135deg,#667eea,#764ba2))}
.ls-title{font-size:clamp(20px,5vmin,32px);font-weight:900;color:#fff;text-shadow:0 2px 10px rgba(0,0,0,.3);text-align:center;flex-shrink:0}
.ls-sub{font-size:clamp(11px,2vmin,14px);color:rgba(255,255,255,.8);text-align:center;flex-shrink:0}
.ls-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:clamp(6px,1.5vmin,10px);width:100%;max-width:480px;padding:clamp(4px,1vmin,8px) 0}
.lc{position:relative;background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.2);border-radius:clamp(10px,2vmin,16px);padding:clamp(8px,2vmin,14px) clamp(4px,1vmin,8px);text-align:center;cursor:pointer;transition:all .2s;backdrop-filter:blur(4px)}
.lc:hover{transform:scale(1.04);background:rgba(255,255,255,.25)}
.lc:active{transform:scale(.96)}
.lc.locked{opacity:.5;cursor:not-allowed}
.lc.locked:hover{transform:none;background:rgba(255,255,255,.15)}
.lc.current{border-color:#fbbf24;box-shadow:0 0 16px rgba(251,191,36,.5)}
.lc-num{font-size:clamp(18px,4vmin,28px);font-weight:900;color:#fff}
.lc-emoji{font-size:clamp(22px,5vmin,34px);margin:2px 0}
.lc-name{font-size:clamp(8px,1.5vmin,11px);color:rgba(255,255,255,.85);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lc-stars{font-size:clamp(10px,2vmin,14px);margin-top:2px}
.lc-lock{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:clamp(24px,6vmin,36px)}

/* === GAME === */
#game-screen{flex-direction:column;align-items:center;padding:clamp(4px,1vmin,10px);gap:clamp(3px,.8vmin,6px);background:var(--bg,linear-gradient(135deg,#667eea,#764ba2));transition:background .5s}
.g-hdr{width:100%;max-width:540px;display:flex;align-items:center;justify-content:space-between;gap:6px;flex-shrink:0}
.g-title{font-size:clamp(12px,2.5vmin,16px);font-weight:800;color:#fff;text-shadow:0 1px 6px rgba(0,0,0,.2)}
.g-badge{font-size:clamp(9px,1.6vmin,12px);background:rgba(255,255,255,.25);color:#fff;border-radius:20px;padding:2px 8px;font-weight:700}
.g-stats{display:flex;gap:clamp(4px,1vmin,8px);align-items:center}
.g-stat{text-align:center;background:rgba(255,255,255,.15);border-radius:8px;padding:2px 8px;backdrop-filter:blur(4px)}
.g-sv{font-size:clamp(13px,2.5vmin,18px);font-weight:800;color:#fff}
.g-sl{font-size:clamp(7px,1.2vmin,9px);color:rgba(255,255,255,.7);text-transform:uppercase}
.grid-wrap{flex:1;display:flex;align-items:center;justify-content:center;width:100%;min-height:0}
.grid{display:grid;gap:clamp(3px,1vmin,6px);perspective:1000px}
.card{aspect-ratio:1;border:none;background:transparent;cursor:pointer;padding:0;outline:none;-webkit-tap-highlight-color:transparent}
.card:disabled{cursor:default}
.card-inner{position:relative;width:100%;height:100%;transition:transform .45s ease;transform-style:preserve-3d;border-radius:clamp(8px,2vmin,14px)}
.card.flipped .card-inner{transform:rotateY(180deg)}
.card-front,.card-back{position:absolute;inset:0;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:clamp(8px,2vmin,14px);display:flex;align-items:center;justify-content:center}
.card-front{background:linear-gradient(145deg,var(--cf1,#6366f1),var(--cf2,#4f46e5));box-shadow:0 4px 12px rgba(0,0,0,.2);border:2px solid rgba(255,255,255,.2)}
.card-front .icon{font-size:clamp(1.2rem,4vmin,1.8rem);filter:brightness(.85)}
.card:not(.flipped):not(.matched):hover .card-front{box-shadow:0 6px 20px rgba(0,0,0,.3);transform:scale(1.04);transition:transform .15s}
.card:not(.flipped):not(.matched):active .card-front{transform:scale(.96)}
.card-back{background:linear-gradient(145deg,#fff,#f1f5f9);box-shadow:0 4px 12px rgba(0,0,0,.12);transform:rotateY(180deg);border:2px solid rgba(99,102,241,.2)}
.card-back .sym{font-size:clamp(1.4rem,5vmin,2.2rem)}
.card.matched .card-inner{transform:rotateY(180deg)}
.card.matched .card-back{background:linear-gradient(145deg,#d1fae5,#a7f3d0);border-color:rgba(16,185,129,.3);box-shadow:0 0 16px rgba(16,185,129,.25);animation:mpop .4s ease}
@keyframes mpop{0%{transform:rotateY(180deg) scale(1)}50%{transform:rotateY(180deg) scale(1.12)}100%{transform:rotateY(180deg) scale(1)}}
.g-foot{display:flex;gap:clamp(4px,1vmin,8px);flex-shrink:0;flex-wrap:wrap;justify-content:center}
.f-btn{background:rgba(255,255,255,.2);border:none;border-radius:10px;padding:clamp(5px,1.2vmin,8px) clamp(10px,2.5vmin,18px);font-size:clamp(10px,1.8vmin,13px);font-weight:700;color:#fff;cursor:pointer;transition:all .2s}
.f-btn:hover{background:rgba(255,255,255,.35);transform:scale(1.04)}
.f-btn:active{transform:scale(.95)}
.hint{color:rgba(255,255,255,.8);font-size:clamp(10px,2vmin,13px);font-weight:500;flex-shrink:0;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:.7}50%{opacity:1}}

/* === COMPLETE === */
#done-screen{flex-direction:column;align-items:center;justify-content:center;gap:clamp(8px,2vmin,16px);padding:clamp(12px,3vmin,24px);background:var(--bg,linear-gradient(135deg,#667eea,#764ba2))}
.d-emoji{font-size:clamp(44px,12vmin,72px);animation:bounce 1s ease infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.d-title{font-size:clamp(20px,5.5vmin,32px);font-weight:900;color:#fff;text-shadow:0 3px 10px rgba(0,0,0,.3)}
.d-sub{font-size:clamp(11px,2.2vmin,14px);color:rgba(255,255,255,.85);text-align:center}
.d-stars{display:flex;gap:clamp(4px,1vmin,8px);font-size:clamp(28px,7vmin,44px)}
.d-stats{display:flex;gap:clamp(8px,2vmin,16px);flex-wrap:wrap;justify-content:center}
.d-st{text-align:center;background:rgba(255,255,255,.2);border-radius:12px;padding:clamp(6px,1.5vmin,12px) clamp(10px,2.5vmin,18px);backdrop-filter:blur(4px)}
.d-st-e{font-size:clamp(18px,4.5vmin,28px)}
.d-st-v{font-size:clamp(16px,3.5vmin,22px);font-weight:800;color:#fff}
.d-st-l{font-size:clamp(8px,1.3vmin,10px);color:rgba(255,255,255,.7);text-transform:uppercase}
.d-btns{display:flex;gap:clamp(6px,1.5vmin,10px);flex-wrap:wrap;justify-content:center}
.d-btn{border:none;border-radius:14px;padding:clamp(8px,2vmin,14px) clamp(20px,5vmin,36px);font-size:clamp(12px,2.5vmin,16px);font-weight:800;cursor:pointer;transition:all .2s}
.d-btn:hover{transform:scale(1.04)}.d-btn:active{transform:scale(.95)}
.d-btn.pri{background:linear-gradient(135deg,#f59e0b,#f97316);color:#fff;box-shadow:0 4px 18px rgba(249,115,22,.4)}
.d-btn.sec{background:rgba(255,255,255,.25);color:#fff;backdrop-filter:blur(4px)}
.d-btn.shr{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;box-shadow:0 4px 18px rgba(37,99,235,.4)}
.particle{position:fixed;pointer-events:none;z-index:999;animation:part 1.1s ease-out forwards}
@keyframes part{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-70px) scale(.3)}}
</style>
</head>
<body>

<!-- LEVEL SELECT -->
<div id="lvl-screen" class="screen active">
  <div class="ls-title" id="ls-t">ğŸ§  Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</div>
  <div class="ls-sub" id="ls-s">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù„ØªØ¨Ø¯Ø£!</div>
  <div class="ls-grid" id="ls-g"></div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div class="g-hdr">
    <div style="display:flex;align-items:center;gap:5px">
      <span class="g-title" id="g-t">Memory</span>
      <span class="g-badge" id="g-b">1</span>
    </div>
    <div class="g-stats">
      <div class="g-stat"><div class="g-sv" id="g-mv">0</div><div class="g-sl" id="g-mvl">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</div></div>
      <div class="g-stat"><div class="g-sv" id="g-pr">0/8</div><div class="g-sl" id="g-prl">Ø§Ù„Ø£Ø²ÙˆØ§Ø¬</div></div>
      <div class="g-stat"><div class="g-sv" id="g-tm">0:00</div><div class="g-sl" id="g-tml">Ø§Ù„ÙˆÙ‚Øª</div></div>
    </div>
  </div>
  <div class="grid-wrap"><div class="grid" id="grid"></div></div>
  <p class="hint" id="hint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø¨Ø¯Ø¡!</p>
  <div class="g-foot">
    <button class="f-btn" onclick="showScreen('lvl-screen')">ğŸ  Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<!-- COMPLETE -->
<div id="done-screen" class="screen">
  <div class="d-emoji" id="d-e">ğŸ‰</div>
  <div class="d-title" id="d-t">Ù…Ø¨Ø±ÙˆÙƒ!</div>
  <div class="d-stars" id="d-st"></div>
  <div class="d-sub" id="d-sub"></div>
  <div class="d-stats">
    <div class="d-st"><div class="d-st-e">ğŸ†</div><div class="d-st-v" id="d-sc">0</div><div class="d-st-l" id="d-scl">Ø§Ù„Ù†Ù‚Ø§Ø·</div></div>
    <div class="d-st"><div class="d-st-e">ğŸ¯</div><div class="d-st-v" id="d-mv2">0</div><div class="d-st-l" id="d-mvl2">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</div></div>
    <div class="d-st"><div class="d-st-e">â±ï¸</div><div class="d-st-v" id="d-tm">0:00</div><div class="d-st-l" id="d-tml">Ø§Ù„ÙˆÙ‚Øª</div></div>
  </div>
  <div class="d-btns">
    <button class="d-btn pri" id="d-nx" onclick="nextLevel()">â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ</button>
    <button class="d-btn shr" id="d-sh" onclick="shareResult()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
    <button class="d-btn sec" onclick="replayLevel()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>
    <button class="d-btn sec" onclick="showScreen('lvl-screen')">ğŸ  Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</button>
  </div>
</div>

<script>
// ===== i18n =====
const LANG=new URLSearchParams(location.search).get('lang')||'ar';
document.documentElement.lang=LANG;document.documentElement.dir=LANG==='ar'?'rtl':'ltr';
const I={
ar:{title:'ğŸ§  Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©',sub:'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù„ØªØ¨Ø¯Ø£!',moves:'Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª',pairs:'Ø§Ù„Ø£Ø²ÙˆØ§Ø¬',time:'Ø§Ù„ÙˆÙ‚Øª',hint:'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø¨Ø¯Ø¡!',score:'Ø§Ù„Ù†Ù‚Ø§Ø·',congrats:'Ù…Ø¨Ø±ÙˆÙƒ!',excellent:'ğŸŒŸ Ù…Ù…ØªØ§Ø²!',great:'ğŸ‰ Ø£Ø­Ø³Ù†Øª!',good:'ğŸ‘ Ø¬ÙŠØ¯!',tryMore:'ğŸ’ª Ø­Ø§ÙˆÙ„ Ø£ÙƒØ«Ø±!',done:'Ø£ØªÙ…Ù…Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰!',next:'â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ',share:'ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©',again:'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©',levels:'ğŸ  Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª',back:'ğŸ  Ø±Ø¬ÙˆØ¹',locked:'ğŸ”’',
shareText:'Ø­Ù‚Ù‚Øª {score} Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {level} Ù…Ù† Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©! â­{stars}',
lvNames:['Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª','Ø³Ù„Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡','Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨Ø­Ø§Ø±','Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ø­Ø´Ø±Ø§Øª','Ø³Ù…Ø§Ø¡ ÙˆØ·Ù‚Ø³','Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„ÙˆØ±Ø¯','ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø®Ø¶Ø§Ø±','Ù…Ø·Ø¨Ø® Ù„Ø°ÙŠØ°','Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª','Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„ÙØ¶Ø§Ø¡','Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©','Ø¹Ø§Ù„Ù… Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰','Ø±Ø­Ù„Ø© Ø§Ù„Ø³ÙØ§Ø±ÙŠ','Ø¹Ø§Ù„Ù… Ø§Ù„Ø·ÙŠÙˆØ±','ÙˆØ±Ø´Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª','Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ø²ÙŠØ§Ø¡','Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ','ÙŠÙˆÙ… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©','Ø¹Ø§Ù„Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ©','ğŸŒ Ø¨Ø·Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…']},
en:{title:'ğŸ§  Memory Match',sub:'Choose a level to start!',moves:'Moves',pairs:'Pairs',time:'Time',hint:'Tap any card to start!',score:'Score',congrats:'Congrats!',excellent:'ğŸŒŸ Excellent!',great:'ğŸ‰ Great!',good:'ğŸ‘ Good!',tryMore:'ğŸ’ª Try More!',done:'Level complete!',next:'â¡ï¸ Next',share:'ğŸ“¤ Share',again:'ğŸ”„ Replay',levels:'ğŸ  Levels',back:'ğŸ  Back',locked:'ğŸ”’',
shareText:'I scored {score} on Level {level} in Memory Match! â­{stars}',
lvNames:['Farm Friends','Fruit Basket','Ocean World','Bug Garden','Sky Watch','Flower Garden','Veggie Valley','Yummy Kitchen','On the Move','Space Quest','Sports Arena','Music Studio','Wild Safari','Bird Paradise','Tool Workshop','Fashion Show','City Builder','School Days','Tech World','ğŸŒ World Champion']},
pt:{title:'ğŸ§  Jogo da MemÃ³ria',sub:'Escolha um nÃ­vel!',moves:'Jogadas',pairs:'Pares',time:'Tempo',hint:'Toque para comeÃ§ar!',score:'Pontos',congrats:'ParabÃ©ns!',excellent:'ğŸŒŸ Excelente!',great:'ğŸ‰ Muito Bem!',good:'ğŸ‘ Bom!',tryMore:'ğŸ’ª Tente Mais!',done:'NÃ­vel completo!',next:'â¡ï¸ PrÃ³ximo',share:'ğŸ“¤ Compartilhar',again:'ğŸ”„ Repetir',levels:'ğŸ  NÃ­veis',back:'ğŸ  Voltar',locked:'ğŸ”’',
shareText:'Fiz {score} pontos no NÃ­vel {level} do Jogo da MemÃ³ria! â­{stars}',
lvNames:['Amigos da Fazenda','Cesta de Frutas','Mundo do Mar','Jardim de Insetos','CÃ©u e Clima','Jardim de Flores','Vale dos Vegetais','Cozinha Gostosa','Em Movimento','MissÃ£o Espacial','Arena Esportiva','EstÃºdio Musical','Safari Selvagem','ParaÃ­so dos PÃ¡ssaros','Oficina de Ferramentas','Desfile de Moda','Construtor de Cidades','Dia Escolar','Mundo Tech','ğŸŒ CampeÃ£o Mundial']}
};
const t=I[LANG]||I.en;

// ===== 1000+ EDUCATIONAL SYMBOLS =====
const POOL={
farm:['ğŸ„','ğŸ·','ğŸ‘','ğŸ','ğŸ´','ğŸ”','ğŸ“','ğŸ¦ƒ','ğŸ¤','ğŸ£','ğŸ¦†','ğŸ•','ğŸˆ','ğŸ°','ğŸ‡','ğŸ¹','ğŸ­','ğŸ¿','ğŸ¦”','ğŸ¶','ğŸ±','ğŸ®','ğŸ–','ğŸ—','ğŸ½','ğŸ','ğŸª','ğŸ«','ğŸ¦™','ğŸ','ğŸ¥','ğŸ•Š','ğŸ©','ğŸ¾','ğŸ¦','ğŸ¦¡','ğŸ¦¨','ğŸ¦¥','ğŸ¦¦','ğŸ»','ğŸ¨','ğŸ¼','ğŸ¦Š','ğŸº','ğŸ¦«','ğŸ‚','ğŸƒ','ğŸ¦„','ğŸ','ğŸ€'],
fruit:['ğŸ','ğŸ','ğŸ','ğŸŠ','ğŸ‹','ğŸŒ','ğŸ‰','ğŸ‡','ğŸ“','ğŸˆ','ğŸ‘','ğŸ’','ğŸ¥','ğŸ¥¥','ğŸ','ğŸ¥­','ğŸ…','ğŸ¥‘','ğŸ«','ğŸ«’','ğŸ¥•','ğŸ†','ğŸŒ¶','ğŸŒ½','ğŸ¥’','ğŸ¥¬','ğŸ§…','ğŸ§„','ğŸ¥œ','ğŸŒ°','ğŸ„','ğŸ ','ğŸ¥¦','ğŸ¥—','ğŸ¥£','ğŸ«™','ğŸ¥«','ğŸ¥”','ğŸ«‘','ğŸ§†','ğŸ¥™','ğŸ«“','ğŸ¥¯','ğŸ','ğŸ¥–','ğŸ¥¨','ğŸ§€','ğŸ¥š','ğŸ§ˆ','ğŸ‹â€ğŸŸ©'],
sea:['ğŸŸ','ğŸ ','ğŸ¡','ğŸ¦ˆ','ğŸ¬','ğŸ³','ğŸ‹','ğŸ¦­','ğŸ™','ğŸ¦‘','ğŸ¦','ğŸ¦€','ğŸ¦','ğŸš','ğŸª¸','ğŸª¼','ğŸŠ','ğŸ¢','ğŸ','ğŸ¦','ğŸ¸','ğŸ²','ğŸ‰','ğŸ¦•','ğŸ¦–','ğŸ³','ğŸ‹','ğŸ¦ˆ','ğŸ¬','ğŸ™','ğŸ¦‘','ğŸ ','ğŸŸ','ğŸ¡','ğŸ¦','ğŸ¦€','ğŸ¦','ğŸš','ğŸ¢','ğŸŠ','ğŸ','ğŸ¸','ğŸ¦','ğŸª¸','ğŸª¼','ğŸ¦­','ğŸ‰','ğŸ²','ğŸ¦•','ğŸ¦–'],
bug:['ğŸ¦‹','ğŸ›','ğŸ','ğŸ','ğŸ¦—','ğŸ•·','ğŸ¦‚','ğŸœ','ğŸª²','ğŸª³','ğŸ¦Ÿ','ğŸª°','ğŸŒ','ğŸª±','ğŸŒ¿','ğŸ€','ğŸ','ğŸ‚','ğŸƒ','ğŸŒ±','ğŸŒ²','ğŸŒ³','ğŸŒ´','ğŸŒµ','ğŸŒ¾','ğŸª´','ğŸ‹','ğŸ','ğŸ„','ğŸŒ»','ğŸŒ¸','ğŸŒ¹','ğŸŒº','ğŸŒ¼','ğŸŒ·','ğŸ’','ğŸª»','ğŸª·','ğŸ¦','ğŸ•Š','ğŸ¦‹','ğŸ›','ğŸ','ğŸ','ğŸ¦—','ğŸœ','ğŸª²','ğŸŒ','ğŸª±','ğŸ•·'],
weather:['â˜€ï¸','ğŸŒ¤','â›…','ğŸŒ¥','â˜ï¸','ğŸŒ¦','ğŸŒ§','â›ˆ','ğŸŒ©','ğŸŒ¨','â„ï¸','â˜ƒï¸','â›„','ğŸŒ¬','ğŸ’¨','ğŸŒŠ','ğŸŒˆ','ğŸŒª','ğŸŒ«','ğŸ’§','ğŸ’¦','ğŸŒ¡','ğŸ”¥','â­','ğŸŒŸ','ğŸ’«','âœ¨','â˜„ï¸','ğŸŒ™','ğŸŒ›','ğŸŒœ','ğŸŒš','ğŸŒ','ğŸŒ','ğŸŒ•','ğŸŒ–','ğŸŒ—','ğŸŒ˜','ğŸŒ‘','ğŸŒ’','ğŸŒ“','ğŸŒ”','ğŸŒ…','ğŸŒ„','ğŸŒ‡','ğŸŒ†','ğŸ™','ğŸŒƒ','ğŸŒŒ','ğŸŒ '],
flower:['ğŸŒ¸','ğŸŒ¹','ğŸŒº','ğŸŒ»','ğŸŒ¼','ğŸŒ·','ğŸ’','ğŸª»','ğŸª·','ğŸŒ±','ğŸŒ²','ğŸŒ³','ğŸŒ´','ğŸŒµ','ğŸŒ¾','ğŸ€','â˜˜ï¸','ğŸ','ğŸ‚','ğŸƒ','ğŸª´','ğŸ‹','ğŸ','ğŸª¹','ğŸªº','ğŸ„','ğŸŒ¿','ğŸ„','ğŸ’®','ğŸµ','ğŸŒ¸','ğŸŒ¹','ğŸŒº','ğŸŒ»','ğŸŒ¼','ğŸŒ·','ğŸ’','ğŸª»','ğŸª·','ğŸŒ±','ğŸŒ²','ğŸŒ³','ğŸŒ´','ğŸŒµ','ğŸ€','â˜˜ï¸','ğŸ','ğŸ‚','ğŸƒ','ğŸª´'],
veggie:['ğŸ¥•','ğŸ¥¦','ğŸŒ½','ğŸ¥’','ğŸ¥¬','ğŸ§…','ğŸ§„','ğŸ¥”','ğŸ†','ğŸŒ¶','ğŸ«‘','ğŸ¥œ','ğŸŒ°','ğŸ„','ğŸ ','ğŸ«˜','ğŸ«›','ğŸ¥—','ğŸ§†','ğŸ¥™','ğŸŒ±','ğŸ¥•','ğŸ¥¦','ğŸŒ½','ğŸ¥’','ğŸ¥¬','ğŸ§…','ğŸ§„','ğŸ¥”','ğŸ†','ğŸŒ¶','ğŸ«‘','ğŸ¥œ','ğŸŒ°','ğŸ„','ğŸ ','ğŸ«˜','ğŸ«›','ğŸ¥—','ğŸ§†','ğŸŒ¿','ğŸ€','ğŸŒ¾','ğŸŒ»','ğŸŒ¼','ğŸª´','ğŸ§‚','ğŸ«™','ğŸ¥«','ğŸ§ˆ'],
food:['ğŸ•','ğŸ”','ğŸŒ®','ğŸŒ¯','ğŸ¥š','ğŸ³','ğŸ¥˜','ğŸ²','ğŸ¿','ğŸ±','ğŸ˜','ğŸ™','ğŸš','ğŸ›','ğŸœ','ğŸ','ğŸ ','ğŸ¢','ğŸ£','ğŸ¤','ğŸ¥','ğŸ¥®','ğŸ¡','ğŸ¥Ÿ','ğŸ¥ ','ğŸ¥¡','ğŸ§','ğŸ°','ğŸ‚','ğŸ®','ğŸ­','ğŸ¬','ğŸ«','ğŸ©','ğŸª','ğŸ¯','ğŸ¥','ğŸ¥–','ğŸ§‡','ğŸ¥','ğŸ§ˆ','ğŸ«•','ğŸ«”','ğŸ¥£','ğŸ«—','ğŸ¿','ğŸ±','ğŸ§†','ğŸ¥™','ğŸ«“'],
vehicle:['ğŸš—','ğŸš•','ğŸš™','ğŸšŒ','ğŸš','ğŸ','ğŸš“','ğŸš‘','ğŸš’','ğŸš','ğŸ›»','ğŸšš','ğŸš›','ğŸšœ','ğŸ','ğŸ›µ','ğŸš²','ğŸ›´','ğŸ›¹','ğŸ›¼','ğŸš','ğŸ›¸','ğŸš€','ğŸ›©','âœˆï¸','ğŸ›«','ğŸ›¬','ğŸš¢','â›µ','ğŸ›¶','ğŸš¤','ğŸ›¥','ğŸ›³','â›´','ğŸš‚','ğŸšƒ','ğŸš„','ğŸš…','ğŸš†','ğŸš‡','ğŸšˆ','ğŸš‰','ğŸšŠ','ğŸš','ğŸš','ğŸš‹','ğŸš ','ğŸš¡','ğŸ›°','ğŸš'],
space:['ğŸŒ','ğŸŒ','ğŸŒ','ğŸŒ‘','ğŸŒ’','ğŸŒ“','ğŸŒ”','ğŸŒ•','ğŸŒ–','ğŸŒ—','ğŸŒ˜','ğŸŒ™','ğŸŒš','ğŸŒ›','ğŸŒœ','ğŸŒ','ğŸŒ','â˜€ï¸','â­','ğŸŒŸ','ğŸ’«','âœ¨','â˜„ï¸','ğŸª','ğŸ”­','ğŸ”¬','ğŸ§²','ğŸ§ª','ğŸ§«','ğŸ§¬','ğŸ’¡','ğŸ”¦','ğŸ•¯','ğŸª”','ğŸ”‹','âš¡','ğŸ›¸','ğŸš€','ğŸ›°','ğŸ“¡','ğŸŒŒ','ğŸŒ ','ğŸ†','ğŸ‡','ğŸ’¥','ğŸ”¥','ğŸ’§','ğŸŒŠ','ğŸŒ€','ğŸŒˆ'],
sport:['âš½','ğŸ€','ğŸˆ','âš¾','ğŸ¥','ğŸ¾','ğŸ','ğŸ‰','ğŸ¥','ğŸ±','ğŸ“','ğŸ¸','ğŸ’','ğŸ¥','ğŸ','ğŸ¥…','â›³','ğŸª','ğŸ¹','ğŸ¯','ğŸ¥Š','ğŸ¥‹','ğŸ¿','â›·','ğŸ‚','ğŸ‹ï¸','ğŸ¤¸','ğŸ¤º','ğŸ¤¾','ğŸŒï¸','ğŸ‡','ğŸ§˜','ğŸ§—','ğŸ¤¿','ğŸ„','ğŸŠ','ğŸš£','ğŸ½','ğŸ…','ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','ğŸ†','ğŸ–','ğŸª','ğŸ ','ğŸ¡','ğŸ¢','ğŸ›','â›º'],
music:['ğŸµ','ğŸ¶','ğŸ¼','ğŸ¹','ğŸ¸','ğŸº','ğŸ»','ğŸ¥','ğŸª˜','ğŸª—','ğŸ·','ğŸ¤','ğŸ§','ğŸ“¯','ğŸªˆ','ğŸ¬','ğŸ­','ğŸ¨','ğŸ–Œ','ğŸ–','âœï¸','ğŸ–Š','ğŸ–‹','ğŸ“','ğŸª','ğŸ ','ğŸ²','ğŸ¯','ğŸ³','ğŸ°','ğŸ®','ğŸ•¹','ğŸ“º','ğŸ“»','ğŸ“¸','ğŸ¥','ğŸ“¹','ğŸ“½','ğŸ','ğŸŸ','ğŸ’¿','ğŸ“€','ğŸ’½','ğŸ“±','ğŸ–¥','âŒ¨ï¸','ğŸ–±','ğŸ–¨','ğŸ“¢','ğŸ“£'],
wild:['ğŸ¦','ğŸ¯','ğŸ…','ğŸ†','ğŸ¦’','ğŸ¦“','ğŸ˜','ğŸ¦›','ğŸ¦','ğŸ»','ğŸ¦Š','ğŸº','ğŸ¦Œ','ğŸ¦¬','ğŸ¦£','ğŸ¦§','ğŸ¦','ğŸ’','ğŸµ','ğŸ™ˆ','ğŸ™‰','ğŸ™Š','ğŸ¦˜','ğŸ¦¥','ğŸ¦¨','ğŸ¦¡','ğŸ¦','ğŸ¦¦','ğŸ»â€â„ï¸','ğŸ¼','ğŸ¨','ğŸ¾','ğŸŠ','ğŸ¢','ğŸ','ğŸ¦','ğŸ¸','ğŸ²','ğŸ‰','ğŸ¦•','ğŸ¦–','ğŸ¦‹','ğŸ','ğŸ','ğŸ¦…','ğŸ¦‰','ğŸ§','ğŸ¦œ','ğŸ¦š','ğŸ¦©'],
bird:['ğŸ¦…','ğŸ¦†','ğŸ¦‰','ğŸ¦œ','ğŸ§','ğŸ¦š','ğŸ¦¢','ğŸ¦©','ğŸ¦¤','ğŸª¶','ğŸ¦','ğŸ•Š','ğŸ¦ƒ','ğŸ”','ğŸ“','ğŸ¤','ğŸ£','ğŸ¥','ğŸ¦…','ğŸ¦†','ğŸ¦‰','ğŸ¦œ','ğŸ§','ğŸ¦š','ğŸ¦¢','ğŸ¦©','ğŸª¶','ğŸ¦','ğŸ•Š','ğŸ¦ƒ','ğŸ”','ğŸ“','ğŸ¤','ğŸ£','ğŸ¥','ğŸ¦¤','ğŸª¹','ğŸªº','ğŸ¥š','ğŸ¾','ğŸŒ¿','ğŸ€','ğŸŒ²','ğŸŒ³','â˜ï¸','ğŸŒ¤','â›…','ğŸŒˆ','ğŸŒ…','ğŸ”'],
tool:['ğŸ”¨','ğŸª“','â›','ğŸ”§','ğŸª›','ğŸ”©','âš™ï¸','ğŸ—œ','ğŸªš','ğŸ“','ğŸ“','âœ‚ï¸','ğŸ–Š','ğŸ–‹','âœ’ï¸','ğŸ”‘','ğŸ—','ğŸ”’','ğŸ”“','ğŸª¤','ğŸ§²','ğŸª','ğŸ§°','ğŸªœ','ğŸª£','ğŸ§¹','ğŸ§º','ğŸ§»','ğŸª ','ğŸ§¼','ğŸ§½','ğŸª¥','ğŸª’','ğŸ”‹','ğŸ”Œ','ğŸ’¡','ğŸ”¦','ğŸ•¯','ğŸª”','ğŸ§¯','ğŸª¤','ğŸ“Œ','ğŸ“','ğŸ—‚','ğŸ“','ğŸ“‚','ğŸ—ƒ','ğŸ“','ğŸ–‡','ğŸ—‘'],
fashion:['ğŸ‘•','ğŸ‘–','ğŸ§£','ğŸ§¤','ğŸ§¥','ğŸ§¦','ğŸ‘—','ğŸ‘˜','ğŸ¥»','ğŸ©±','ğŸ©²','ğŸ©³','ğŸ‘™','ğŸ‘š','ğŸ‘›','ğŸ‘œ','ğŸ‘','ğŸ’','ğŸ©´','ğŸ‘','ğŸ‘Ÿ','ğŸ¥¾','ğŸ¥¿','ğŸ‘ ','ğŸ‘¡','ğŸ©°','ğŸ‘¢','ğŸ‘‘','ğŸ‘’','ğŸ©','ğŸª–','â›‘ï¸','ğŸ’„','ğŸ’','ğŸ’','ğŸ‘“','ğŸ•¶','ğŸ¥½','ğŸ“¿','ğŸ§¢','ğŸ‘•','ğŸ‘–','ğŸ§£','ğŸ§¥','ğŸ‘—','ğŸ‘˜','ğŸ’','ğŸ‘Ÿ','ğŸ¥¾','ğŸ‘ '],
building:['ğŸ ','ğŸ¡','ğŸ¢','ğŸ£','ğŸ¤','ğŸ¥','ğŸ¦','ğŸ¨','ğŸ©','ğŸª','ğŸ«','ğŸ¬','ğŸ­','ğŸ¯','ğŸ°','ğŸ•Œ','ğŸ•','â›ª','ğŸ•‹','ğŸ›•','â›©','ğŸ—','ğŸš','ğŸ—¼','ğŸ—½','ğŸ—¾','ğŸ‘','â›²','â›º','ğŸ›','ğŸŸ','ğŸ—º','ğŸ–','ğŸœ','ğŸ','ğŸ','ğŸ”','â›°','ğŸŒ‹','ğŸŒ','ğŸŒ‰','ğŸŒ…','ğŸŒ„','ğŸŒ‡','ğŸŒ†','ğŸ™','ğŸŒƒ','ğŸ—»','ğŸª','ğŸ¡'],
school:['ğŸ“š','ğŸ“–','ğŸ“','ğŸ“’','ğŸ““','ğŸ“”','ğŸ“•','ğŸ“—','ğŸ“˜','ğŸ“™','ğŸ“„','ğŸ“ƒ','ğŸ“‹','ğŸ“','ğŸ“','ğŸ“','âœ‚ï¸','âœï¸','ğŸ–Š','ğŸ–‹','ğŸ–','ğŸ”—','ğŸ“Œ','ğŸ“','ğŸ—‚','ğŸ“','ğŸ“‚','ğŸ—ƒ','ğŸ—„','ğŸ—‘','ğŸ“°','ğŸ—','ğŸ“Š','ğŸ“ˆ','ğŸ“‰','ğŸ—’','ğŸ—“','ğŸ“†','ğŸ“…','ğŸ”–','ğŸ“®','ğŸ“¬','ğŸ“­','ğŸ“ª','ğŸ“«','âœ‰ï¸','ğŸ“©','ğŸ“¨','ğŸ“§','ğŸ’Œ'],
tech:['ğŸ’»','ğŸ–¥','ğŸ–¨','âŒ¨ï¸','ğŸ–±','ğŸ’½','ğŸ’¾','ğŸ’¿','ğŸ“±','ğŸ“²','ğŸ“·','ğŸ“¸','ğŸ“¹','ğŸ“º','ğŸ“»','ğŸ“¡','ğŸ”Œ','ğŸ”‹','ğŸ’¡','ğŸ“Ÿ','ğŸ“ ','ğŸ•¹','ğŸ®','ğŸ§','ğŸ”¬','ğŸ”­','ğŸ“¡','ğŸ›°','ğŸ’»','ğŸ–¥','âŒ¨ï¸','ğŸ–±','ğŸ“±','ğŸ“²','ğŸ“·','ğŸ“¹','ğŸ“º','ğŸ“»','ğŸ”Œ','ğŸ”‹','ğŸ’¡','ğŸ•¹','ğŸ®','ğŸ§','ğŸ”¬','ğŸ”­','ğŸ›°','ğŸ“¡','âŒš','ğŸ¤–'],
mix:['ğŸ„','ğŸ','ğŸŸ','ğŸ¦‹','â˜€ï¸','ğŸŒ¸','ğŸ¥•','ğŸ•','ğŸš—','ğŸŒ','âš½','ğŸµ','ğŸ¦','ğŸ¦…','ğŸ”¨','ğŸ‘•','ğŸ ','ğŸ“š','ğŸ’»','ğŸ‰','ğŸ·','ğŸŠ','ğŸ¬','ğŸ','ğŸŒˆ','ğŸŒ¹','ğŸŒ½','ğŸ”','ğŸšŒ','ğŸª','ğŸ€','ğŸ¸','ğŸ¯','ğŸ¦‰','ğŸ”§','ğŸ‘—','ğŸ«','ğŸ“–','ğŸ“±','ğŸŠ','ğŸ´','ğŸ‡','ğŸ™','ğŸ','â­','ğŸŒ»','ğŸ†','ğŸ°','âœˆï¸','ğŸš€']
};

// ===== THEMES =====
const THEMES=[
  {bg:'linear-gradient(135deg,#86efac,#22c55e)',cf1:'#16a34a',cf2:'#15803d'},
  {bg:'linear-gradient(135deg,#fca5a5,#ef4444)',cf1:'#dc2626',cf2:'#b91c1c'},
  {bg:'linear-gradient(135deg,#67e8f9,#0891b2)',cf1:'#0891b2',cf2:'#0e7490'},
  {bg:'linear-gradient(135deg,#a3e635,#65a30d)',cf1:'#65a30d',cf2:'#4d7c0f'},
  {bg:'linear-gradient(135deg,#93c5fd,#3b82f6)',cf1:'#3b82f6',cf2:'#2563eb'},
  {bg:'linear-gradient(135deg,#f9a8d4,#ec4899)',cf1:'#ec4899',cf2:'#be185d'},
  {bg:'linear-gradient(135deg,#86efac,#16a34a)',cf1:'#16a34a',cf2:'#15803d'},
  {bg:'linear-gradient(135deg,#fdba74,#ea580c)',cf1:'#ea580c',cf2:'#c2410c'},
  {bg:'linear-gradient(135deg,#cbd5e1,#475569)',cf1:'#475569',cf2:'#334155'},
  {bg:'linear-gradient(135deg,#c4b5fd,#7c3aed)',cf1:'#7c3aed',cf2:'#6d28d9'},
  {bg:'linear-gradient(135deg,#6ee7b7,#059669)',cf1:'#059669',cf2:'#047857'},
  {bg:'linear-gradient(135deg,#d8b4fe,#9333ea)',cf1:'#9333ea',cf2:'#7e22ce'},
  {bg:'linear-gradient(135deg,#fde68a,#d97706)',cf1:'#d97706',cf2:'#b45309'},
  {bg:'linear-gradient(135deg,#7dd3fc,#0284c7)',cf1:'#0284c7',cf2:'#0369a1'},
  {bg:'linear-gradient(135deg,#fb923c,#c2410c)',cf1:'#c2410c',cf2:'#9a3412'},
  {bg:'linear-gradient(135deg,#f0abfc,#a855f7)',cf1:'#a855f7',cf2:'#9333ea'},
  {bg:'linear-gradient(135deg,#a8a29e,#57534e)',cf1:'#57534e',cf2:'#44403c'},
  {bg:'linear-gradient(135deg,#60a5fa,#2563eb)',cf1:'#2563eb',cf2:'#1d4ed8'},
  {bg:'linear-gradient(135deg,#22d3ee,#0e7490)',cf1:'#0e7490',cf2:'#0891b2'},
  {bg:'linear-gradient(135deg,#fb7185,#be123c)',cf1:'#be123c',cf2:'#9f1239'},
];

// ===== LEVEL CONFIG: 20 levels, increasing grid & pairs =====
const LEVELS=[
  {cat:'farm',    gridCols:3,gridRows:2,pairs:3, emoji:'ğŸ„'},
  {cat:'fruit',   gridCols:4,gridRows:2,pairs:4, emoji:'ğŸ'},
  {cat:'sea',     gridCols:4,gridRows:3,pairs:6, emoji:'ğŸ '},
  {cat:'bug',     gridCols:4,gridRows:3,pairs:6, emoji:'ğŸ¦‹'},
  {cat:'weather', gridCols:4,gridRows:4,pairs:8, emoji:'ğŸŒ¤'},
  {cat:'flower',  gridCols:4,gridRows:4,pairs:8, emoji:'ğŸŒ¸'},
  {cat:'veggie',  gridCols:4,gridRows:4,pairs:8, emoji:'ğŸ¥•'},
  {cat:'food',    gridCols:5,gridRows:4,pairs:10,emoji:'ğŸ•'},
  {cat:'vehicle', gridCols:5,gridRows:4,pairs:10,emoji:'ğŸš—'},
  {cat:'space',   gridCols:4,gridRows:5,pairs:10,emoji:'ğŸš€'},
  {cat:'sport',   gridCols:6,gridRows:4,pairs:12,emoji:'âš½'},
  {cat:'music',   gridCols:6,gridRows:4,pairs:12,emoji:'ğŸµ'},
  {cat:'wild',    gridCols:5,gridRows:5,pairs:12,emoji:'ğŸ¦'},
  {cat:'bird',    gridCols:6,gridRows:5,pairs:15,emoji:'ğŸ¦…'},
  {cat:'tool',    gridCols:6,gridRows:5,pairs:15,emoji:'ğŸ”¨'},
  {cat:'fashion', gridCols:6,gridRows:5,pairs:15,emoji:'ğŸ‘—'},
  {cat:'building',gridCols:6,gridRows:6,pairs:18,emoji:'ğŸ '},
  {cat:'school',  gridCols:6,gridRows:6,pairs:18,emoji:'ğŸ“š'},
  {cat:'tech',    gridCols:6,gridRows:6,pairs:18,emoji:'ğŸ’»'},
  {cat:'mix',     gridCols:6,gridRows:6,pairs:18,emoji:'ğŸŒ'},
];

// ===== AUDIO =====
let audioCtx=null;
function ctx(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx}
function tone(f,d,tp,v){try{const c=ctx(),o=c.createOscillator(),g=c.createGain();o.type=tp||'sine';o.frequency.setValueAtTime(f,c.currentTime);g.gain.setValueAtTime(v||.1,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+(d||.15));o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+(d||.15))}catch(e){}}
function sfxFlip(){tone(523,.06,'sine',.08)}
function sfxMatch(){tone(659,.1,'sine',.12);setTimeout(()=>tone(784,.1,'sine',.12),70);setTimeout(()=>tone(988,.12,'sine',.13),140)}
function sfxNoMatch(){tone(220,.15,'sawtooth',.06)}
function sfxComplete(){[523,659,784,988,1175,1319].forEach((f,i)=>setTimeout(()=>tone(f,.18,'sine',.1),i*80))}
function sfxStar(){[880,1100,1320].forEach((f,i)=>setTimeout(()=>tone(f,.15,'sine',.1),i*120))}

// ===== GAME STATE =====
let cards=[],moves=0,matchedPairs=0,totalPairs=8,firstPick=null,secondPick=null,isChecking=false;
let gameStarted=false,startTime=null,timerInterval=null,elapsedSeconds=0;
let currentLevel=-1,currentGridCols=4,currentGridRows=4;
let currentEmoji=[];

let progress=JSON.parse(localStorage.getItem('classify_memory_progress')||'{"unlocked":1,"scores":{},"stars":{}}');
function saveProgress(){localStorage.setItem('classify_memory_progress',JSON.stringify(progress))}

// ===== HELPERS =====
function shuffle(arr){const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function fmtTime(s){return Math.floor(s/60)+':'+String(s%60).padStart(2,'0')}
function pickEmoji(cat,n){const pool=POOL[cat]||POOL.mix;const unique=[...new Set(shuffle(pool))];return unique.slice(0,n)}

function calcScore(moves,pairs,duration){
  const perfect=pairs;
  const extraMoves=Math.max(0,moves-perfect);
  const movePenalty=extraMoves*3;
  const graceSec=pairs*5;
  const extraSec=Math.max(0,duration-graceSec);
  const timePenalty=extraSec*0.3;
  return Math.max(10,Math.min(100,Math.round(100-movePenalty-timePenalty)));
}

// ===== SCREENS =====
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id==='lvl-screen')renderLevelSelect();
}

function renderLevelSelect(){
  const g=document.getElementById('ls-g');g.innerHTML='';
  for(let i=0;i<LEVELS.length;i++){
    const cfg=LEVELS[i];
    const unlocked=i<progress.unlocked;
    const stars=progress.stars[i]||0;
    const isCurr=i===progress.unlocked-1;
    const card=document.createElement('div');
    card.className='lc'+(unlocked?'':' locked')+(isCurr?' current':'');
    if(unlocked){
      card.innerHTML=`<div class="lc-num">${i+1}</div><div class="lc-emoji">${cfg.emoji}</div><div class="lc-name">${t.lvNames[i]}</div><div class="lc-stars">${stars>=1?'â­':'â˜†'}${stars>=2?'â­':'â˜†'}${stars>=3?'â­':'â˜†'}</div>`;
      card.onclick=()=>startLevel(i);
    } else {
      card.innerHTML=`<div class="lc-num" style="opacity:.4">${i+1}</div><div class="lc-lock">${t.locked}</div><div class="lc-name" style="opacity:.4">${t.lvNames[i]}</div>`;
    }
    g.appendChild(card);
  }
}

// ===== START LEVEL =====
function startLevel(idx){
  currentLevel=idx;
  const cfg=LEVELS[idx];
  currentGridCols=cfg.gridCols;currentGridRows=cfg.gridRows;totalPairs=cfg.pairs;
  currentEmoji=pickEmoji(cfg.cat,totalPairs);
  const theme=THEMES[idx];
  document.getElementById('game-screen').style.background=theme.bg;
  document.getElementById('game-screen').style.setProperty('--cf1',theme.cf1);
  document.getElementById('game-screen').style.setProperty('--cf2',theme.cf2);
  document.getElementById('done-screen').style.background=theme.bg;
  document.getElementById('g-t').textContent=t.lvNames[idx];
  document.getElementById('g-b').textContent=''+(idx+1);
  resetGame();
  showScreen('game-screen');
}

function resetGame(){
  clearInterval(timerInterval);
  cards=createDeck();moves=0;matchedPairs=0;firstPick=null;secondPick=null;isChecking=false;
  gameStarted=false;startTime=null;elapsedSeconds=0;
  document.getElementById('g-mv').textContent='0';
  document.getElementById('g-pr').textContent='0/'+totalPairs;
  document.getElementById('g-tm').textContent='0:00';
  document.getElementById('hint').style.display='';
  renderCards();
}

function createDeck(){
  const chosen=currentEmoji.slice(0,totalPairs);
  const doubled=[...chosen,...chosen];
  return shuffle(doubled).map((s,i)=>({id:i,symbol:s,flipped:false,matched:false}));
}

function renderCards(){
  const g=document.getElementById('grid');
  const wrap=document.querySelector('.grid-wrap');
  const maxW=wrap.clientWidth-8,maxH=wrap.clientHeight-8;
  const gap=Math.max(3,Math.min(6,maxW*.01));
  const sW=(maxW-gap*(currentGridCols-1))/currentGridCols;
  const sH=(maxH-gap*(currentGridRows-1))/currentGridRows;
  const sz=Math.floor(Math.min(sW,sH,80));
  g.style.gridTemplateColumns=`repeat(${currentGridCols},${sz}px)`;
  g.style.gridTemplateRows=`repeat(${currentGridRows},${sz}px)`;
  g.style.gap=gap+'px';
  g.innerHTML='';
  cards.forEach(card=>{
    const btn=document.createElement('button');
    btn.className='card'+(card.flipped?' flipped':'')+(card.matched?' matched flipped':'');
    btn.disabled=card.flipped||card.matched;
    btn.setAttribute('data-id',card.id);
    btn.innerHTML=`<div class="card-inner"><div class="card-front"><span class="icon">â“</span></div><div class="card-back"><span class="sym">${card.symbol}</span></div></div>`;
    btn.style.width=sz+'px';btn.style.height=sz+'px';
    btn.addEventListener('click',()=>flipCard(card.id));
    g.appendChild(btn);
  });
}

function flipCard(id){
  if(isChecking)return;
  const card=cards[id];
  if(!card||card.flipped||card.matched)return;
  if(!gameStarted){gameStarted=true;startTime=Date.now();document.getElementById('hint').style.display='none';timerInterval=setInterval(()=>{elapsedSeconds=Math.floor((Date.now()-startTime)/1000);document.getElementById('g-tm').textContent=fmtTime(elapsedSeconds)},1000)}
  card.flipped=true;
  updateCardDOM(id,true,false);
  sfxFlip();
  if(firstPick===null){firstPick=id;return}
  secondPick=id;moves++;
  document.getElementById('g-mv').textContent=moves;
  const first=cards[firstPick],second=cards[secondPick];
  if(first.symbol===second.symbol){
    first.matched=true;second.matched=true;matchedPairs++;
    document.getElementById('g-pr').textContent=matchedPairs+'/'+totalPairs;
    updateCardDOM(first.id,true,true);updateCardDOM(second.id,true,true);
    sfxMatch();
    firstPick=null;secondPick=null;
    if(matchedPairs===totalPairs)setTimeout(()=>endGame(),400);
  } else {
    isChecking=true;sfxNoMatch();
    setTimeout(()=>{first.flipped=false;second.flipped=false;updateCardDOM(first.id,false,false);updateCardDOM(second.id,false,false);firstPick=null;secondPick=null;isChecking=false},800);
  }
}

function updateCardDOM(id,flipped,matched){
  const btn=document.getElementById('grid').querySelector(`[data-id="${id}"]`);
  if(!btn)return;
  btn.className='card'+(flipped?' flipped':'')+(matched?' matched':'');
  btn.disabled=flipped||matched;
}

function endGame(){
  clearInterval(timerInterval);
  const dur=Math.floor((Date.now()-startTime)/1000);
  const sc=calcScore(moves,totalPairs,dur);
  let stars=0;if(sc>=50)stars=1;if(sc>=75)stars=2;if(sc>=90)stars=3;
  if(currentLevel>=0){
    const prev=progress.stars[currentLevel]||0;if(stars>prev)progress.stars[currentLevel]=stars;
    const prevSc=progress.scores[currentLevel]||0;if(sc>prevSc)progress.scores[currentLevel]=sc;
    if(stars>=1&&currentLevel+1>=progress.unlocked)progress.unlocked=currentLevel+2;
    saveProgress();
  }
  let title,emoji;
  if(stars>=3){title=t.excellent;emoji='ğŸ†'}else if(stars>=2){title=t.great;emoji='ğŸ‰'}else if(stars>=1){title=t.good;emoji='ğŸ‘'}else{title=t.tryMore;emoji='ğŸ’ª'}
  document.getElementById('d-e').textContent=emoji;
  document.getElementById('d-t').textContent=title;
  document.getElementById('d-sub').textContent=t.done;
  document.getElementById('d-sc').textContent=sc+'/100';
  document.getElementById('d-mv2').textContent=moves;
  document.getElementById('d-tm').textContent=fmtTime(dur);
  const starsEl=document.getElementById('d-st');starsEl.innerHTML='';
  for(let i=0;i<3;i++){const sp=document.createElement('span');sp.textContent=i<stars?'â­':'â˜†';sp.style.opacity=i<stars?'1':'.3';starsEl.appendChild(sp)}
  document.getElementById('d-nx').style.display=(currentLevel>=0&&currentLevel<LEVELS.length-1)?'':'none';
  sfxComplete();if(stars>0)sfxStar();
  showScreen('done-screen');
  // Particles
  for(let i=0;i<stars*6;i++){setTimeout(()=>{const p=document.createElement('div');p.className='particle';p.textContent=['â­','âœ¨','ğŸŒŸ','ğŸ‰','ğŸ’'][Math.floor(Math.random()*5)];p.style.left=(Math.random()*innerWidth)+'px';p.style.top=(innerHeight*.6+Math.random()*80)+'px';p.style.fontSize='22px';document.body.appendChild(p);setTimeout(()=>p.remove(),1200)},i*70)}
  // PostMessage
  try{window.parent.postMessage({type:'GAME_COMPLETE',score:sc,total:100,timeElapsed:dur,moves:moves,level:currentLevel>=0?currentLevel+1:0,stars:stars},'*')}catch(e){}
}

function nextLevel(){if(currentLevel>=0&&currentLevel<LEVELS.length-1)startLevel(currentLevel+1)}
function replayLevel(){if(currentLevel>=0)startLevel(currentLevel)}
function shareResult(){
  const lvl=currentLevel>=0?currentLevel+1:0;const stars=currentLevel>=0?(progress.stars[currentLevel]||0):0;
  const text=t.shareText.replace('{score}',progress.scores[currentLevel]||0).replace('{level}',lvl).replace('{stars}','â­'.repeat(stars));
  try{if(navigator.share)navigator.share({title:t.title,text:text})}catch(e){}
  try{window.parent.postMessage({type:'SHARE_ACHIEVEMENT',game:'memory',level:lvl,score:progress.scores[currentLevel]||0,stars:stars,text:text},'*')}catch(e){}
  const btn=document.getElementById('d-sh');const o=btn.textContent;btn.textContent='âœ…';setTimeout(()=>{btn.textContent=o},2000);
}

// ===== i18n APPLY =====
document.getElementById('ls-t').textContent=t.title;
document.getElementById('ls-s').textContent=t.sub;
document.getElementById('g-mvl').textContent=t.moves;
document.getElementById('g-prl').textContent=t.pairs;
document.getElementById('g-tml').textContent=t.time;
document.getElementById('hint').textContent=t.hint;
document.getElementById('d-scl').textContent=t.score;
document.getElementById('d-mvl2').textContent=t.moves;
document.getElementById('d-tml').textContent=t.time;
document.getElementById('d-nx').textContent=t.next;
document.getElementById('d-sh').textContent=t.share;

// ===== INIT =====
window.addEventListener('resize',()=>{if(document.getElementById('game-screen').classList.contains('active'))renderCards()});
renderLevelSelect();
</script>
</body>
</html>
